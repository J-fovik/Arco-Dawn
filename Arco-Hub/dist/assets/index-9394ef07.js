import{a as $,n as g,p as M,O as oe,P as se,T as re,d as R,q as ue,E as ie,s as de,v as pe,M as ce,x as me,y as ge,r as i,o as d,e as k,g as s,w as n,c as e,f as L,i as c,t as _e,h as _,F as T,z as C,l as f,k as I,A as fe,S as be}from"./index-8a2cb146.js";import{_ as he}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{O as v}from"./order-70291d37.js";import"./index-2bbe694f.js";const Ie=()=>{const{getDictionaryItem:N}=$();return[{title:"团号",dataIndex:"groupId",ellipsis:!0,tooltip:!0,show:!0,align:"center",render:({record:l})=>g(l.groupId)},{title:"供应商名称",dataIndex:"supName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:l})=>g(l.supName)},{title:"线路编号",dataIndex:"routeId",show:!0,align:"center",render:({record:l})=>M(re,{color:"blue"},{default:()=>g(l.routeId)})},{title:"线路名称",dataIndex:"routeName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:l})=>g(l.routeName)},{title:"订单状态",dataIndex:"state",show:!0,align:"center",render:({record:l})=>g(N("new_trade_order",l.state).detailName)},{title:"结算控制",width:150,slotName:"switch",show:!0,align:"center"},{title:"行程天数",dataIndex:"days",show:!0,align:"right",render:({record:l})=>g(l.days)},{title:"报名人数",dataIndex:"totalNumber",show:!0,align:"right",render:({record:l})=>g(l.totalNumber)},{title:"订单总费用",dataIndex:"totalCost",show:!0,align:"right",render:({record:l})=>M("span",{class:"text-red text-price"},oe(se(l.totalCost)))},{title:"创建时间",dataIndex:"createTimeStr",show:!0,align:"center",render:({record:l})=>g(l.createTimeStr)},{title:"操作",width:350,slotName:"operate",show:!0,align:"left"}]},ye=L("span",{class:"mx-3"},"-",-1),we={key:0},ke=R({name:"OrderTradeManage"}),Te=R({...ke,setup(N){const{vAuthority:l,userInfo:U}=ue(),[A,O]=ie(null),{getDictionaryInfo:B}=$(),{warningModal:S}=fe(),{form:u,resetForm:F}=de(()=>({groupId:"",routeName:"",supId:"",state:"",startDate:"",endDate:""}),()=>V()),{columnsData:P,visibleColumnsData:E,tableBaseOptions:p,resetData:V,setSelectRow:x,extendTableList:K,changeTableColumn:q,changeTableSize:G}=pe(Ie(),()=>b()),Q=o=>{S("确定重新提交吗?",async a=>{const{res:m}=await I(()=>v.resubmitLineOrder({groupId:o.groupId}),{successMsg:"操作成功"});a(!0),m&&b()})},Y=o=>{S("确定已开客人发票吗?",async a=>{const{res:m}=await I(()=>v.openCustomerInvoice({groupId:o.groupId}),{successMsg:"操作成功"});a(!0),m&&b()})},j=o=>{S("确定删除订单吗?",async a=>{const{res:m}=await I(()=>v.deleteLineOrder({signupNo:o.signupNo}),{successMsg:"操作成功"});a(!0),m&&b()})},H=async o=>{const{err:a}=await I(()=>v.pauseOrRestoreSettle({groupId:o.groupId,pauseOrRestore:o.pauseOrRestore=="1"?"0":"1"}),{before:()=>O(o.id),after:()=>O(null),successMsg:"操作成功"});a||b()},{data:J}=ce(async()=>{const{res:o,err:a}=await I(()=>be.getSupplierList({pagingOrNot:"0"}));return a?[]:o==null?void 0:o.data.supplierList},[]),{data:W,loading:X,initData:b}=me(async()=>{const{res:o,err:a}=await I(()=>v.getTradeOrderList({...u.value,currentPage:p.pagination.current,pageSize:p.pagination.pageSize,pagingOrNot:"1"}));return a?[]:(p.pagination.total=o.data.totalCount,K(o==null?void 0:o.data.dataList))});return ge(()=>{b()}),(o,a)=>{const m=i("a-input"),y=i("a-form-item"),w=i("a-grid-item"),D=i("a-select"),z=i("a-date-picker"),Z=i("a-grid"),ee=i("a-form"),te=i("a-switch"),h=i("a-button"),ae=i("a-alert"),ne=i("a-button-group"),le=i("a-table");return d(),k("div",null,[s(he,{fold:"","table-columns":e(P),"table-size":e(p).size,onResetSearch:e(F),onSearch:e(V),onChangeTableSize:e(G),onChangeTableColumn:e(q)},{form:n(({collapsed:t})=>[s(ee,{model:e(u),"label-align":"left",size:"large","auto-label-width":""},{default:n(()=>[s(Z,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!t},{default:n(()=>[s(w,null,{default:n(()=>[s(y,{label:"团号:"},{default:n(()=>[s(m,{modelValue:e(u).groupId,"onUpdate:modelValue":a[0]||(a[0]=r=>e(u).groupId=r),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),s(w,null,{default:n(()=>[s(y,{label:"线路名称:"},{default:n(()=>[s(m,{modelValue:e(u).routeName,"onUpdate:modelValue":a[1]||(a[1]=r=>e(u).routeName=r),placeholder:"请输入线路名称"},null,8,["modelValue"])]),_:1})]),_:1}),s(w,null,{default:n(()=>[s(y,{label:"供应商:"},{default:n(()=>[s(D,{modelValue:e(u).supId,"onUpdate:modelValue":a[2]||(a[2]=r=>e(u).supId=r),options:e(J),"field-names":{label:"supName",value:"id"},"virtual-list-props":{height:200},"allow-search":"",placeholder:"请选择供应商（可搜索）"},null,8,["modelValue","options"])]),_:1})]),_:1}),s(w,null,{default:n(()=>[s(y,{label:"订单状态:"},{default:n(()=>[s(D,{modelValue:e(u).state,"onUpdate:modelValue":a[3]||(a[3]=r=>e(u).state=r),placeholder:"请选择订单状态",options:e(B)("new_trade_order"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),s(w,null,{default:n(()=>[s(y,{label:"出团日期:"},{default:n(()=>[s(z,{modelValue:e(u).startDate,"onUpdate:modelValue":a[4]||(a[4]=r=>e(u).startDate=r),class:"flex1",placeholder:"出团日期(开始)"},null,8,["modelValue"]),ye,s(z,{modelValue:e(u).endDate,"onUpdate:modelValue":a[5]||(a[5]=r=>e(u).endDate=r),class:"flex1",placeholder:"出团日期(结束)"},null,8,["modelValue"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),table:n(()=>[s(le,{"selected-keys":e(p).selectedKeys,"onUpdate:selectedKeys":a[6]||(a[6]=t=>e(p).selectedKeys=t),class:"zs-table","row-key":"routeId",data:e(W),"row-selection":e(p).rowSelection,bordered:e(p).bordered,pagination:e(p).pagination,size:e(p).size,columns:e(E),stripe:e(p).stripe,loading:e(X)},{switch:n(({record:t})=>[L("div",null,[s(te,{size:"medium","model-value":t.pauseOrRestore==="1",loading:e(A)===t.id,disabled:e(U).userAccount!=t.pauseSettleUser&&t.pauseOrRestore==="1",onChange:r=>H(t)},{checked:n(()=>[c("暂停 ")]),unchecked:n(()=>[c(" 恢复 ")]),_:2},1032,["model-value","loading","disabled","onChange"]),t.pauseOrRestore==="1"?(d(),k("div",we," 暂停人："+_e(t.pauseSettleUser),1)):_("",!0)])]),operate:n(({record:t})=>[s(ne,null,{default:n(()=>[t.transferState=="1"?(d(),k(T,{key:0},[t.customerInvoiceFlag!="1"?C((d(),f(h,{key:0,type:"text",status:"danger",onClick:r=>e(x)(t,()=>Y(t))},{default:n(()=>[c("已开客人发票 ")]),_:2},1032,["onClick"])),[[e(l),"OrderTradeManagePreviewInvoice"]]):_("",!0),["10","12","09","31","90","11","20","14"].includes(t.state)?(d(),f(h,{key:1,type:"text",status:"success",onClick:r=>o.$router.push(`/order/tradeManage/operate/?routeId=${t.routeId}&groupId=${t.groupId}`)},{default:n(()=>[c("详情")]),_:2},1032,["onClick"])):_("",!0),["10","09"].includes(t.state)?(d(),k(T,{key:2},[C((d(),f(h,{type:"text",status:"danger",onClick:r=>e(x)(t,()=>j(t))},{default:n(()=>[c("删除")]),_:2},1032,["onClick"])),[[e(l),"OrderTradeManageDelete"]]),C((d(),f(h,{type:"text",onClick:r=>o.$router.push(`/registrationPlan/tourism/operate/?id=${t.routeId}&groupId=${t.groupId}&name=${o.$route.name}`)},{default:n(()=>[c("编辑")]),_:2},1032,["onClick"])),[[e(l),"OrderTradeManageEdit"]])],64)):_("",!0),["31"].includes(t.state)?C((d(),f(h,{key:3,type:"text",onClick:r=>e(x)(t,()=>Q(t))},{default:n(()=>[c("重新提交")]),_:2},1032,["onClick"])),[[e(l),"OrderTradeManageResubmit"]]):_("",!0),t.totalNumber>0?(d(),k(T,{key:4},[["90","12","31","11"].includes(t.state)&&t.settleType==="0"?C((d(),f(h,{key:0,type:"text",status:"danger"},{default:n(()=>[c("申请退团")]),_:1})),[[e(l),"OrderTradeManageQuitGroup"]]):_("",!0)],64)):_("",!0)],64)):(d(),f(ae,{key:1,type:"warning"},{default:n(()=>[c("调账中无法操作")]),_:1}))]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"])])}}});export{Te as default};
