import{d as P,u as Z,C as G,a as H,E as W,s as X,M as J,I as w,r as i,o as S,l as L,w as n,g as l,c as o,f as I,i as q,h as Q,k as m,G as $,H as ee,X as x,Y as ae,_ as te}from"./index-8a2cb146.js";import{p as oe,l as le}from"./rules-4aeaef32.js";import{Z as ne}from"./index-2bbe694f.js";import{F as D}from"./fleet-3200ffd1.js";const re=p=>($("data-v-6eabb9c6"),p=p(),ee(),p),de=re(()=>I("div",{style:{height:"100px"}},null,-1)),ie={class:"orderSubmit-footer box-flex jc-fe"},se=P({name:"FleetCooperateManageOperate"}),ue=P({...se,setup(p){const u=Z(),{jumpTabName:_}=G();H();const[k,C]=W(null),{form:e,formRef:v}=X(()=>({fleetName:"",fleetContacts:"",fleetContactsPhone:void 0,country:"",countryCode:"",province:"",provinceCode:"",city:"",cityCode:"",periodCooperateEnd:"",periodCooperateStart:"",fileList:[]})),E={fleetName:{required:!0,message:"请输入车队名称"},fleetContacts:{required:!0,message:"请输入联系人"},fleetContactsPhone:{required:!0,validator:(t,a)=>{t||a("请输入手机号码"),!oe(t)&&!le(t)&&a("请输入正确的手机号码")}},countryCode:{required:!0,message:"请输入所属国家"},periodCooperateStart:{required:!0,message:"请选择合作期限开始日期"},periodCooperateEnd:{required:!0,message:"请选择合作期限结束日期"},fileList:{required:!0,message:"请上传合作详情文件"}},c=async t=>{const{res:a}=await m(()=>ae.getAreaInfo(t));return(a==null?void 0:a.data)??[]},{data:y}=J(async()=>await c({level:"1"}),[]),{data:b}=w(async()=>await c({parentNo:e.value.countryCode}),{watchSource:()=>e.value.countryCode,defaultValue:[]}),{data:g}=w(async()=>await c({parentNo:e.value.provinceCode}),{watchSource:()=>e.value.provinceCode,defaultValue:[]}),U=t=>{e.value.provinceCode="",e.value.province="",e.value.cityCode="",e.value.city="",e.value.country=y.value.find(a=>a.areaNo==t).areaName},M=t=>{e.value.cityCode="",e.value.city="",e.value.province=b.value.find(a=>a.areaNo==t).areaName},R=t=>{e.value.city=g.value.find(a=>a.areaNo==t).areaName},Y=()=>{v.value.validate(t=>{t||A()})},A=async()=>{const t=e.value.fileList.filter(r=>r.status!="done").map(r=>r.file),a=e.value.fileList.filter(r=>r.status=="done").map(r=>r.uid),{err:s}=await m(()=>D.planeFleetSave({...e.value,periodCooperateStart:x(e.value.periodCooperateStart,"YYYYMMDD",""),periodCooperateEnd:x(e.value.periodCooperateEnd,"YYYYMMDD",""),fileList:t.length==0?null:t,oldFileIdList:a}),{before:()=>C("okLoading"),after:()=>C(null),successMsg:"保存成功"});s||_()},F=async()=>{const{res:t,err:a}=await m(()=>D.getFleetDetail({id:u.query.id}));a||(e.value={...t==null?void 0:t.data,fleetContactsPhone:(t==null?void 0:t.data.fleetContactsPhone)*1},e.value.fileList=t==null?void 0:t.data.cooperateDetailList.map(s=>({name:s.attName,size:s.attSize,url:s.attPath,uid:s.id,status:"done"})))};return u.query.id&&F(),(t,a)=>{const s=i("a-input"),r=i("a-form-item"),B=i("a-input-number"),f=i("a-select"),V=i("a-date-picker"),h=i("a-col"),O=i("a-row"),T=i("a-upload"),z=i("a-form"),j=i("a-card"),N=i("a-button"),K=i("a-space");return S(),L(ne,null,{default:n(()=>[l(j,{title:"车队合作信息维护",bordered:!1,class:"general-card"},{default:n(()=>[l(z,{ref_key:"formRef",ref:v,model:o(e),"label-align":"left",size:"large",style:{width:"800px","padding-left":"100px"},"auto-label-width":"",disabled:!!o(u).query.isReadOnly,rules:E},{default:n(()=>[l(r,{field:"fleetName",label:"车队名称:",required:""},{default:n(()=>[l(s,{modelValue:o(e).fleetName,"onUpdate:modelValue":a[0]||(a[0]=d=>o(e).fleetName=d),modelModifiers:{trim:!0},placeholder:"请输入车队名称"},null,8,["modelValue"])]),_:1}),l(r,{field:"fleetContacts",label:"联系人:",required:""},{default:n(()=>[l(s,{modelValue:o(e).fleetContacts,"onUpdate:modelValue":a[1]||(a[1]=d=>o(e).fleetContacts=d),modelModifiers:{trim:!0},placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),l(r,{field:"fleetContactsPhone",label:"联系电话:",required:""},{default:n(()=>[l(B,{modelValue:o(e).fleetContactsPhone,"onUpdate:modelValue":a[2]||(a[2]=d=>o(e).fleetContactsPhone=d),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(r,{label:"所属国家:",field:"countryCode",required:""},{default:n(()=>[l(f,{modelValue:o(e).countryCode,"onUpdate:modelValue":a[3]||(a[3]=d=>o(e).countryCode=d),"allow-search":"",options:o(y),"field-names":{label:"areaName",value:"areaNo"},"virtual-list-props":{height:200},placeholder:"请选择所属国家",onChange:U},null,8,["modelValue","options"])]),_:1}),l(r,{label:"所属省:",field:"provinceCode"},{default:n(()=>[l(f,{modelValue:o(e).provinceCode,"onUpdate:modelValue":a[4]||(a[4]=d=>o(e).provinceCode=d),options:o(b),"field-names":{label:"areaName",value:"areaNo"},"allow-search":"",placeholder:"请选择所属省",onChange:M},null,8,["modelValue","options"])]),_:1}),l(r,{label:"所属市:",field:"cityCode"},{default:n(()=>[l(f,{modelValue:o(e).cityCode,"onUpdate:modelValue":a[5]||(a[5]=d=>o(e).cityCode=d),options:o(g),"field-names":{label:"areaName",value:"areaNo"},"allow-search":"",placeholder:"请选择所属市",onChange:R},null,8,["modelValue","options"])]),_:1}),l(O,{gutter:8},{default:n(()=>[l(h,{span:12},{default:n(()=>[l(r,{field:"periodCooperateStart",label:"合作期限开始:"},{default:n(()=>[l(V,{modelValue:o(e).periodCooperateStart,"onUpdate:modelValue":a[6]||(a[6]=d=>o(e).periodCooperateStart=d),class:"flex1"},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:n(()=>[l(r,{field:"periodCooperateEnd",label:"合作期限结束:"},{default:n(()=>[l(V,{modelValue:o(e).periodCooperateEnd,"onUpdate:modelValue":a[7]||(a[7]=d=>o(e).periodCooperateEnd=d),class:"flex1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"合作详情:",field:"fileList"},{default:n(()=>[l(T,{"file-list":o(e).fileList,"onUpdate:fileList":a[8]||(a[8]=d=>o(e).fileList=d),"auto-upload":!1,accept:".pdf",multiple:"",limit:1,draggable:"","show-retry-button":!1,"show-remove-button":!o(u).query.isReadOnly},null,8,["file-list","show-remove-button"])]),_:1})]),_:1},8,["model","disabled"])]),_:1}),de,I("div",ie,[l(K,null,{default:n(()=>[o(u).query.isReadOnly?Q("",!0):(S(),L(N,{key:0,loading:o(k)==="okLoading",type:"primary",onClick:Y},{default:n(()=>[q("确定")]),_:1},8,["loading"])),l(N,{onClick:a[9]||(a[9]=()=>o(_)())},{default:n(()=>[q("返回")]),_:1})]),_:1})])]),_:1})}}});const _e=te(ue,[["__scopeId","data-v-6eabb9c6"]]);export{_e as default};
