import{b as A}from"./browser-e933942f.js";import{d as j,a as se,q as ie,m as re,E as pe,s as de,v as ce,M as ue,b as _e,r,o as p,e as b,g as o,w as a,c as e,l as u,f as l,t as c,F as me,j as ge,i as m,z as x,h as L,ab as fe,V as ve,A as ye,k as N}from"./index-8a2cb146.js";import{_ as he}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{_ as we}from"./zsPreviewDumplingDate.vue_vue_type_script_setup_true_name_ZsPreviewDumplingDate_lang-410dbbba.js";import{_ as be}from"./index.vue_vue_type_script_setup_true_name_ZsPreviewSupplier_lang-c781d4ca.js";import{L as P}from"./line-7661aa01.js";import"./index-2bbe694f.js";import"./zsRoutePrice-e3a5f38b.js";const xe="/assets/view1-faa60ca9.jpg",Ce="/assets/view2-ec9a083f.jpg",ke="/assets/view3-c8ed19c8.jpg",De={class:"box-flex"},Ne={key:0,src:xe,width:"192",height:"120"},Pe={key:1,src:Ce,width:"192",height:"120"},Te={key:2,src:ke,width:"192",height:"120"},Ve={style:{"margin-left":"20px"},class:"box-flex-c jc-sb"},Se={style:{"font-size":"20px"}},ze={style:{"margin-left":"20px"}},$e={class:"box-flex"},Re=l("span",{style:{margin:"0 10px"}},"｜",-1),Ue=l("span",{style:{margin:"0 10px"}},"｜",-1),Ae=l("span",{style:{margin:"0 10px"}},"｜",-1),Le=l("span",{style:{margin:"0 10px"}},"｜",-1),je=l("div",null,"最近出发时间：",-1),Be=l("span",{style:{margin:"0 10px"}},"｜",-1),qe=l("span",{style:{margin:"0 10px"}},"｜",-1),Ie={class:"flex1 box-flex-c ai-fe jc-sb"},Fe=l("div",{class:"flex1"},null,-1),Me=j({name:"RegistrationPlanTourism"}),Xe=j({...Me,setup(Oe){const{getDictionaryItem:B}=se(),{vAuthority:v}=ie(),q=re(),{warningModal:T}=ye(),[V,C]=pe(null),{form:i,resetForm:I}=de(()=>({routeName:"",travelType:"",supName:"",travelDays:"",areaNo:"",qrUrl:""}),()=>z()),{selectRow:S,tableBaseOptions:f,resetData:z,setSelectRow:k,changeTableColumn:F,changeTableSize:M}=ce([],()=>E()),{data:$}=ue(async()=>{const{res:n,err:t}=await N(()=>P.getApplicationSelect());return t?{}:n==null?void 0:n.data},{regionList:[],supplierList:[]}),{data:O,loading:Z,initData:E}=_e(async()=>{const{res:n,err:t}=await N(()=>P.getApplicationList({...i.value,currentPage:f.pagination.current,pageSize:f.pagination.pageSize,pagingOrNot:"1"}));return t?[]:(f.pagination.total=n.data.totalCount,n==null?void 0:n.data.travelRouteList.map(g=>({...g,validDate:g.validDate.split("|")})))}),K=n=>{window.open(`/trip?id=${n.id}`)},Q=async(n,t)=>{n?i.value.qrUrl=await A.toDataURL(`${window.location.origin}/trip?id=${t.id}`,{margin:1}):i.value.qrUrl=""},G=async n=>{const t=await A.toDataURL(`${window.location.origin}/trip?id=${n.id}`,{margin:1});fe(t,n.routeName)},H=()=>ve.warning("功能暂未开放"),R=async n=>{const{err:t}=await N(()=>P.verifyApplication({id:n}));t?T(`当前线路未上传行程单附件，请联系供应商。
			建议供应商重新添加一条线路,或联系平台经理后重新编辑当前线路。
			`,async g=>{g(!0)}):q.push(`/registrationPlan/tourism/operate?id=${n}`)},J=n=>{n.adjustState!=="1"?T("当前线路正在调价，报名前请和供应商确认价格，确定仍要报名吗?",async t=>{R(n.id),t(!0)}):R(n.id)};return(n,t)=>{const g=r("a-input"),y=r("a-form-item"),h=r("a-grid-item"),D=r("a-select"),W=r("a-grid"),X=r("a-form"),Y=r("a-tag"),ee=r("a-overflow-list"),ae=r("a-link"),w=r("a-button"),te=r("a-image"),oe=r("a-popover"),U=r("a-space"),ne=r("a-list-item"),le=r("a-list");return p(),b("div",null,[o(he,{fold:"","is-table-control":!1,"table-size":e(f).size,onResetSearch:e(I),onSearch:e(z),onChangeTableSize:e(M),onChangeTableColumn:e(F)},{form:a(({collapsed:s})=>[o(X,{model:e(i),"label-align":"left",size:"large","auto-label-width":""},{default:a(()=>[o(W,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!s},{default:a(()=>[o(h,null,{default:a(()=>[o(y,{label:"线路:"},{default:a(()=>[o(g,{modelValue:e(i).routeName,"onUpdate:modelValue":t[0]||(t[0]=d=>e(i).routeName=d),placeholder:"请输入线路"},null,8,["modelValue"])]),_:1})]),_:1}),o(h,null,{default:a(()=>[o(y,{label:"旅行分类:"},{default:a(()=>[o(D,{modelValue:e(i).travelType,"onUpdate:modelValue":t[1]||(t[1]=d=>e(i).travelType=d),placeholder:"请选择旅行分类"},null,8,["modelValue"])]),_:1})]),_:1}),o(h,null,{default:a(()=>[o(y,{label:"供应商名称:"},{default:a(()=>[o(D,{modelValue:e(i).supName,"onUpdate:modelValue":t[2]||(t[2]=d=>e(i).supName=d),"allow-search":"",options:e($).supplierList,"field-names":{label:"supName",value:"supName"},"virtual-list-props":{height:200},placeholder:"请选择供应商名称"},null,8,["modelValue","options"])]),_:1})]),_:1}),o(h,null,{default:a(()=>[o(y,{label:"旅行天数:"},{default:a(()=>[o(g,{modelValue:e(i).travelDays,"onUpdate:modelValue":t[3]||(t[3]=d=>e(i).travelDays=d),placeholder:"请输入旅行天数"},null,8,["modelValue"])]),_:1})]),_:1}),o(h,null,{default:a(()=>[o(y,{label:"地区:"},{default:a(()=>[o(D,{modelValue:e(i).areaNo,"onUpdate:modelValue":t[4]||(t[4]=d=>e(i).areaNo=d),"allow-search":"",options:e($).regionList,"field-names":{label:"cityName",value:"provinceCode"},"virtual-list-props":{height:200},placeholder:"请选择地区"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),table:a(()=>[o(le,{"pagination-props":e(f).pagination,bordered:e(f).bordered,data:e(O),loading:e(Z)},{item:a(({item:s,index:d})=>[(p(),u(ne,{key:s.id},{default:a(()=>[l("div",De,[d%2===1?(p(),b("img",Ne)):d%3===2?(p(),b("img",Pe)):(p(),b("img",Te)),l("div",Ve,[l("div",Se,[l("span",null,"编号: "+c(s.id),1),l("span",ze,c(s.routeName),1)]),l("div",$e,[l("span",null,"分类："+c(e(B)("travelType",s.travelType).detailName),1),Re,l("span",null,"天数："+c(s.travelDays)+"天",1),Ue,l("span",null,"出发地点："+c(s.departurePlace??"-"),1),Ae,l("span",null,"目的地："+c(s.arrival),1),Le,o(ee,{style:{width:"400px"}},{default:a(()=>[je,(p(!0),b(me,null,ge(s.validDate,_=>(p(),u(Y,{key:s},{default:a(()=>[m(c(_),1)]),_:2},1024))),128))]),_:2},1024)]),l("div",null,[l("span",null,[m("供应商名称： "),o(ae,{onClick:_=>e(k)({id:s.supId},()=>e(C)("ZsPreviewSupplier"))},{default:a(()=>[m(c(s.supName),1)]),_:2},1032,["onClick"])]),Be,l("span",null,"地区："+c(s.areaName),1),qe,l("span",null,"成团类别： "+c(s.groupType==="1"?"单团":"散客"),1)])]),l("div",Ie,[Fe,o(U,{class:"flex1",align:"center",size:"mini"},{default:a(()=>[x((p(),u(w,{type:"text",size:"mini",onClick:_=>e(k)(s,()=>e(C)("ZsPreviewDumplingDate"))},{default:a(()=>[m("查看出团日期")]),_:2},1032,["onClick"])),[[e(v),"RegistrationPlanTourismPreviewTime"]]),x((p(),u(w,{type:"text",size:"mini",status:"warning",onClick:_=>K(s)},{default:a(()=>[m("查看行程单")]),_:2},1032,["onClick"])),[[e(v),"RegistrationPlanTourismPreviewItinerary"]]),o(oe,{onPopupVisibleChange:_=>Q(_,s)},{content:a(()=>[o(te,{src:e(i).qrUrl,width:"100",height:"100"},null,8,["src"])]),default:a(()=>[x((p(),u(w,{type:"text",status:"success",onClick:_=>G(s)},{default:a(()=>[m("二维码")]),_:2},1032,["onClick"])),[[e(v),"RegistrationPlanTourismQrCode"]])]),_:2},1032,["onPopupVisibleChange"])]),_:2},1024),o(U,{class:"flex1",align:"center",size:"mini"},{default:a(()=>[x((p(),u(w,{size:"mini",type:"primary",onClick:_=>J(s)},{default:a(()=>[m("报名下单")]),_:2},1032,["onClick"])),[[e(v),"RegistrationPlanTourismApplicationOrder"]]),x((p(),u(w,{size:"mini",status:"success",onClick:H},{default:a(()=>[m("行程打印")]),_:1})),[[e(v),"RegistrationPlanTourismPrint"]])]),_:2},1024)])])]),_:2},1024))]),_:1},8,["pagination-props","bordered","data","loading"])]),_:1},8,["table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(V)==="ZsPreviewDumplingDate"?(p(),u(we,{key:0,data:e(S),onClose:t[5]||(t[5]=s=>e(k)({},()=>e(C)("")))},null,8,["data"])):L("",!0),e(V)==="ZsPreviewSupplier"?(p(),u(be,{key:1,data:e(S),onClose:t[6]||(t[6]=s=>e(k)({},()=>e(C)("")))},null,8,["data"])):L("",!0)])}}});export{Xe as default};
