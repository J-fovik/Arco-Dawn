import{d as $,h as J,i as Q,k as h,r as s,o as _,l as A,w as l,a as t,b as e,c as B,A as W,F as X,m as y,n as oe,j as ne,e as q,p as re,q as se}from"./index-d007178a.js";import{A as E}from"./options-aafac76d.js";import{f as S,t as G,a as H,c as ie,_ as de}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-430f1ffc.js";import{V as b}from"./vip-3bf0329d.js";import"./index-13860ba0.js";const ue=()=>[{title:"序号",width:80,dataIndex:"sortTableNo",show:!0,align:"center"},{title:"商品大类",dataIndex:"cardLargeCategory",show:!0,align:"center",render:({record:u})=>S(u.cardLargeCategory)},{title:"商品类型",dataIndex:"cardType",show:!0,align:"center",render:({record:u})=>S(u.cardType)},{title:"原始价格",dataIndex:"originalPrice",show:!0,align:"right",render:({record:u})=>G(H(u.originalPrice))},{title:"销售价格",dataIndex:"sellingPrice",show:!0,align:"right",render:({record:u})=>G(H(u.sellingPrice))},{title:"增加时间",dataIndex:"updateTime",show:!0,align:"center",render:({record:u})=>S(u.updateTime)},{title:"商品说明",dataIndex:"remark",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:u})=>S(u.remark)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],ce=$({name:"zsAddAgent"}),ge=$({...ce,props:{data:{default:()=>({})}},emits:["close","success"],setup(u,{emit:V}){const m=u,[T,g]=J(null),{form:i,formRef:x}=Q(()=>({...m.data})),I={cardLargeCategory:{required:!0,message:"请选择商品大类"},cardType:{required:!0,message:"请选择商品类型"},sellingPrice:{required:!0,message:"请输入销售价格"},originalPrice:{required:!0,message:"请输入原始价格"}},K=()=>{x.value.validate(c=>{c||(m.data.id?k("editPrice"):k("addPrice"))})},r=h([]),v=h([]),N=async()=>{const{res:c,err:o}=await y(()=>b.getVipCategory({}),{successMsg:""});o||(r.value=c==null?void 0:c.data)},w=async()=>{const{res:c,err:o}=await y(()=>b.getVipType({cardLargeCategory:i.value.cardLargeCategory}),{successMsg:""});o||(v.value=c==null?void 0:c.data)};N(),w();const D=()=>{i.value.cardType="",v.value=[],w()},k=async c=>{const{err:o}=await y(()=>b[c](i.value),{before:()=>g("okLoading"),after:()=>g(null)});o||(V("success"),V("close"))};return(c,o)=>{const C=s("a-option"),z=s("a-select"),f=s("a-form-item"),P=s("a-input-number"),F=s("a-textarea"),M=s("a-form"),L=s("a-modal");return _(),A(L,{top:"10%",width:"500px",title:e(ie)("价格",!!m.data.id),"unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(T)==="okLoading",onCancel:o[6]||(o[6]=a=>V("close")),onOk:K},{default:l(()=>[t(M,{ref_key:"formRef",ref:x,model:e(i),"label-align":"left",size:"large","auto-label-width":"",rules:I},{default:l(()=>[t(f,{field:"cardLargeCategory",label:"商品大类:"},{default:l(()=>[t(z,{disabled:!!m.data.id,modelValue:e(i).cardLargeCategory,"onUpdate:modelValue":o[0]||(o[0]=a=>e(i).cardLargeCategory=a),placeholder:"请选择大类",onChange:o[1]||(o[1]=a=>D())},{default:l(()=>[(_(!0),B(X,null,W(r.value,a=>(_(),A(C,{value:a.value,label:a.label,key:a.value},null,8,["value","label"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1}),t(f,{field:"cardType",label:"商品类型:"},{default:l(()=>[t(z,{disabled:!!m.data.id,modelValue:e(i).cardType,"onUpdate:modelValue":o[2]||(o[2]=a=>e(i).cardType=a),options:[...v.value],placeholder:"请选择商品类型"},null,8,["disabled","modelValue","options"])]),_:1}),t(f,{field:"originalPrice",label:"原始价格:"},{default:l(()=>[t(P,{modelValue:e(i).originalPrice,"onUpdate:modelValue":o[3]||(o[3]=a=>e(i).originalPrice=a),modelModifiers:{trim:!0},placeholder:"请输入原始价格",precision:2},null,8,["modelValue"])]),_:1}),t(f,{field:"sellingPrice",label:"销售价格:"},{default:l(()=>[t(P,{modelValue:e(i).sellingPrice,"onUpdate:modelValue":o[4]||(o[4]=a=>e(i).sellingPrice=a),modelModifiers:{trim:!0},placeholder:"请输入销售价格",precision:2},null,8,["modelValue"])]),_:1}),t(f,{field:"remark",label:"商品说明:"},{default:l(()=>[t(F,{modelValue:e(i).remark,"onUpdate:modelValue":o[5]||(o[5]=a=>e(i).remark=a),placeholder:"请输入商品说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","ok-loading"])}}}),pe=$({name:"VipAgentManage"}),Ce=$({...pe,setup(u){const{warningModal:V}=se(),[m,T]=J(null),{form:g,resetForm:i}=Q(()=>({cardType:"",cardLargeCategory:""}),()=>v()),{selectRow:x,columnsData:I,visibleColumnsData:K,tableBaseOptions:r,resetData:v,extendTableList:N,setSelectRow:w,changeTableColumn:D,changeTableSize:k}=oe(ue(),()=>L()),c=()=>{V(`确定操作选中的${r.selectedKeys.length}数据吗？`,async a=>{await y(()=>b.deletePrice({ids:r.selectedKeys})),a(!0),r.selectedKeys=[],L()})},o=h([]),C=h([]),z=async()=>{const{res:a,err:n}=await y(()=>b.getVipCategory({}),{successMsg:""});n||(o.value=a==null?void 0:a.data)},f=async()=>{const{res:a,err:n}=await y(()=>b.getVipType({cardLargeCategory:g.value.cardLargeCategory}));n||(C.value=a==null?void 0:a.data)};z(),f();const P=()=>{g.value.cardType="",C.value=[],f()},{data:F,loading:M,initData:L}=ne(async()=>{const{res:a,err:n}=await y(()=>b.getPriceList({...g.value,currentPage:r.pagination.current,pageSize:r.pagination.pageSize,pagingOrNot:"1"}));if(n)return[];r.pagination.total=a.data.totalCount;const R=a==null?void 0:a.data.list.map(p=>(p.sellingPrice!==void 0&&p.originalPrice!==void 0&&(p.sellingPrice=Number(p.sellingPrice),p.originalPrice=Number(p.originalPrice)),p));return N(R)});return(a,n)=>{const R=s("a-option"),p=s("a-select"),O=s("a-form-item"),j=s("a-grid-item"),Y=s("a-grid"),Z=s("a-form"),ee=s("icon-plus"),U=s("a-button"),ae=s("icon-close"),te=s("a-space"),le=s("a-table");return _(),B("div",null,[t(de,{"table-columns":e(I),"table-size":e(r).size,onResetSearch:e(i),onSearch:e(v),onChangeTableSize:e(k),onChangeTableColumn:e(D)},{form:l(()=>[t(Z,{model:e(g),"label-align":"left",size:"large","auto-label-width":""},{default:l(()=>[t(Y,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:l(()=>[t(j,null,{default:l(()=>[t(O,{label:"商品大类:"},{default:l(()=>[t(p,{modelValue:e(g).cardLargeCategory,"onUpdate:modelValue":n[0]||(n[0]=d=>e(g).cardLargeCategory=d),placeholder:"请选择大类",onChange:n[1]||(n[1]=d=>P())},{default:l(()=>[(_(!0),B(X,null,W([...e(E),...o.value],d=>(_(),A(R,{value:d.value,label:d.label},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(j,null,{default:l(()=>[t(O,{label:"商品类型:"},{default:l(()=>[t(p,{modelValue:e(g).cardType,"onUpdate:modelValue":n[2]||(n[2]=d=>e(g).cardType=d),options:[...e(E),...C.value]},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),operate:l(()=>[t(te,null,{default:l(()=>[t(U,{type:"outline",onClick:n[3]||(n[3]=d=>e(T)("zsAddPrice"))},{icon:l(()=>[t(ee)]),default:l(()=>[q(" 新增 ")]),_:1}),t(U,{type:"outline",status:"danger",disabled:!e(r).selectedKeys.length,loading:e(m)==="删除",onClick:n[4]||(n[4]=d=>c())},{icon:l(()=>[t(ae)]),default:l(()=>[q(" 删除 ")]),_:1},8,["disabled","loading"])]),_:1})]),table:l(()=>[t(le,{"selected-keys":e(r).selectedKeys,"onUpdate:selectedKeys":n[5]||(n[5]=d=>e(r).selectedKeys=d),class:"zs-table","row-key":"id",data:e(F),"row-selection":e(r).rowSelection,bordered:e(r).bordered,pagination:e(r).pagination,size:e(r).size,columns:e(K),stripe:e(r).stripe,loading:e(M)},{operate:l(({record:d})=>[t(U,{type:"text",onClick:me=>e(w)(d,()=>e(T)("zsAddPrice"))},{default:l(()=>[q("编辑")]),_:2},1032,["onClick"])]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(m)==="zsAddPrice"?(_(),A(ge,{key:0,data:e(x),onSuccess:e(L),spdlList:o.value,splxList:C.value,onChange:n[6]||(n[6]=d=>P()),onClose:n[7]||(n[7]=d=>e(w)({},()=>e(T)(null)))},null,8,["data","onSuccess","spdlList","splxList"])):re("",!0)])}}});export{Ce as default};
