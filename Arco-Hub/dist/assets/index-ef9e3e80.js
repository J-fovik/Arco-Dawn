import{a as F,n as U,p as Q,O as W,d as w,E as M,s as B,r as s,o as _,l as b,w as t,g as a,c as e,i as D,k as h,_ as X,q as ee,u as te,m as ae,b as oe,v as ne,x as le,y as se,e as ie,f as re,t as ue,z as P,h as C,S as de}from"./index-8a2cb146.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{_ as me,a as pe}from"./index.vue_vue_type_script_setup_true_name_ZsGroupOrder_lang-98fff533.js";import{B as O}from"./business-b0ce0e8a.js";import"./index-2bbe694f.js";import"./finance-4d2c7da5.js";const fe=()=>{const{getDictionaryItem:S}=F();return[{title:"营业部名称",dataIndex:"departName",show:!0,align:"center",render:({record:i})=>U(i.departName)},{title:"团号",show:!0,ellipsis:!0,tooltip:!0,slotName:"groupNo",align:"center"},{title:"开票金额(元)",dataIndex:"applyMoney",show:!0,align:"right",render:({record:i})=>Q("span",{class:"text-red text-price"},W(`${i.applyMoney}`))},{title:"开票项目",dataIndex:"invoItems",show:!0,align:"center",render:({record:i})=>U(S("invoItems",i.invoItems).detailName)},{title:"申请开票时间",dataIndex:"createTime",show:!0,align:"center",render:({record:i})=>U(i.createTime)},{title:"审核状态",dataIndex:"auditState",show:!0,align:"center",render:({record:i})=>U(S("invoiceAuditState",i.auditState).detailName)},{title:"操作",width:260,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}]},_e=w({name:"ZsExamineInvoicing"}),ge=w({..._e,props:{data:{default:()=>({})}},emits:["close","success"],setup(S,{emit:i}){const V=S,f=i,[g,u]=M(null),{form:d,formRef:r}=B(()=>({auditState:"4",auditRemark:""})),N={auditRemark:{required:!1,validator:(m,o)=>{d.value.auditState==="1"&&o("审核驳回时备注必填")}}},v=()=>{r.value.validate(m=>{m||$()})},$=async()=>{const{err:m}=await h(()=>O.examineInvoiceFinance({id:V.data.id,...d.value}),{before:()=>u("okLoading"),after:()=>u(""),successMsg:"操作成功"});m||(f("success"),f("close"))};return(m,o)=>{const y=s("a-radio"),L=s("a-radio-group"),c=s("a-form-item"),z=s("a-textarea"),k=s("a-form"),A=s("a-modal");return _(),b(A,{width:"600px",top:"10%","unmount-on-close":"",visible:"","align-center":!1,title:"审核开票","mask-closable":!1,"ok-loading":e(g)==="okLoading",onCancel:o[2]||(o[2]=I=>f("close")),onOk:v},{default:t(()=>[a(k,{ref_key:"formRef",ref:r,model:e(d),"label-align":"left",size:"large","auto-label-width":"",rules:N},{default:t(()=>[a(c,{field:"auditState",label:"审核:"},{default:t(()=>[a(L,{modelValue:e(d).auditState,"onUpdate:modelValue":o[0]||(o[0]=I=>e(d).auditState=I)},{default:t(()=>[a(y,{value:"4"},{default:t(()=>[D("通过")]),_:1}),a(y,{value:"3"},{default:t(()=>[D("驳回")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{field:"auditRemark",label:"备注:"},{default:t(()=>[a(z,{modelValue:e(d).auditRemark,"onUpdate:modelValue":o[1]||(o[1]=I=>e(d).auditRemark=I),modelModifiers:{trim:!0},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),ve=w({name:"ZsUploadInvoicing"}),be=w({...ve,props:{data:{default:()=>({})}},emits:["close","success"],setup(S,{emit:i}){const V=S,f=i,[g,u]=M(null),{form:d,formRef:r}=B(()=>({fileList:[]})),N={fileList:{required:!0,message:"请至少上传一张发票"}},v=()=>{r.value.validate(m=>{m||$()})},$=async()=>{const{err:m}=await h(()=>O.uploadInvoiceFile({id:V.data.id,fileList:d.value.fileList.map(o=>o.file)}),{before:()=>u("okLoading"),after:()=>u(""),successMsg:"操作成功"});m||(f("success"),f("close"))};return(m,o)=>{const y=s("a-upload"),L=s("a-form-item"),c=s("a-form"),z=s("a-modal");return _(),b(z,{width:"600px",top:"10%","unmount-on-close":"",visible:"","align-center":!1,title:"上传发票","mask-closable":!1,"ok-loading":e(g)==="okLoading",onCancel:o[1]||(o[1]=k=>f("close")),onOk:v},{default:t(()=>[a(c,{ref_key:"formRef",ref:r,model:e(d),"label-align":"left",size:"large","auto-label-width":"",rules:N},{default:t(()=>[a(L,{field:"fileList",label:"审核:"},{default:t(()=>[a(y,{"file-list":e(d).fileList,"onUpdate:fileList":o[0]||(o[0]=k=>e(d).fileList=k),"auto-upload":!1,accept:".pdf,.png,.jpeg",multiple:"","show-retry-button":!1},null,8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}});const Se=X(be,[["__scopeId","data-v-07689748"]]),ye=["onClick"],ke=w({name:"InvoicesInvoicingFinance"}),$e=w({...ke,setup(S){const{vAuthority:i}=ee(),V=te(),f=ae(),[g,u]=M(null),{getDictionaryInfo:d}=F(),{form:r,resetForm:N}=B(()=>({groupId:"",departName:"",departCode:"",auditState:""}),()=>y());oe(async()=>{const{err:p,res:n}=await h(()=>de.getDepartmentList({departType:"1"}));return p?[]:n==null?void 0:n.data},[]);const{selectRow:v,columnsData:$,visibleColumnsData:m,tableBaseOptions:o,resetData:y,extendTableList:L,setSelectRow:c,changeTableColumn:z,changeTableSize:k}=ne(fe(),()=>x()),{data:A,loading:I,initData:x}=le(async()=>{const{res:p,err:n}=await h(()=>O.getInvoiceFinanceExamineList({...r.value,currentPage:o.pagination.current,pageSize:o.pagination.pageSize}));if(!n)return o.pagination.total=p.data.totalCount,p==null?void 0:p.data.invoiceList}),q=p=>{p.groupNo.indexOf(",")>-1?c(p,()=>u("ZsGroupOrder")):f.push(`/order/tradeManage/operate/?routeId=${p.routeId}&groupId=${p.groupNo}&name=${V.name}`)};return se(x),(p,n)=>{const Z=s("a-input"),R=s("a-form-item"),T=s("a-grid-item"),G=s("a-select"),j=s("a-grid"),Y=s("a-form"),E=s("a-button"),H=s("a-button-group"),J=s("a-table");return _(),ie("div",null,[a(ce,{"table-columns":e($),"table-size":e(o).size,onResetSearch:e(N),onSearch:e(y),onChangeTableSize:e(k),onChangeTableColumn:e(z)},{form:t(()=>[a(Y,{model:e(r),"label-align":"left",size:"large","auto-label-width":""},{default:t(()=>[a(j,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:t(()=>[a(T,null,{default:t(()=>[a(R,{label:"团号:"},{default:t(()=>[a(Z,{modelValue:e(r).groupId,"onUpdate:modelValue":n[0]||(n[0]=l=>e(r).groupId=l),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),a(T,null,{default:t(()=>[a(R,{label:"部门名称:"},{default:t(()=>[a(Z,{modelValue:e(r).departName,"onUpdate:modelValue":n[1]||(n[1]=l=>e(r).departName=l),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),a(T,null,{default:t(()=>[a(R,{label:"部门代码:"},{default:t(()=>[a(Z,{modelValue:e(r).departCode,"onUpdate:modelValue":n[2]||(n[2]=l=>e(r).departCode=l),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),a(T,null,{default:t(()=>[a(R,{label:"审核状态:"},{default:t(()=>[a(G,{modelValue:e(r).auditState,"onUpdate:modelValue":n[3]||(n[3]=l=>e(r).auditState=l),options:e(d)("invoiceAuditState"),"field-names":{label:"detailName",value:"detailCode"},placeholder:"请选择审核状态"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),table:t(()=>[a(J,{"selected-keys":e(o).selectedKeys,"onUpdate:selectedKeys":n[4]||(n[4]=l=>e(o).selectedKeys=l),class:"zs-table","row-key":"id",data:e(A),"row-selection":e(o).rowSelection,bordered:e(o).bordered,pagination:e(o).pagination,size:e(o).size,columns:e(m),stripe:e(o).stripe,loading:e(I)},{groupNo:t(({record:l})=>[re("span",{class:"text-link",onClick:K=>q(l)},ue(l.groupNo),9,ye)]),operate:t(({record:l})=>[a(H,null,{default:t(()=>[a(E,{type:"text",status:"success",onClick:K=>e(c)(l,()=>e(u)("ZsPreviewInvoicing"))},{default:t(()=>[D("查看开票信息")]),_:2},1032,["onClick"]),["2"].includes(l.auditState)?P((_(),b(E,{key:0,type:"text",onClick:K=>e(c)(l,()=>e(u)("ZsExamineInvoicing"))},{default:t(()=>[D("审核")]),_:2},1032,["onClick"])),[[e(i),"InvoicesInvoicingPlatformExamine"]]):C("",!0),["4"].includes(l.auditState)?P((_(),b(E,{key:1,type:"text",onClick:K=>e(c)(l,()=>e(u)("ZsUploadInvoicing"))},{default:t(()=>[D("上传电子发票")]),_:2},1032,["onClick"])),[[e(i),"InvoicesInvoicingPlatformUpload"]]):C("",!0)]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(g)==="ZsPreviewInvoicing"?(_(),b(me,{key:0,data:e(v),onClose:n[5]||(n[5]=l=>e(c)({},()=>e(u)(""))),onSuccess:e(x)},null,8,["data","onSuccess"])):C("",!0),e(g)==="ZsGroupOrder"?(_(),b(pe,{key:1,data:e(v),onClose:n[6]||(n[6]=l=>e(c)({},()=>e(u)(""))),onSuccess:e(x)},null,8,["data","onSuccess"])):C("",!0),e(g)==="ZsExamineInvoicing"?(_(),b(ge,{key:2,data:e(v),onClose:n[7]||(n[7]=l=>e(c)({},()=>e(u)(""))),onSuccess:e(x)},null,8,["data","onSuccess"])):C("",!0),e(g)==="ZsUploadInvoicing"?(_(),b(Se,{key:3,data:e(v),onClose:n[8]||(n[8]=l=>e(c)({},()=>e(u)(""))),onSuccess:e(x)},null,8,["data","onSuccess"])):C("",!0)])}}});export{$e as default};
