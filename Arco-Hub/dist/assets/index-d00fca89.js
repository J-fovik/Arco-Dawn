import{d as q,h as G,i as H,k as J,j as R,r as d,o as v,l as h,w as a,a as l,b as e,c as j,A as Q,F as W,p as Y,m as I,O as L,n as ie,e as C,q as me}from"./index-d007178a.js";import{f as X,A as ce}from"./options-aafac76d.js";import{f as O,h as pe,c as ge,_ as fe}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-430f1ffc.js";import{p as be}from"./rules-f293393f.js";import{V as ee}from"./vip-3bf0329d.js";import"./index-13860ba0.js";const _e=[{label:"禁用",value:"0"},{label:"启用",value:"1"}],ve=()=>[{title:"序号",width:80,dataIndex:"sortTableNo",show:!0,align:"center"},{title:"登录账号",dataIndex:"loginName",show:!0,align:"center",render:({record:c})=>O(c.loginName)},{title:"姓名",dataIndex:"userName",show:!0,align:"center",render:({record:c})=>O(c.userName)},{title:"手机号",dataIndex:"phoneNumber",show:!0,align:"center",render:({record:c})=>O(c.phoneNumber)},{title:"用户角色",dataIndex:"roleName",show:!0,align:"center",render:({record:c})=>O(c.roleName)},{title:"启用状态",dataIndex:"disableStatus",show:!0,align:"center",slotName:"disableStatus"},{title:"创建时间",dataIndex:"createTime",show:!0,align:"center",render:({record:c})=>pe(c.createTime)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],Ne=q({name:"ZsAddUser"}),Ve=q({...Ne,props:{data:{default:()=>({})},roleList:null},emits:["close","success"],setup(c,{emit:k}){const b=c,[V,o]=G(null),{form:u,formRef:z}=H(()=>({...b.data})),P={loginName:{required:!0,message:"请输入登录名"},phoneNumber:{required:!1,validator:(p,n)=>{p&&!be(p)&&n("请输入正确的手机号")}},roleId:{required:!0,message:"请选择角色"},agentId:{required:!0,message:"请选择代理商"}},M=()=>{z.value.validate(p=>{p||(b.data.id?S("editUser"):S("addUser"))})},s=J(""),T=()=>{s.value=b.roleList.filter(p=>p.value==u.value.roleId)[0].label,s.value!=="代理商"&&(u.value.agentId="")},{data:B}=R(async()=>{const{res:p,err:n}=await I(()=>ee.getAgentList({status:"1"}));return n?[]:p.data.list.map(_=>({label:_.agentName,value:_.id}))}),S=async p=>{const{err:n}=await I(()=>L[p](u.value),{before:()=>o("okLoading"),after:()=>o(null)});n||(k("success"),k("close"))};return(p,n)=>{const _=d("a-input"),N=d("a-form-item"),y=d("a-option"),A=d("a-select"),D=d("a-textarea"),F=d("a-form"),Z=d("a-modal");return v(),h(Z,{top:"10%",width:"500px",title:e(ge)("用户",!!b.data.id),"unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(V)==="okLoading",onCancel:n[7]||(n[7]=U=>k("close")),onOk:M},{default:a(()=>[l(F,{ref_key:"formRef",ref:z,model:e(u),"label-align":"left",size:"large","auto-label-width":"",rules:P},{default:a(()=>{var U;return[l(N,{field:"loginName",label:"登录账号:",required:""},{default:a(()=>[l(_,{modelValue:e(u).loginName,"onUpdate:modelValue":n[0]||(n[0]=r=>e(u).loginName=r),disabled:!!b.data.id,placeholder:"请输入登录账号"},null,8,["modelValue","disabled"])]),_:1}),l(N,{field:"userName",label:"姓名:"},{default:a(()=>[l(_,{modelValue:e(u).userName,"onUpdate:modelValue":n[1]||(n[1]=r=>e(u).userName=r),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(N,{field:"phoneNumber",label:"手机号:"},{default:a(()=>[l(_,{modelValue:e(u).phoneNumber,"onUpdate:modelValue":n[2]||(n[2]=r=>e(u).phoneNumber=r),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(N,{field:"roleId",label:"角色:",required:""},{default:a(()=>[l(A,{disabled:!!b.data.id,modelValue:e(u).roleId,"onUpdate:modelValue":n[3]||(n[3]=r=>e(u).roleId=r),placeholder:"请选择角色",onChange:n[4]||(n[4]=r=>T())},{default:a(()=>[(v(!0),j(W,null,Q(c.roleList,r=>(v(),h(y,{value:r.value,label:r.label,key:r.value},null,8,["value","label"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1}),((U=e(X)(c.roleList,e(u).roleId))==null?void 0:U.label)=="代理商"?(v(),h(N,{key:0,field:"agentId",label:"代理商:"},{default:a(()=>[l(A,{modelValue:e(u).agentId,"onUpdate:modelValue":n[5]||(n[5]=r=>e(u).agentId=r),options:e(B),"allow-search":"","allow-clear":"",placeholder:"请选择代理商"},null,8,["modelValue","options"])]),_:1})):Y("",!0),l(N,{field:"bz",label:"备注:"},{default:a(()=>[l(D,{modelValue:e(u).bz,"onUpdate:modelValue":n[6]||(n[6]=r=>e(u).bz=r),"max-length":200,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]}),_:1},8,["model"])]),_:1},8,["title","ok-loading"])}}}),we=q({name:"SystemUserManage"}),Ue=q({...we,setup(c){const{warningModal:k}=me(),[b,V]=G(null),{form:o,resetForm:u}=H(()=>({loginName:"",userName:"",nickName:"",phoneNumber:"",isCancel:"",roleId:"",agentId:""}),()=>T()),{selectRow:z,columnsData:P,visibleColumnsData:M,tableBaseOptions:s,resetData:T,extendTableList:B,setSelectRow:S,changeTableColumn:p,changeTableSize:n}=ie(ve(),()=>r()),_=m=>{k(`确定操作选中的${s.selectedKeys.length}数据吗？`,async t=>{const{err:g}=await I(()=>L[m]({idList:s.selectedKeys}),{successMsg:"操作成功"});g||(t(!0),s.selectedKeys=[],r())})},N=async m=>{const{err:t}=await I(()=>L.batchDisableUser({userIdList:[m.id],isCancel:m.isCancel==="0"?"1":"0"}),{before:()=>V(m.id),after:()=>V(null),successMsg:"操作成功"});t||r()},{data:y}=R(async()=>{const{res:m,err:t}=await I(()=>L.getRoleList({...o.value,currentPage:s.pagination.current,pageSize:s.pagination.pageSize,pagingOrNot:"0"}));return t?[]:m==null?void 0:m.data.roleList.map(g=>({label:g.uname,value:g.id}))}),{data:A}=R(async()=>{const{res:m,err:t}=await I(()=>ee.getAgentList({status:"1"}));return t?[]:m.data.list.map(g=>({label:g.agentName,value:g.id}))}),D=J(""),F=()=>{D.value=y.value.filter(m=>m.value==o.value.roleId)[0].label,D.value!=="代理商"&&(o.value.agentId="")},{data:Z,loading:U,initData:r}=R(async()=>{const{res:m,err:t}=await I(()=>L.getUserList({...o.value,currentPage:s.pagination.current,pageSize:s.pagination.pageSize,pagingOrNot:"1"}));return t?[]:(s.pagination.total=m.data.totalCount,B(m.data.userList))});return(m,t)=>{const g=d("a-input"),w=d("a-form-item"),x=d("a-grid-item"),le=d("a-option"),E=d("a-select"),ae=d("a-grid"),te=d("a-form"),ne=d("icon-plus"),$=d("a-button"),oe=d("icon-close"),se=d("icon-loop"),re=d("a-space"),de=d("a-switch"),ue=d("a-table");return v(),j("div",null,[l(fe,{fold:"","table-columns":e(P),"table-size":e(s).size,onResetSearch:e(u),onSearch:e(T),onChangeTableSize:e(n),onChangeTableColumn:e(p)},{form:a(({collapsed:f})=>[l(te,{model:e(o),"label-align":"left",size:"large","auto-label-width":""},{default:a(()=>[l(ae,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!f},{default:a(()=>{var K;return[l(x,null,{default:a(()=>[l(w,{label:"登录账号:"},{default:a(()=>[l(g,{modelValue:e(o).loginName,"onUpdate:modelValue":t[0]||(t[0]=i=>e(o).loginName=i),placeholder:"请输入登录账号"},null,8,["modelValue"])]),_:1})]),_:1}),l(x,null,{default:a(()=>[l(w,{label:"姓名:"},{default:a(()=>[l(g,{modelValue:e(o).userName,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).userName=i),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1}),l(x,null,{default:a(()=>[l(w,{label:"昵称:"},{default:a(()=>[l(g,{modelValue:e(o).nickName,"onUpdate:modelValue":t[2]||(t[2]=i=>e(o).nickName=i),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1}),l(x,null,{default:a(()=>[l(w,{label:"手机号:"},{default:a(()=>[l(g,{modelValue:e(o).phoneNumber,"onUpdate:modelValue":t[3]||(t[3]=i=>e(o).phoneNumber=i),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),l(w,{field:"roleId",label:"角色:"},{default:a(()=>[l(E,{modelValue:e(o).roleId,"onUpdate:modelValue":t[4]||(t[4]=i=>e(o).roleId=i),placeholder:"请选择角色",onChange:t[5]||(t[5]=i=>F())},{default:a(()=>[(v(!0),j(W,null,Q(e(y),i=>(v(),h(le,{value:i.value,label:i.label,key:i.value},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),((K=e(X)(e(y),e(o).roleId))==null?void 0:K.label)=="代理商"?(v(),h(w,{key:0,field:"agentId",label:"代理商:"},{default:a(()=>[l(E,{modelValue:e(o).agentId,"onUpdate:modelValue":t[6]||(t[6]=i=>e(o).agentId=i),options:e(A),"allow-search":"","allow-clear":"",placeholder:"请选择代理商"},null,8,["modelValue","options"])]),_:1})):Y("",!0),l(x,null,{default:a(()=>[l(w,{label:"启用状态:"},{default:a(()=>[l(E,{modelValue:e(o).isCancel,"onUpdate:modelValue":t[7]||(t[7]=i=>e(o).isCancel=i),options:[...e(ce),...e(_e)]},null,8,["modelValue","options"])]),_:1})]),_:1})]}),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),operate:a(()=>[l(re,null,{default:a(()=>[l($,{type:"outline",onClick:t[8]||(t[8]=f=>e(V)("ZsAddUser"))},{icon:a(()=>[l(ne)]),default:a(()=>[C(" 新增 ")]),_:1}),l($,{type:"outline",status:"danger",disabled:!e(s).selectedKeys.length,loading:e(b)==="删除",onClick:t[9]||(t[9]=f=>_("batchDeleteUser"))},{icon:a(()=>[l(oe)]),default:a(()=>[C(" 删除 ")]),_:1},8,["disabled","loading"]),l($,{type:"outline",status:"warning",disabled:!e(s).selectedKeys.length,loading:e(b)==="密码重置",onClick:t[10]||(t[10]=f=>_("batchResetPassword"))},{icon:a(()=>[l(se)]),default:a(()=>[C(" 密码重置 ")]),_:1},8,["disabled","loading"])]),_:1})]),table:a(()=>[l(ue,{"selected-keys":e(s).selectedKeys,"onUpdate:selectedKeys":t[11]||(t[11]=f=>e(s).selectedKeys=f),class:"zs-table","row-key":"id",data:e(Z),"row-selection":e(s).rowSelection,bordered:e(s).bordered,pagination:e(s).pagination,size:e(s).size,columns:e(M),stripe:e(s).stripe,loading:e(U)},{disableStatus:a(({record:f})=>[l(de,{size:"medium","model-value":f.isCancel==="1",onChange:K=>N(f)},{checked:a(()=>[C(" ON ")]),unchecked:a(()=>[C(" OFF ")]),_:2},1032,["model-value","onChange"])]),operate:a(({record:f})=>[l($,{type:"text",onClick:K=>e(S)(f,()=>e(V)("ZsAddUser"))},{default:a(()=>[C("编辑")]),_:2},1032,["onClick"])]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(b)==="ZsAddUser"?(v(),h(Ve,{key:0,data:e(z),"role-list":e(y),onSuccess:e(r),onClose:t[12]||(t[12]=f=>e(S)({},()=>e(V)(null)))},null,8,["data","role-list","onSuccess"])):Y("",!0)])}}});export{Ue as default};
