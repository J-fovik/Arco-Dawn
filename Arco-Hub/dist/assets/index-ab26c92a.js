import{a as ee,n as c,p as O,O as B,T as _e,d as q,a1 as ye,ae as be,R as ae,E as te,s as oe,r as u,o as f,l as v,w as l,g as t,c as e,i as I,h as z,k as U,P as J,A as se,_ as ve,m as re,u as we,v as ue,b as Ie,q as xe,M as Se,x as ke,y as Ve,e as X,z as F,F as le,f as Te,V as ne,S as Ne}from"./index-8a2cb146.js";import{_ as Ce}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{O as R}from"./order-70291d37.js";import"./index-2bbe694f.js";const he=()=>{const{getDictionaryItem:C}=ee();return[{title:"团号",dataIndex:"groupId",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.groupId)},{title:"营业部名称",dataIndex:"departName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.departName)},{title:"线路编号",dataIndex:"routeId",show:!0,align:"center",render:({record:n})=>O(_e,{color:"blue"},{default:()=>c(n.routeId)})},{title:"线路名称",dataIndex:"routeName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.routeName)},{title:"供应商",dataIndex:"supName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.supName)},{title:"订单状态",dataIndex:"state",show:!0,align:"center",render:({record:n})=>c(C("new_trade_order",n.state).detailName)},{title:"结算状态",dataIndex:"settleType",show:!0,align:"center",render:({record:n})=>c(C("signupSettleType",n.settleType).detailName)},{title:"行程天数",dataIndex:"days",show:!0,width:100,align:"right",render:({record:n})=>c(n.days)},{title:"报名人数",dataIndex:"totalNumber",show:!0,width:100,align:"right",render:({record:n})=>c(n.totalNumber)},{title:"订单同行总费用",dataIndex:"supsigCost",show:!0,align:"right",render:({record:n})=>O("span",{class:"text-red text-price"},B(`${n.supsigCost??0}`,"0"))},{title:"扣点（%）",dataIndex:"ratio",show:!0,align:"right",render:({record:n})=>O("span",{class:"text-green"},c(n.ratio)+"%")},{title:"供应商结算费用",dataIndex:"setMoney",show:!0,align:"right",render:({record:n})=>O("span",{class:"text-red text-price"},B(`${n.setMoney}`,"0"))},{title:"已结算金额",dataIndex:"setValue",show:!0,align:"right",render:({record:n})=>O("span",{class:"text-red text-price"},B(`${n.setValue}`,"0"))},{title:"创建时间",dataIndex:"createTimeStr",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.createTimeStr)},{title:"操作",width:400,dataIndex:"operate",slotName:"operate",show:!0,align:"left"}]},$e=q({name:"zsViewRecord"}),De=q({...$e,props:{data:{default:()=>({})}},emits:["close","success"],setup(C,{emit:n}){const{warningModal:k}=se(),V=C,$=ye(()=>be(V.data));ae([]);const[L,x]=te(null),{form:a,formRef:P}=oe(()=>({})),E={applySettleTotal:{required:!0,validator:(g,s)=>{!g&&a.value.radio!="default"&&s("金额不能为空！")}},img:{required:!0,validator:(g,s)=>{a.value.fileList.length==0&&s("请上传文件")}}},b=n,m=()=>{P.value.validate(g=>{g||j()})},j=()=>{const g=ae("");if(a.value.radio=="default")g.value=`本次结算申请金额为:${a.value.settleTotal}(元)确定申请结算当前订单吗?`;else{const s=a.value.settleTotal*1-a.value.applySettleTotal*1;g.value=`可计算总计${a.value.signCost}(元)。
 已结算金额${a.value.alreadySettle}(元)。
 本次申请结算金额${a.value.applySettleTotal}(元)。
 剩余结算金额${s}(元)。
 确定申请结算当前订单吗?`}k(g.value,async s=>{T(),s(!0)})},T=async()=>{const{err:g}=await U(()=>R.settleApplyOfSupplier({fileList:a.value.fileList.map(s=>s.file),settleType:a.value.radio=="default"?"1":"2",applySettleTotal:a.value.radio=="default"?a.value.settleTotal:a.value.applySettleTotal,groupIdList:$.value?V.data:[V.data.groupId]}),{before:()=>x("okLoading"),after:()=>x(""),successMsg:"操作成功"});g||(b("success"),b("close"))};return(async()=>{const{res:g,err:s}=await U(()=>R.supplierSettleApplyInfo({groupIdList:$.value?V.data:[V.data.groupId]}));s||(a.value={signCost:J(g.data.signCost,"0.00"),settleTotal:g.data.settleTotal,alreadySettle:J(g.data.alreadySettle,"0.00"),...g.data.supplier,radio:"default",fileList:[]})})(),(g,s)=>{const _=u("a-input"),d=u("a-form-item"),w=u("a-grid-item"),K=u("a-input-number"),A=u("a-radio"),N=u("a-radio-group"),G=u("a-upload"),M=u("a-grid"),Q=u("a-form"),W=u("a-modal");return f(),v(W,{title:"申请结算","unmount-on-close":"",visible:"","ok-text":"申请结算","align-center":!1,"mask-closable":!1,width:"80vw",height:"80wh","ok-loading":e(L)==="okLoading",onCancel:s[11]||(s[11]=o=>b("close")),onOk:m},{default:l(()=>[t(Q,{ref_key:"formRef",ref:P,model:e(a),"label-align":"left",size:"large","auto-label-width":"",rules:E},{default:l(()=>[t(M,{cols:2,"col-gap":24},{default:l(()=>[t(w,null,{default:l(()=>[t(d,{field:"signCost",label:"总费用(元):"},{default:l(()=>[t(_,{modelValue:e(a).signCost,"onUpdate:modelValue":s[0]||(s[0]=o=>e(a).signCost=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"supName",label:"供应商:"},{default:l(()=>[t(_,{modelValue:e(a).supName,"onUpdate:modelValue":s[1]||(s[1]=o=>e(a).supName=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"alreadySettle",label:"已结算(元):"},{default:l(()=>[t(_,{modelValue:e(a).alreadySettle,"onUpdate:modelValue":s[2]||(s[2]=o=>e(a).alreadySettle=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"applySettleTotal",label:"本次(元):"},{default:l(()=>[e(a).radio=="default"?(f(),v(K,{key:0,modelValue:e(a).settleTotal,"onUpdate:modelValue":s[3]||(s[3]=o=>e(a).settleTotal=o),formatter:o=>e(B)(o,""),parser:o=>o.replace(/,/g,""),precision:2,disabled:""},null,8,["modelValue","formatter","parser"])):(f(),v(K,{key:1,modelValue:e(a).applySettleTotal,"onUpdate:modelValue":s[4]||(s[4]=o=>e(a).applySettleTotal=o),formatter:o=>e(B)(o,""),parser:o=>o.replace(/,/g,""),precision:2,placeholder:"请输入本次(元)"},null,8,["modelValue","formatter","parser"]))]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"settleType",label:"结算类型:"},{default:l(()=>[t(N,{modelValue:e(a).radio,"onUpdate:modelValue":s[5]||(s[5]=o=>e(a).radio=o)},{default:l(()=>[t(A,{value:"default"},{default:l(()=>[I("默认")]),_:1}),$.value?z("",!0):(f(),v(A,{key:0,value:"custom"},{default:l(()=>[I("自定义")]),_:1}))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"settleUserName",label:"户名(公户):"},{default:l(()=>[t(_,{modelValue:e(a).settleUserName,"onUpdate:modelValue":s[6]||(s[6]=o=>e(a).settleUserName=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"settleNum",label:"账号:"},{default:l(()=>[t(_,{modelValue:e(a).settleNum,"onUpdate:modelValue":s[7]||(s[7]=o=>e(a).settleNum=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"settleBankName",label:"开户行:"},{default:l(()=>[t(_,{modelValue:e(a).settleBankName,"onUpdate:modelValue":s[8]||(s[8]=o=>e(a).settleBankName=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{field:"settleBankNo",label:"联行号:"},{default:l(()=>[t(_,{modelValue:e(a).settleBankNo,"onUpdate:modelValue":s[9]||(s[9]=o=>e(a).settleBankNo=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(d,{label:"上传文件",required:"",field:"img"},{default:l(()=>[t(G,{"file-list":e(a).fileList,"onUpdate:fileList":s[10]||(s[10]=o=>e(a).fileList=o),draggable:"",multiple:"","list-type":"picture",accept:".png,.jpg,.pdf","auto-upload":!1,"show-retry-button":!1,"show-link":!1},null,8,["file-list"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}});const ze=ve(De,[["__scopeId","data-v-83bac4e6"]]),Ue=()=>{const{getDictionaryItem:C}=ee();return[{title:"付款账户名称",dataIndex:"payUserName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.payUserName)},{title:"付款账户",dataIndex:"payNum",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.payNum)},{title:"收款账户名称",dataIndex:"receiveUserName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.receiveUserName)},{title:"收款账户",dataIndex:"receiveNum",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.receiveNum)},{title:"结算金额",dataIndex:"money",show:!0,ellipsis:!0,tooltip:!0,align:"right",render:({record:n})=>O("span",{class:"text-red text-price"},B(J(n.money)))},{title:"手续费",dataIndex:"sxf",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>O("span",{class:"text-red text-price"},B(J(n.sxf)))},{title:"费用分类",dataIndex:"costType",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.costType=="1"?"订单费用":n.costType=="2"?"保险费用":"")},{title:"结算状态",dataIndex:"settleType",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(C("signupSettleType",n.settleType).detailName)},{title:"结算方式",dataIndex:"setMode",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.setMode=="1"?"自动":"手动")},{title:"交易流水号",dataIndex:"pylsh",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.pylsh)},{title:"交易时间",dataIndex:"createTime",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:n})=>c(n.createTime)},{title:"操作",width:100,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}]},Le=q({name:"ZsSettlementRecords"}),Me=q({...Le,props:{data:{default:()=>({})}},emits:["close","success"],setup(C,{emit:n}){const k=re(),V=we(),$=C,[L,x]=te(null),a=n,{columnsData:P,visibleColumnsData:E,tableBaseOptions:b,setSelectRow:m,selectRow:j}=ue(Ue(),()=>g()),{data:T,loading:Y,initData:g}=Ie(async()=>{const{res:_,err:d}=await U(()=>R.getSettleRecordList({groupIdOnly:$.data.groupId,currentPage:b.pagination.current,pageSize:b.pagination.pageSize,pagingOrNot:"1"}));return d?[]:(b.pagination.total=_.data.totalCount,_==null?void 0:_.data.dataList)}),s=_=>{a("close"),k.push(`/finance/settlementRecord/operate?id=${_.id}&name=${V.name}`)};return(_,d)=>{const w=u("a-button"),K=u("a-table"),A=u("a-modal");return f(),v(A,{title:"结算记录列表","unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(L)==="okLoading",top:"10%",width:"80vw","ok-text":"返回",onCancel:d[1]||(d[1]=N=>a("close")),onOk:d[2]||(d[2]=N=>a("close"))},{default:l(()=>[t(K,{"selected-keys":e(b).selectedKeys,"onUpdate:selectedKeys":d[0]||(d[0]=N=>e(b).selectedKeys=N),class:"zs-table","row-key":"id",data:e(T),"row-selection":e(b).rowSelection,bordered:e(b).bordered,pagination:e(b).pagination,size:e(b).size,columns:e(E),stripe:e(b).stripe,loading:e(Y)},{operate:l(({record:N})=>[t(w,{type:"text",onClick:G=>s(N)},{default:l(()=>[I("详情")]),_:2},1032,["onClick"])]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["ok-loading"])}}}),Oe=Te("span",{class:"mx-3"},"-",-1),Re=q({name:"OrderSupplierManage"}),qe=q({...Re,setup(C){const n=re(),{vAuthority:k}=xe(),{warningModal:V}=se(),{getDictionaryInfo:$}=ee(),[L,x]=te(null),{form:a,resetForm:P}=oe(()=>({groupId:"",routeName:"",departName:"",departNo:"",state:"",startDate:"",endDate:"",settleType:""}),()=>j()),{columnsData:E,visibleColumnsData:b,tableBaseOptions:m,resetData:j,setSelectRow:T,selectRow:Y,extendTableList:g,changeTableColumn:s,changeTableSize:_}=ue(he(),()=>M());Se(async()=>{const{err:o,res:r}=await U(()=>Ne.getDepartmentList({departType:"1"}));return o?[]:r==null?void 0:r.data},[]);const d=()=>{m.selectedKeys=[],M()},w=o=>{V("确定已开客人发票吗?",async r=>{const{res:y}=await U(()=>R.openCustomerInvoice({groupId:o.groupId}),{successMsg:"操作成功"});r(!0),y&&M()})},K=()=>{if(m.selectedKeys.length<2)return ne.error("请勾选两条以上结算的记录！");if(!A(N.value,m.selectedKeys))return ne.error("勾选记录存在不同的供应商，不能同时申请结算！");T(m.selectedKeys,()=>x("zsBalance"))},A=(o,r)=>{const y=r.map(h=>{var Z;return(Z=o.find(H=>H.groupId===h))==null?void 0:Z.supName});return new Set(y).size===1},{data:N,loading:G,initData:M}=ke(async()=>{const{res:o,err:r}=await U(()=>R.getSupplierList({...a.value,currentPage:m.pagination.current,pageSize:m.pagination.pageSize,pagingOrNot:"1"}));return r?[]:(m.pagination.total=o.data.totalCount,o==null?void 0:o.data.dataList.map(y=>{let S=!0;return y.transferState==="1"&&(y.state==="90"||y.state==="11")&&y.settleType!==1&&y.settleType!==3&&(S=!1),{...y,disabled:S}}))}),Q=async o=>{const{err:r}=await U(()=>R.validateLineOrderStatus({groupId:o.groupId}),{after:()=>x(""),before:()=>x(`确定订单_${o.groupId}`)});r||n.push(`/order/supplierManage/operate/?routeId=${o.routeId}&groupId=${o.groupId}&isExamine=true`)},W=async o=>{V("确定拒绝当前订单吗？",async r=>{const{err:y}=await U(()=>R.refuseLineOrder({groupId:o.groupId}),{successMsg:"操作成功"});r(!0),!y&&M()})};return Ve(M),(o,r)=>{const y=u("a-input"),S=u("a-form-item"),h=u("a-grid-item"),Z=u("a-select"),H=u("a-date-picker"),de=u("a-grid"),ie=u("a-form"),pe=u("icon-close"),D=u("a-button"),ce=u("a-space"),me=u("a-button-group"),ge=u("a-alert"),fe=u("a-table");return f(),X("div",null,[t(Ce,{fold:"","table-columns":e(E),"table-size":e(m).size,onResetSearch:e(P),onSearch:e(j),onChangeTableSize:e(_),onChangeTableColumn:e(s)},{form:l(({collapsed:i})=>[t(ie,{model:e(a),"label-align":"left",size:"large","auto-label-width":""},{default:l(()=>[t(de,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!i},{default:l(()=>[t(h,null,{default:l(()=>[t(S,{label:"团号:"},{default:l(()=>[t(y,{modelValue:e(a).groupId,"onUpdate:modelValue":r[0]||(r[0]=p=>e(a).groupId=p),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(S,{label:"线路名称:"},{default:l(()=>[t(y,{modelValue:e(a).routeName,"onUpdate:modelValue":r[1]||(r[1]=p=>e(a).routeName=p),placeholder:"请输入线路名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(S,{label:"部门名称:"},{default:l(()=>[t(y,{modelValue:e(a).departName,"onUpdate:modelValue":r[2]||(r[2]=p=>e(a).departName=p),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(S,{label:"部门代码:"},{default:l(()=>[t(y,{modelValue:e(a).departNo,"onUpdate:modelValue":r[3]||(r[3]=p=>e(a).departNo=p),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(S,{label:"订单状态:"},{default:l(()=>[t(Z,{modelValue:e(a).state,"onUpdate:modelValue":r[4]||(r[4]=p=>e(a).state=p),placeholder:"请选择订单状态",options:e($)("new_trade_order"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(S,{label:"结算状态:"},{default:l(()=>[t(Z,{modelValue:e(a).settleType,"onUpdate:modelValue":r[5]||(r[5]=p=>e(a).settleType=p),placeholder:"请选择结算状态",options:e($)("signupSettleType"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(S,{label:"出团日期:"},{default:l(()=>[t(H,{modelValue:e(a).startDate,"onUpdate:modelValue":r[6]||(r[6]=p=>e(a).startDate=p),class:"flex1",placeholder:"出团日期(开始)"},null,8,["modelValue"]),Oe,t(H,{modelValue:e(a).endDate,"onUpdate:modelValue":r[7]||(r[7]=p=>e(a).endDate=p),class:"flex1",placeholder:"出团日期(结束)"},null,8,["modelValue"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),operate:l(()=>[t(ce,null,{default:l(()=>[F((f(),v(D,{type:"outline",status:"danger",disabled:!e(m).selectedKeys.length},{icon:l(()=>[t(pe)]),default:l(()=>[I(" 删除 ")]),_:1},8,["disabled"])),[[e(k),"OrderSupplierManageDelete"]]),t(D,{type:"outline",status:"warning",onClick:K},{default:l(()=>[I("申请结算")]),_:1})]),_:1})]),table:l(()=>[t(fe,{"selected-keys":e(m).selectedKeys,"onUpdate:selectedKeys":r[8]||(r[8]=i=>e(m).selectedKeys=i),class:"zs-table","row-key":"groupId",data:e(N),"row-selection":e(m).rowSelection,bordered:e(m).bordered,pagination:e(m).pagination,size:e(m).size,columns:e(b),stripe:e(m).stripe,loading:e(G)},{operate:l(({record:i})=>[i.transferState==="1"?(f(),v(me,{key:0},{default:l(()=>[t(D,{type:"text",status:"success",onClick:p=>o.$router.push(`/order/supplierManage/operate/?routeId=${i.routeId}&groupId=${i.groupId}`)},{default:l(()=>[I("详情")]),_:2},1032,["onClick"]),["1","2"].includes(i.settleType)?F((f(),v(D,{key:0,type:"text",status:"warning",onClick:p=>e(T)(i,()=>e(x)("zsRecordList"))},{default:l(()=>[I("结算记录")]),_:2},1032,["onClick"])),[[e(k),"OrderSupplierManageBalance"]]):z("",!0),["90","11"].includes(i.state)?(f(),X(le,{key:1},[!["1","3"].includes(i.settleType)&&i.signCost>0?F((f(),v(D,{key:0,type:"text",status:"warning",onClick:p=>e(T)(i,()=>e(x)("zsBalance"))},{default:l(()=>[I("申请结算")]),_:2},1032,["onClick"])),[[e(k),"OrderSupplierManageApplySettlement"]]):z("",!0)],64)):z("",!0),i.customerInvoiceFlag!="1"?F((f(),v(D,{key:2,type:"text",status:"warning",onClick:p=>e(T)(i,()=>w(i))},{default:l(()=>[I("已开客人发票 ")]),_:2},1032,["onClick"])),[[e(k),"OrderSupplierManagePreviewInvoice"]]):z("",!0),i.state==="12"?(f(),X(le,{key:3},[F((f(),v(D,{type:"text",status:"danger",onClick:p=>W(i)},{default:l(()=>[I("拒绝")]),_:2},1032,["onClick"])),[[e(k),"OrderSupplierManageRefuse"]]),F((f(),v(D,{type:"text",loading:e(L)===`确定订单_${i.groupId}`,onClick:p=>Q(i)},{default:l(()=>[I("确定订单")]),_:2},1032,["loading","onClick"])),[[e(k),"OrderSupplierManageConfirm"]])],64)):z("",!0)]),_:2},1024)):(f(),v(ge,{key:1,type:"warning"},{default:l(()=>[I("调账中无法操作")]),_:1}))]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(L)==="zsBalance"?(f(),v(ze,{key:0,data:e(Y),onSuccess:d,onClose:r[9]||(r[9]=i=>e(T)({},()=>e(x)(null)))},null,8,["data"])):z("",!0),e(L)==="zsRecordList"?(f(),v(Me,{key:1,data:e(Y),onSuccess:d,onClose:r[10]||(r[10]=i=>e(T)({},()=>e(x)(null)))},null,8,["data"])):z("",!0)])}}});export{qe as default};
