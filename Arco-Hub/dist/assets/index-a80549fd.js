import{n as M,p as C,O as d,P as g,d as j,u as G,s as H,C as J,E as Q,R as W,r as c,o as u,l as A,w as a,g as l,i as x,t as p,c as t,e as b,h as I,f as N,k as w,A as X}from"./index-8a2cb146.js";import{Z as Y}from"./index-2bbe694f.js";import{R}from"./reconciliation-6ca30c07.js";const ee=[{title:"姓名",show:!0,dataIndex:"name",align:"center",render:({record:n})=>M(n.name)},{title:"证件号码",show:!0,dataIndex:"idNumber",align:"center",render:({record:n})=>M(n.idNumber)},{title:"调整前订单报名同行价(元)",show:!0,dataIndex:"signCost",align:"right",render:({record:n})=>C("span",{class:"text-red text-price"},d(g(n.signCost)))},{title:"调整前单房差价(元)",show:!0,dataIndex:"diffFree",align:"right",render:({record:n})=>C("span",{class:"text-red text-price"},d(g(n.diffFree)))},{title:"调整前其他价格(元)",show:!0,dataIndex:"otherFee",align:"right",render:({record:n})=>C("span",{class:"text-red text-price"},d(g(n.otherFee)))},{title:"调整前总计(元)",show:!0,dataIndex:"supSigCost",align:"right",render:({record:n})=>C("span",{class:"text-red text-price"},d(g(n.supSigCost)))},{title:"调整后订单报名同行价(元)",show:!0,dataIndex:"signCostAfter",slotName:"signCostAfter"},{title:"调整后单房差价(元)",show:!0,dataIndex:"diffFreeAfter",slotName:"diffFreeAfter"},{title:"调整后其他价格(元)",show:!0,dataIndex:"otherFeeAfter",slotName:"otherFeeAfter"},{title:"调整后总计(元)",show:!0,dataIndex:"supSigCostAfter",align:"right",render:({record:n})=>C("span",{class:"text-red text-price"},d(g(n.supSigCostAfter)))}],te={key:1,class:"text-red text-price",style:{"text-align":"right"}},ae={key:1,class:"text-red text-price",style:{"text-align":"right"}},re={key:1,class:"text-red text-price",style:{"text-align":"right"}},se={key:0,class:"text-red"},ie={key:1,class:"text-red text-price"},le={key:2,style:{"text-align":"right"}},ne={class:"text-red text-price"},oe=N("div",{style:{height:"100px"}},null,-1),de={class:"orderSubmit-footer box-flex jc-fe"},ue=j({name:"ReconciliationBusinessOrderOperate"}),ge=j({...ue,setup(n){const{warningModal:B}=X(),f=G(),{form:v,formRef:D}=H(()=>({tableData:[]})),F={signCostAfter:{required:!0,validator:(r,e)=>{!r&&r!="0"&&e("调整后订单报名同行价不能为空")}},diffFreeAfter:{required:!0,validator:(r,e)=>{!r&&r!="0"&&e("调整后单房差价不能为空")}},otherFeeAfter:{required:!0,validator:(r,e)=>{!r&&r!="0"&&e("调整后其他价格不能为空")}}},{jumpTabName:k}=J(),[O,y]=Q(null),_=W({}),L=()=>{D.value.validate(r=>{r||(f.query.isReadOnly?T("updateBusiness"):T("successBusiness"))})},E=async()=>{B("确认要驳回?",async r=>{const{err:e}=await w(()=>R.rejectBusiness({id:_.value.id}),{before:()=>y("驳回"),after:()=>y(null),successMsg:"驳回成功"});if(e)return r(!0);r(!0),k()})},T=async r=>{if(r=="updateBusiness"){const{err:e}=await w(()=>R.updateBusiness({hisTouristsInfoList:v.value.tableData,groupId:f.query.groupId}),{before:()=>y("确定"),after:()=>y(null),successMsg:"操作成功"});if(e)return;k()}else B("确认要通过?",async e=>{const{err:h}=await w(()=>R.successBusiness({id:_.value.id}),{before:()=>y("确定"),after:()=>y(null),successMsg:"操作成功"});if(h)return e(!0);e(!0),k()})},z=async r=>{const{res:e,err:h}=await w(()=>R[r]({groupId:f.query.groupId}));h||(f.query.isReadOnly?(_.value=e==null?void 0:e.data.signupRecord,v.value.tableData=e==null?void 0:e.data.customerInfoList.map(o=>(o.signCostAfter=o.signCost,o.diffFreeAfter=o.diffFree,o.otherFeeAfter=o.otherFee,o.supSigCostAfter=o.supSigCost,o))):(_.value=e==null?void 0:e.data.hisSignupRecord,v.value.tableData=e==null?void 0:e.data.hisCustomerInfoList))};return f.query.isReadOnly?z("getBusinessInfo"):z("getBusinessDetail"),(r,e)=>{const h=c("a-tag"),o=c("a-descriptions-item"),$=c("a-descriptions"),U=c("a-card"),S=c("a-input-number"),V=c("a-form-item"),K=c("a-table"),P=c("a-form"),q=c("a-button"),Z=c("a-space");return u(),A(Y,null,{default:a(()=>[l(U,{title:"基本信息",bordered:!1,class:"general-card"},{default:a(()=>[l($,{column:1},{default:a(()=>[l(o,{label:"线路名称："},{default:a(()=>[l(h,null,{default:a(()=>[x(p(_.value.routeName),1)]),_:1})]),_:1}),l(o,{label:"团号："},{default:a(()=>[l(h,null,{default:a(()=>[x(p(_.value.groupId),1)]),_:1})]),_:1}),l(o,{label:"旅行类型："},{default:a(()=>[l(h,null,{default:a(()=>[x(p(_.value.travelName),1)]),_:1})]),_:1}),l(o,{label:"成团类别："},{default:a(()=>[l(h,null,{default:a(()=>[x(p(_.value.signupType==1?"单团":"散客"),1)]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{ref_key:"formRef",ref:D,model:t(v),"label-align":"left",size:"large","auto-label-width":"",rules:F},{default:a(()=>[l(U,{title:"游客信息",bordered:!1,class:"general-card margin-top"},{default:a(()=>[l(K,{size:"large",columns:t(ee),data:t(v).tableData,pagination:!1,bordered:!1,summary:!0,"summary-text":"总计"},{signCostAfter:a(({record:s,rowIndex:m})=>[t(f).query.isReadOnly?(u(),A(V,{key:0,field:`tableData[${m}].signCostAfter`,rules:[{validator:F.signCostAfter.validator}],"hide-label":"","hide-asterisk":""},{default:a(()=>[l(S,{modelValue:s.signCostAfter,"onUpdate:modelValue":i=>s.signCostAfter=i,formatter:i=>t(d)(i,""),parser:i=>i.replace(/,/g,""),precision:2},null,8,["modelValue","onUpdate:modelValue","formatter","parser"])]),_:2},1032,["field","rules"])):(u(),b("div",te,p(t(d)(t(g)(s.signCostAfter))),1))]),diffFreeAfter:a(({record:s,rowIndex:m})=>[t(f).query.isReadOnly?(u(),A(V,{key:0,field:`tableData[${m}].diffFreeAfter`,rules:[{validator:F.diffFreeAfter.validator}],"hide-label":"","hide-asterisk":""},{default:a(()=>[l(S,{modelValue:s.diffFreeAfter,"onUpdate:modelValue":i=>s.diffFreeAfter=i,formatter:i=>t(d)(i,""),parser:i=>i.replace(/,/g,""),precision:2},null,8,["modelValue","onUpdate:modelValue","formatter","parser"])]),_:2},1032,["field","rules"])):(u(),b("div",ae,p(t(d)(t(g)(s.diffFreeAfter))),1))]),otherFeeAfter:a(({record:s,rowIndex:m})=>[t(f).query.isReadOnly?(u(),A(V,{key:0,field:`tableData[${m}].otherFeeAfter`,rules:[{validator:F.otherFeeAfter.validator}],"hide-label":"","hide-asterisk":""},{default:a(()=>[l(S,{modelValue:s.otherFeeAfter,"onUpdate:modelValue":i=>s.otherFeeAfter=i,formatter:i=>t(d)(i,""),parser:i=>i.replace(/,/g,""),precision:2},null,8,["modelValue","onUpdate:modelValue","formatter","parser"])]),_:2},1032,["field","rules"])):(u(),b("div",re,p(t(d)(t(g)(s.otherFeeAfter))),1))]),"summary-cell":a(({column:s,record:m,rowIndex:i})=>[s.dataIndex=="name"?(u(),b("div",se,p(m[s.dataIndex]),1)):I("",!0),s.dataIndex=="supSigCost"?(u(),b("div",ie,p(t(d)(t(g)(m[s.dataIndex]))),1)):I("",!0),s.dataIndex=="supSigCostAfter"?(u(),b("div",le,[N("div",ne,p(t(d)(t(g)(m[s.dataIndex]))),1)])):I("",!0)]),_:1},8,["columns","data"])]),_:1})]),_:1},8,["model"]),oe,N("div",de,[l(Z,{size:"large"},{default:a(()=>[t(f).query.isReadOnly||t(f).query.isSure?(u(),A(q,{key:0,size:"large",type:"primary",loading:t(O)==="确定",onClick:L},{default:a(()=>[x("确定")]),_:1},8,["loading"])):I("",!0),t(f).query.isSure?(u(),A(q,{key:1,size:"large",status:"danger",loading:t(O)==="驳回",onClick:E},{default:a(()=>[x("驳回")]),_:1},8,["loading"])):I("",!0),l(q,{size:"large",onClick:e[0]||(e[0]=()=>t(k)())},{default:a(()=>[x("返回")]),_:1})]),_:1})])]),_:1})}}});export{ge as default};
