import{d as K,g as q,h as P,i as Y,D as Z,k as E,r as n,o as T,l as D,w as a,a as t,b as e,s as ee,t as te,p as O,m as I,S as R,z as ae,n as le,j as oe,c as ne,v as se,e as L,q as de}from"./index-d007178a.js";import{f as y,c as re,_ as ie}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-430f1ffc.js";import{f as ue}from"./options-aafac76d.js";import"./index-13860ba0.js";const H=[{label:"计划文件",value:1},{label:"就业报告",value:2}],ce=()=>[{title:"序号",width:80,dataIndex:"sortTableNo",show:!0,align:"center"},{title:"院校名称",dataIndex:"yxmc",show:!0,align:"center",render:({record:s})=>y(s.yxmc)},{title:"顺序",dataIndex:"sort",show:!0,align:"center",render:({record:s})=>y(s.sort)},{title:"年份",dataIndex:"nf",show:!0,align:"center",render:({record:s})=>y(s.nf)},{title:"发布时间",dataIndex:"fbdt",show:!0,align:"center",render:({record:s})=>y(s.fbdt)},{title:"文件标题",dataIndex:"dtitle",show:!0,align:"center",render:({record:s})=>y(s.dtitle)},{title:"文件类型",dataIndex:"dtype",show:!0,align:"center",render:({record:s})=>{var b;return y((b=ue(H,s.dtype))==null?void 0:b.label)}},{title:"文件链接",dataIndex:"docurl",show:!0,tooltip:!0,ellipsis:!0,align:"center",render:({record:s})=>y(s.docurl)},{title:"内容详情",dataIndex:"content",show:!0,tooltip:!0,ellipsis:!0,align:"center",render:({record:s})=>y(s.content)},{title:"操作",width:100,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],me=K({name:"zsAddFileManage"}),pe=K({...me,props:{data:{default:()=>({})}},emits:["close","success"],setup(s,{emit:b}){const w=s,V=q(),[u,x]=P(null),{form:l,formRef:C}=Y(()=>({...w.data})),M={yxid:{required:!0,message:"请选择学校"},nf:{required:!0,message:"请选择年份"},sort:{required:!0,message:"请输入顺序"},dtype:{required:!0,message:"请输入文件类型"}},U=()=>{C.value.validate(f=>{f||(w.data.id?d("editSchoolDoc"):d("addSchoolDoc"))})},d=async f=>{const{err:o}=await I(()=>R[f](l.value),{before:()=>x("okLoading"),after:()=>x(null)});o||(b("success"),b("close"))};Z(()=>l.value.nBl,f=>{l.value.vBl=100-f}),E("");const z=E([]),$=async f=>{const{res:o,err:v}=await I(()=>R.uploadSchoolDoc({file:f.at(-1).file}),{after:()=>x(null),before:()=>x(null)});v||(l.value.docurl=o==null?void 0:o.data)};return(f,o)=>{const v=n("a-select"),_=n("a-form-item"),g=n("a-grid-item"),F=n("a-year-picker"),N=n("a-input-number"),k=n("a-input"),c=n("a-date-picker"),r=n("a-upload"),S=n("a-textarea"),m=n("a-grid"),h=n("a-form"),A=n("a-modal");return T(),D(A,{title:e(re)("文件",!!w.data.id),"unmount-on-close":"",visible:"",top:"5%",width:"80vw","align-center":!1,"mask-closable":!1,"ok-loading":e(u)==="okLoading",onCancel:o[7]||(o[7]=i=>b("close")),onOk:U},{default:a(()=>[t(h,{ref_key:"formRef",ref:C,model:e(l),"label-align":"left",size:"large","auto-label-width":"",rules:M},{default:a(()=>[t(m,{cols:2,"col-gap":24},{default:a(()=>[t(g,null,{default:a(()=>[t(_,{field:"yxid",label:"院校信息:"},{default:a(()=>[t(v,{modelValue:e(l).yxid,"onUpdate:modelValue":o[0]||(o[0]=i=>e(l).yxid=i),options:e(V).schoolList,"virtual-list-props":{height:200},disabled:!!w.data.id,"allow-search":"","allow-clear":"",placeholder:"请选择院校信息"},null,8,["modelValue","options","disabled"])]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(_,{field:"nf",label:"年份:"},{default:a(()=>[t(F,{class:"flex1",modelValue:e(l).nf,"onUpdate:modelValue":o[1]||(o[1]=i=>e(l).nf=i),placeholder:"请选择年份"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(_,{field:"sort",label:"顺序:"},{default:a(()=>[t(N,{modelValue:e(l).sort,"onUpdate:modelValue":o[2]||(o[2]=i=>e(l).sort=i),placeholder:"请输入顺序"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(_,{label:"文件标题:"},{default:a(()=>[t(k,{modelValue:e(l).dtitle,"onUpdate:modelValue":o[3]||(o[3]=i=>e(l).dtitle=i),placeholder:"请输入文件标题"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(_,{field:"dtype",label:"文件类型:"},{default:a(()=>[t(v,{modelValue:e(l).dtype,"onUpdate:modelValue":o[4]||(o[4]=i=>e(l).dtype=i),placeholder:"请输入文件类型","allow-search":"",options:[...e(H)]},null,8,["modelValue","options"])]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(_,{label:"发布时间:"},{default:a(()=>[t(c,{modelValue:e(l).fbdt,"onUpdate:modelValue":o[5]||(o[5]=i=>e(l).fbdt=i),placeholder:"请选择发布时间",class:"flex1","show-time":"","time-picker-props":{defaultValue:"09:09:06"},format:"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(l).dtype==1?(T(),D(g,{key:0},{default:a(()=>[t(_,{label:"上传文件:"},{default:a(()=>[t(r,{disabled:e(l).docurl&&e(l).docurl!=="",limit:1,download:z.value.length>=1,"auto-upload":!1,"show-cancel-button":!1,"show-link":!1,"show-file-list":!1,accept:".xlsx,.xls,.docx",action:"/",onChange:$},null,8,["disabled","download"]),ee("a",null,te(e(l).docurl),1)]),_:1})]),_:1})):O("",!0),e(l).dtype==2?(T(),D(g,{key:1,span:24},{default:a(()=>[t(_,{field:"content",label:"内容详情:"},{default:a(()=>[t(S,{modelValue:e(l).content,"onUpdate:modelValue":o[6]||(o[6]=i=>e(l).content=i),"auto-size":{minRows:4},placeholder:"请输入内容详情"},null,8,["modelValue"])]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","ok-loading"])}}}),fe=K({name:"SchoolFileManage"}),xe=K({...fe,setup(s){const{warningModal:b}=de(),[w,V]=P(null);q();const{form:u,resetForm:x}=Y(()=>({yxmc:"",nf:"",createStartTime:"",createEndTime:""}),()=>z()),l=ae({get(){return u.value.createStartTime&&u.value.createEndTime?[u.value.createStartTime,u.value.createEndTime]:[]},set(c){u.value.createStartTime=c[0],u.value.createEndTime=c[1]}}),{selectRow:C,columnsData:M,visibleColumnsData:U,tableBaseOptions:d,resetData:z,createRowNo:$,extendTableList:f,setSelectRow:o,changeTableColumn:v,changeTableSize:_}=le(ce(),()=>k()),g=()=>{b(`确定删除选中的${d.selectedKeys.length}数据吗？`,async c=>{const{err:r}=await I(()=>R.deleSchoolDoc({ids:d.selectedKeys}),{successMsg:"操作成功"});r||(c(!0),d.selectedKeys=[],k())})},{data:F,loading:N,initData:k}=oe(async()=>{const{res:c,err:r}=await I(()=>R.getSchoolDoc({...u.value,currentPage:d.pagination.current,pageSize:d.pagination.pageSize,pagingOrNot:"1"}));if(r)return[];d.pagination.total=c.data.totalCount;const S=c==null?void 0:c.data.resultList.map(m=>(m.nf!==void 0&&m.nf!==null&&(m.nf=String(m.nf)),m));return f(S)});return(c,r)=>{const S=n("a-input"),m=n("a-form-item"),h=n("a-grid-item"),A=n("a-year-picker"),i=n("a-range-picker"),j=n("a-grid"),W=n("a-form"),G=n("icon-plus"),B=n("a-button"),J=n("icon-close"),Q=n("a-space"),X=n("a-table");return T(),ne("div",null,[t(ie,{"table-columns":e(M),"table-size":e(d).size,onResetSearch:e(x),onSearch:e(z),onChangeTableSize:e(_),onChangeTableColumn:e(v)},{form:a(()=>[t(W,{model:e(u),"label-align":"left",size:"large","auto-label-width":""},{default:a(()=>[t(j,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:a(()=>[t(h,null,{default:a(()=>[t(m,{label:"院校名称:"},{default:a(()=>[t(S,{modelValue:e(u).yxmc,"onUpdate:modelValue":r[0]||(r[0]=p=>e(u).yxmc=p),placeholder:"请输入院校名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:a(()=>[t(m,{label:"年份:"},{default:a(()=>[t(A,{modelValue:e(u).nf,"onUpdate:modelValue":r[1]||(r[1]=p=>e(u).nf=p),class:"flex-1",placeholder:"请选择年份"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,null,{default:a(()=>[t(m,{field:"createTime",label:"发布时间:"},{default:a(()=>[t(i,{class:"flex1",modelValue:e(l),"onUpdate:modelValue":r[2]||(r[2]=p=>se(l)?l.value=p:null)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),operate:a(()=>[t(Q,null,{default:a(()=>[t(B,{type:"outline",onClick:r[3]||(r[3]=p=>e(V)("zsAddFileManage"))},{icon:a(()=>[t(G)]),default:a(()=>[L(" 新增 ")]),_:1}),t(B,{type:"outline",status:"danger",disabled:!e(d).selectedKeys.length,loading:e(w)==="删除",onClick:g},{icon:a(()=>[t(J)]),default:a(()=>[L(" 删除 ")]),_:1},8,["disabled","loading"])]),_:1})]),table:a(()=>[t(X,{"selected-keys":e(d).selectedKeys,"onUpdate:selectedKeys":r[4]||(r[4]=p=>e(d).selectedKeys=p),class:"zs-table","row-key":"id",data:e(F),"row-selection":e(d).rowSelection,bordered:e(d).bordered,pagination:e(d).pagination,size:e(d).size,columns:e(U),stripe:e(d).stripe,loading:e(N)},{operate:a(({record:p})=>[t(B,{type:"text",onClick:_e=>e(o)(p,()=>e(V)("zsAddFileManage"))},{default:a(()=>[L("编辑")]),_:2},1032,["onClick"])]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(w)==="zsAddFileManage"?(T(),D(pe,{key:0,data:e(C),onSuccess:e(k),onClose:r[5]||(r[5]=p=>e(o)({},()=>e(V)(null)))},null,8,["data","onSuccess"])):O("",!0)])}}});export{xe as default};
