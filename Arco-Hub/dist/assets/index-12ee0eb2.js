import{n as B,p as v,O as d,P as m,d as j,u as G,s as H,C as J,E as Q,R as W,r as c,o as u,l as A,w as a,g as i,i as x,t as p,c as t,e as b,h as I,f as M,k,A as X}from"./index-8a2cb146.js";import{Z as Y}from"./index-2bbe694f.js";import{R as w}from"./reconciliation-6ca30c07.js";const ee=[{title:"姓名",show:!0,dataIndex:"name",align:"center",render:({record:n})=>B(n.name)},{title:"证件号码",show:!0,dataIndex:"idNumber",align:"center",render:({record:n})=>B(n.idNumber)},{title:"调整前订单报名同行价(元)",show:!0,dataIndex:"signCost",align:"right",render:({record:n})=>v("span",{class:"text-red text-price"},d(m(n.signCost)))},{title:"调整前单房差价(元)",show:!0,dataIndex:"diffFree",align:"right",render:({record:n})=>v("span",{class:"text-red text-price"},d(m(n.diffFree)))},{title:"调整前其他价格(元)",show:!0,dataIndex:"otherFee",align:"right",render:({record:n})=>v("span",{class:"text-red text-price"},d(m(n.otherFee)))},{title:"调整前总计(元)",show:!0,dataIndex:"supSigCost",align:"right",render:({record:n})=>v("span",{class:"text-red text-price"},d(m(n.supSigCost)))},{title:"调整后订单报名同行价(元)",show:!0,dataIndex:"signCostAfter",slotName:"signCostAfter"},{title:"调整后单房差价(元)",show:!0,dataIndex:"diffFreeAfter",slotName:"diffFreeAfter"},{title:"调整后其他价格(元)",show:!0,dataIndex:"otherFeeAfter",slotName:"otherFeeAfter"},{title:"调整后总计(元)",show:!0,dataIndex:"supSigCostAfter",align:"right",render:({record:n})=>v("span",{class:"text-red text-price"},d(m(n.supSigCostAfter)))}],te={key:1,class:"text-red text-price",style:{"text-align":"right"}},ae={key:1,class:"text-red text-price",style:{"text-align":"right"}},re={key:1,class:"text-red text-price",style:{"text-align":"right"}},se={key:0,class:"text-red"},le={key:1,class:"text-red text-price"},ie={key:2,style:{"text-align":"right"}},ne={class:"text-red text-price"},oe={class:"box-flex jc-c margin-top"},de=j({name:"ReconciliationSupplierOrderOperate"}),pe=j({...de,setup(n){const{warningModal:N}=X(),f=G(),{form:C,formRef:D}=H(()=>({tableData:[]})),F={signCostAfter:{required:!0,validator:(r,e)=>{!r&&r!="0"&&e("调整后订单报名同行价不能为空")}},diffFreeAfter:{required:!0,validator:(r,e)=>{!r&&r!="0"&&e("调整后单房差价不能为空")}},otherFeeAfter:{required:!0,validator:(r,e)=>{!r&&r!="0"&&e("调整后其他价格不能为空")}}},{jumpTabName:S}=J(),[O,y]=Q(null),_=W({}),L=()=>{D.value.validate(r=>{r||(f.query.isReadOnly?T("updateSupplier"):T("successSupplier"))})},E=async()=>{N("确认要驳回?",async r=>{const{err:e}=await k(()=>w.rejectSupplier({id:_.value.id}),{before:()=>y("驳回"),after:()=>y(null),successMsg:"驳回成功"});if(e)return r(!0);r(!0),S()})},T=async r=>{if(r=="updateSupplier"){const{err:e}=await k(()=>w.updateSupplier({hisTouristsInfoList:C.value.tableData,groupId:f.query.groupId}),{before:()=>y("确定"),after:()=>y(null),successMsg:"操作成功"});if(e)return;S()}else N("确认要通过?",async e=>{const{err:h}=await k(()=>w.successSupplier({id:_.value.id}),{before:()=>y("确定"),after:()=>y(null),successMsg:"操作成功"});if(h)return e(!0);e(!0),S()})},z=async r=>{const{res:e,err:h}=await k(()=>w[r]({groupId:f.query.groupId}));h||(f.query.isReadOnly?(_.value=e==null?void 0:e.data.signupRecord,C.value.tableData=e==null?void 0:e.data.customerInfoList.map(o=>(o.signCostAfter=o.signCost,o.diffFreeAfter=o.diffFree,o.otherFeeAfter=o.otherFee,o.supSigCostAfter=o.supSigCost,o))):(_.value=e==null?void 0:e.data.hisSignupRecord,C.value.tableData=e==null?void 0:e.data.hisCustomerInfoList))};return f.query.isReadOnly?z("getSupplierInfo"):z("getSupplierDetail"),(r,e)=>{const h=c("a-tag"),o=c("a-descriptions-item"),$=c("a-descriptions"),U=c("a-card"),R=c("a-input-number"),V=c("a-form-item"),K=c("a-table"),q=c("a-button"),P=c("a-space"),Z=c("a-form");return u(),A(Y,null,{default:a(()=>[i(U,{title:"基本信息",bordered:!1,class:"general-card"},{default:a(()=>[i($,{column:1},{default:a(()=>[i(o,{label:"线路名称："},{default:a(()=>[i(h,null,{default:a(()=>[x(p(_.value.routeName),1)]),_:1})]),_:1}),i(o,{label:"团号："},{default:a(()=>[i(h,null,{default:a(()=>[x(p(_.value.groupId),1)]),_:1})]),_:1}),i(o,{label:"旅行类型："},{default:a(()=>[i(h,null,{default:a(()=>[x(p(_.value.travelName),1)]),_:1})]),_:1}),i(o,{label:"成团类别："},{default:a(()=>[i(h,null,{default:a(()=>[x(p(_.value.signupType==1?"单团":"散客"),1)]),_:1})]),_:1})]),_:1})]),_:1}),i(Z,{ref_key:"formRef",ref:D,model:t(C),"label-align":"left",size:"large","auto-label-width":"",rules:F},{default:a(()=>[i(U,{title:"游客信息",bordered:!1,class:"general-card margin-top"},{default:a(()=>[i(K,{size:"large",columns:t(ee),data:t(C).tableData,pagination:!1,bordered:!1,summary:!0,"summary-text":"总计"},{signCostAfter:a(({record:s,rowIndex:g})=>[t(f).query.isReadOnly?(u(),A(V,{key:0,field:`tableData[${g}].signCostAfter`,rules:[{validator:F.signCostAfter.validator}],"hide-label":"","hide-asterisk":""},{default:a(()=>[i(R,{modelValue:s.signCostAfter,"onUpdate:modelValue":l=>s.signCostAfter=l,formatter:l=>t(d)(l,""),parser:l=>l.replace(/,/g,""),precision:2},null,8,["modelValue","onUpdate:modelValue","formatter","parser"])]),_:2},1032,["field","rules"])):(u(),b("div",te,p(t(d)(t(m)(s.signCostAfter))),1))]),diffFreeAfter:a(({record:s,rowIndex:g})=>[t(f).query.isReadOnly?(u(),A(V,{key:0,field:`tableData[${g}].diffFreeAfter`,rules:[{validator:F.diffFreeAfter.validator}],"hide-label":"","hide-asterisk":""},{default:a(()=>[i(R,{modelValue:s.diffFreeAfter,"onUpdate:modelValue":l=>s.diffFreeAfter=l,formatter:l=>t(d)(l,""),parser:l=>l.replace(/,/g,""),precision:2},null,8,["modelValue","onUpdate:modelValue","formatter","parser"])]),_:2},1032,["field","rules"])):(u(),b("div",ae,p(t(d)(t(m)(s.diffFreeAfter))),1))]),otherFeeAfter:a(({record:s,rowIndex:g})=>[t(f).query.isReadOnly?(u(),A(V,{key:0,field:`tableData[${g}].otherFeeAfter`,rules:[{validator:F.otherFeeAfter.validator}],"hide-label":"","hide-asterisk":""},{default:a(()=>[i(R,{modelValue:s.otherFeeAfter,"onUpdate:modelValue":l=>s.otherFeeAfter=l,formatter:l=>t(d)(l,""),parser:l=>l.replace(/,/g,""),precision:2},null,8,["modelValue","onUpdate:modelValue","formatter","parser"])]),_:2},1032,["field","rules"])):(u(),b("div",re,p(t(d)(t(m)(s.otherFeeAfter))),1))]),"summary-cell":a(({column:s,record:g,rowIndex:l})=>[s.dataIndex=="name"?(u(),b("div",se,p(g[s.dataIndex]),1)):I("",!0),s.dataIndex=="supSigCost"?(u(),b("div",le,p(t(d)(t(m)(g[s.dataIndex]))),1)):I("",!0),s.dataIndex=="supSigCostAfter"?(u(),b("div",ie,[M("div",ne,p(t(d)(t(m)(g[s.dataIndex]))),1)])):I("",!0)]),_:1},8,["columns","data"]),M("div",oe,[i(P,{class:"margin-top",size:"large"},{default:a(()=>[t(f).query.isReadOnly||t(f).query.isSure?(u(),A(q,{key:0,size:"large",type:"primary",loading:t(O)==="确定",onClick:L},{default:a(()=>[x("确定")]),_:1},8,["loading"])):I("",!0),t(f).query.isSure?(u(),A(q,{key:1,size:"large",type:"primary",loading:t(O)==="驳回",onClick:E},{default:a(()=>[x("驳回")]),_:1},8,["loading"])):I("",!0),i(q,{size:"large",onClick:e[0]||(e[0]=()=>t(S)())},{default:a(()=>[x("返回")]),_:1})]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}});export{pe as default};
