import{a as te,n as D,p as Z,T as ee,d as B,E as H,s as J,r as i,o as N,l as C,w as n,g as o,c as e,k as S,A as Q,b as G,q as me,R as pe,v as fe,e as ge,z as R,i as z,h as $,V as k,L as _e,S as be}from"./index-8a2cb146.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{B as h}from"./business-b0ce0e8a.js";import"./index-2bbe694f.js";const ke=()=>{const{getDictionaryItem:I}=te();return[{title:"团号",dataIndex:"groupNo",show:!0,align:"center",render:({record:s})=>D(s.groupNo)},{title:"合同编号",dataIndex:"contractNumber",show:!0,align:"center",render:({record:s})=>D(s.contractNumber)},{title:"营业部名称",dataIndex:"departName",show:!0,align:"center",ellipsis:!0,tooltip:!0,render:({record:s})=>D(s.departName)},{title:"线路名称",dataIndex:"routeName",show:!0,align:"center",ellipsis:!0,tooltip:!0,render:({record:s})=>D(s.routeName)},{title:"总数",dataIndex:"totalNumber",show:!0,align:"right",width:100,render:({record:s})=>D(s.totalNumber)},{title:"状态",dataIndex:"state",show:!0,align:"center",render:({record:s})=>D(I("contractState",s.state).detailName)},{title:"签署人",dataIndex:"signingName",show:!0,width:100,align:"center",render:({record:s})=>Z(ee,{color:"blue"},{default:()=>D(s.signingName)})},{title:"类型",dataIndex:"contractType",show:!0,width:100,align:"center",render:({record:s})=>Z(ee,{color:"blue"},{default:()=>D(s.contractType=="0"?"补充协议":"合同")})},{title:"创建时间",dataIndex:"createTime",show:!0,align:"center",render:({record:s})=>D(s.createTime)},{title:"操作",width:380,dataIndex:"operate",slotName:"operate",show:!0,align:"left"}]},Ne=B({name:"zsRestock"}),ve=B({...Ne,props:{data:{default:()=>({})}},emits:["close","success"],setup(I,{emit:s}){const{warningModal:V}=Q(),g=I,[L,w]=H(null),{form:_,formRef:c}=J(()=>({})),U={remark:{required:!0,message:"请输入补充协议"}},v=s,A=()=>{c.value.validate(l=>{l||P()})},P=async()=>{V("确定提交吗?",async l=>{l(!0);const{err:m}=await S(()=>h.contractToSaveRemark({id:g.data,remark:_.value.remark}),{successMsg:"操作成功"});m||(v("success"),v("close"))})};return(l,m)=>{const b=i("a-textarea"),y=i("a-form-item"),q=i("a-grid-item"),F=i("a-grid"),E=i("a-form"),O=i("a-modal");return N(),C(O,{title:"请输入补充协议","unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(L)==="okLoading",top:"20vh",onCancel:m[1]||(m[1]=K=>v("close")),onOk:A},{default:n(()=>[o(E,{ref_key:"formRef",ref:c,model:e(_),"label-align":"left",size:"large","auto-label-width":"",rules:U},{default:n(()=>[o(F,{cols:1,"col-gap":24},{default:n(()=>[o(q,null,{default:n(()=>[o(y,{field:"remark",label:"补充协议:"},{default:n(()=>[o(b,{modelValue:e(_).remark,"onUpdate:modelValue":m[0]||(m[0]=K=>e(_).remark=K)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),Ce=B({name:"zsDeclare"}),De=B({...Ce,props:{data:{default:()=>({})}},emits:["close","success"],setup(I,{emit:s}){const{warningModal:V}=Q(),g=I,[L,w]=H(null),{form:_,formRef:c}=J(()=>({})),U={remark:{required:!0,message:"请输入合同编号"}},v=s,A=()=>{c.value.validate(m=>{m||P()})},P=async()=>{V("确定提交吗?",async m=>{m(!0);const{err:b}=await S(()=>h.batchReviewContract({paid:_.value.remark,contractIdList:g.data.ids}),{successMsg:"操作成功"});b||(v("success"),v("close"))})},{data:l}=G(async()=>{const{res:m,err:b}=await S(()=>h.contractToBatch({departNo:g.data.departNo,contractIdList:g.data.ids}),{successMsg:""});if(!b)return m==null?void 0:m.data.paperContractList});return(m,b)=>{const y=i("a-select"),q=i("a-form-item"),F=i("a-grid-item"),E=i("a-grid"),O=i("a-form"),K=i("a-modal");return N(),C(K,{title:"请输入合同编号","unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(L)==="okLoading",top:"20vh",onCancel:b[1]||(b[1]=j=>v("close")),onOk:A},{default:n(()=>[o(O,{ref_key:"formRef",ref:c,model:e(_),"label-align":"left",size:"large","auto-label-width":"",rules:U},{default:n(()=>[o(E,{cols:1,"col-gap":24},{default:n(()=>[o(F,null,{default:n(()=>[o(q,{field:"remark",label:"合同编号:"},{default:n(()=>[o(y,{modelValue:e(_).remark,"onUpdate:modelValue":b[0]||(b[0]=j=>e(_).remark=j),"virtual-list-props":{height:200},options:e(l),"field-names":{label:"contractNumber",value:"id"},"allow-search":"",placeholder:"请选择合同编号"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),Se=B({name:"BusinessContractDocking"}),xe=B({...Se,setup(I){const[s,V]=H(null),{vAuthority:g}=me(),{getDictionaryInfo:L}=te(),{warningModal:w}=Q(),_=pe([]),{form:c,resetForm:U}=J(()=>({groupNo:"",contractNumber:"",departName:"",departNo:"",signingName:"",areaNo:"",state:""}),()=>m()),{selectRow:v,columnsData:A,visibleColumnsData:P,tableBaseOptions:l,resetData:m,extendTableList:b,setSelectRow:y,changeTableColumn:q,changeTableSize:F}=fe(ke(),()=>Y()),E=()=>{if(!O(M.value,l.selectedKeys))return k.error("勾选记录存在不同的团号，不能同时申报！");if(l.selectedKeys.map(d=>M.value.filter(f=>f.id===d)[0]).every(d=>d.state!="2"&&d.state!="3")){k.error("只有申报失败或系统未生成的合同才能批量申报！");return}w("确定要重新申报合同吗?",async d=>{const f={ids:l.selectedKeys,departNo:M.value.find(T=>T.id==l.selectedKeys[0]).departNo};y(f,()=>V("zsDeclare")),d(!0)})},O=(a,t)=>{const r=t.map(f=>{var T;return(T=a.find(X=>f.id==f))==null?void 0:T.groupNo});return new Set(r).size===1},K=a=>{w("确定要重新申报合同吗?",async t=>{if(a.id==null||a.id=="")return k.error("合同主键不能为空！"),t(!0);if(a.state==null||a.state=="")return k.error("合同状态不能为空！"),t(!0);if(a.state=="1"||a.state=="0")return k.error("只有申报失败或系统未生成的合同才能重新申报！"),t(!0);const{err:r}=await S(()=>h.contractApplyAgain({id:a.id,groupNo:a.groupNo,contractType:a.contractType}),{successMsg:"操作成功"});if(r)return t(!0);t(!0),Y()})},j=()=>{if(l.selectedKeys.length>1){k.error("一次只允许勾选一条记录！");return}const a=M.value.find(r=>r.id==l.selectedKeys[0]).contractType,t=M.value.find(r=>r.id==l.selectedKeys[0]).state;if(a!="0"||t=="1"){k.error("您勾选的纪录不符合补充协议的要求！");return}w("确定要手动补充选中的协议吗？",async r=>{y(l.selectedKeys[0],()=>V("zsRestock")),r(!0)})},ae=async a=>{const{res:t,err:r}=await S(()=>h.contractDownFile({contractNumber:a.contractNumber}));r||_e(t,"电子合同-"+a.groupNo+a.signingName+"_.pdf")},ne=a=>{var t="",r="";a.state=="6"?(r="是否重新发送作废短信？",t="0"):(r="是否重新发送签署短信？",t="1"),w(r,async d=>{if(a.contractNumber==null||a.contractNumber=="")return k.error("合同数据不全请确定合同编号是否存在！"),d(!0),!1;if(a.signingIDPhone==null||a.signingIDPhone=="")return k.error("合同数据不全请确认签署人电话是否存在！"),d(!0),!1;const{err:f}=await S(()=>h.sendMessage({flag:t,contractNumber:a.contractNumber,signingIDPhone:a.signingIDPhone}),{successMsg:"操作成功"});if(f)return d(!0);d(!0),Y()})},oe=a=>{w("确定要作废合同吗?",async t=>{if(a.contractNumber==null||a.contractNumber=="")return k.error("合同编号不能为空！"),t(!0),!1;if(a.state=="1"||a.state=="2"||a.state=="3"){const{err:r}=await S(()=>h.cancelContract({contractNumber:a.contractNumber}),{successMsg:"操作成功"});if(r)return t(!0);t(!0),Y()}else return k.error("当前状态不能作废！"),t(!0),!1})},W=()=>{l.selectedKeys=[],Y()};G(async()=>{const{res:a,err:t}=await S(()=>be.getDepartmentList({departType:"1"}));return t?[]:a==null?void 0:a.data},[]);const{data:M,loading:le,initData:Y}=G(async()=>{const{res:a,err:t}=await S(()=>h.getContractList({...c.value,currentPage:l.pagination.current,pageSize:l.pagination.pageSize}),{successMsg:""});if(!t)return _.value=a==null?void 0:a.data.regionList,l.pagination.total=a.data.totalCount,b(a==null?void 0:a.data.dataList)});return(a,t)=>{const r=i("a-input"),d=i("a-form-item"),f=i("a-grid-item"),T=i("a-select"),X=i("a-grid"),se=i("a-form"),re=i("icon-bookmark"),x=i("a-button"),ie=i("icon-book"),ue=i("a-space"),ce=i("a-button-group"),de=i("a-table");return N(),ge("div",null,[o(ye,{fold:"","table-columns":e(A),"table-size":e(l).size,onResetSearch:e(U),onSearch:e(m),onChangeTableSize:e(F),onChangeTableColumn:e(q)},{form:n(({collapsed:u})=>[o(se,{model:e(c),"label-align":"left",size:"large","auto-label-width":""},{default:n(()=>[o(X,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!u},{default:n(()=>[o(f,null,{default:n(()=>[o(d,{label:"团号:"},{default:n(()=>[o(r,{modelValue:e(c).groupNo,"onUpdate:modelValue":t[0]||(t[0]=p=>e(c).groupNo=p),modelModifiers:{trim:!0},placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(d,{label:"合同编号:"},{default:n(()=>[o(r,{modelValue:e(c).contractNumber,"onUpdate:modelValue":t[1]||(t[1]=p=>e(c).contractNumber=p),modelModifiers:{trim:!0},placeholder:"请输入合同编号"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(d,{label:"部门名称:"},{default:n(()=>[o(r,{modelValue:e(c).departName,"onUpdate:modelValue":t[2]||(t[2]=p=>e(c).departName=p),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(d,{label:"部门代码:"},{default:n(()=>[o(r,{modelValue:e(c).departNo,"onUpdate:modelValue":t[3]||(t[3]=p=>e(c).departNo=p),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(d,{label:"地区:"},{default:n(()=>[o(T,{modelValue:e(c).areaNo,"onUpdate:modelValue":t[4]||(t[4]=p=>e(c).areaNo=p),placeholder:"请选择地区",options:_.value,"field-names":{label:"cityName",value:"provinceCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(d,{label:"签署人:"},{default:n(()=>[o(r,{modelValue:e(c).signingName,"onUpdate:modelValue":t[5]||(t[5]=p=>e(c).signingName=p),modelModifiers:{trim:!0},placeholder:"请输入签署人"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(d,{label:"合同状态:"},{default:n(()=>[o(T,{modelValue:e(c).state,"onUpdate:modelValue":t[6]||(t[6]=p=>e(c).state=p),placeholder:"请选择合同状态",options:e(L)("contractState"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),operate:n(()=>[o(ue,null,{default:n(()=>[R((N(),C(x,{type:"outline",status:"warning",disabled:!e(l).selectedKeys.length,onClick:t[7]||(t[7]=u=>E())},{icon:n(()=>[o(re)]),default:n(()=>[z(" 手动批量申报 ")]),_:1},8,["disabled"])),[[e(g),"BusinessContractDockingBatchApply"]]),R((N(),C(x,{type:"outline",status:"danger",disabled:!e(l).selectedKeys.length,onClick:t[8]||(t[8]=u=>j())},{icon:n(()=>[o(ie)]),default:n(()=>[z(" 手动补充协议 ")]),_:1},8,["disabled"])),[[e(g),"BusinessContractDockingSupplementAgreement"]])]),_:1})]),table:n(()=>[o(de,{"selected-keys":e(l).selectedKeys,"onUpdate:selectedKeys":t[9]||(t[9]=u=>e(l).selectedKeys=u),class:"zs-table","row-key":"id",data:e(M),"row-selection":e(l).rowSelection,bordered:e(l).bordered,pagination:e(l).pagination,size:e(l).size,columns:e(P),stripe:e(l).stripe,loading:e(le)},{operate:n(({record:u})=>[o(ce,null,{default:n(()=>[o(x,{type:"text",status:"success",onClick:p=>a.$router.push(`/business/contractDocking/operate?id=${u.id}&isReadOnly=true`)},{default:n(()=>[z("详情")]),_:2},1032,["onClick"]),u.state!=="0"?R((N(),C(x,{key:0,type:"text",status:"danger",onClick:p=>e(y)(u,()=>oe(u))},{default:n(()=>[z("作废")]),_:2},1032,["onClick"])),[[e(g),"BusinessContractDockingCancel"]]):$("",!0),u.contractNumber&&u.fileURL?R((N(),C(x,{key:1,type:"text",status:"warning",onClick:p=>e(y)(u,()=>ae(u))},{default:n(()=>[z(" 下载 ")]),_:2},1032,["onClick"])),[[e(g),"BusinessContractDockingDownload"]]):$("",!0),u.state!="1"?R((N(),C(x,{key:2,type:"text",status:"warning",onClick:p=>e(y)(u,()=>K(u))},{default:n(()=>[z("重新申报")]),_:2},1032,["onClick"])),[[e(g),"BusinessContractDockingReDeclaration"]]):$("",!0),u.state=="6"||u.state=="2"?R((N(),C(x,{key:3,type:"text",onClick:p=>e(y)(u,()=>ne(u))},{default:n(()=>[z("重发短信")]),_:2},1032,["onClick"])),[[e(g),"BusinessContractDockingMessage"]]):$("",!0)]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(s)==="zsRestock"?(N(),C(ve,{key:0,data:e(v),onSuccess:W,onClose:t[10]||(t[10]=u=>e(y)({},()=>e(V)(null)))},null,8,["data"])):$("",!0),e(s)==="zsDeclare"?(N(),C(De,{key:1,data:e(v),onSuccess:W,onClose:t[11]||(t[11]=u=>e(y)({},()=>e(V)(null)))},null,8,["data"])):$("",!0)])}}});export{xe as default};
