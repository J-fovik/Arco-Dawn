import{d as A,k as B,g as F,h as E,i as H,r as a,o as b,l as P,w as o,a as t,b as e,p as W,M as te,m as I,S as V,n as oe,j as ae,c as q,e as R,q as le}from"./index-d007178a.js";import{f as j,c as ne,_ as se}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-430f1ffc.js";import{f as re,A as D}from"./options-aafac76d.js";import"./index-13860ba0.js";const $=[{label:"风光",value:"1"},{label:"生活",value:"2"}],ie=()=>[{title:"序号",width:80,dataIndex:"sortTableNo",show:!0,align:"center"},{title:"院校名称",dataIndex:"yxmc",show:!0,align:"center",render:({record:h})=>j(h.yxmc)},{title:"图片类型",dataIndex:"photoType",show:!0,align:"center",render:({record:h})=>{var u;return j((u=re($,h.photoType))==null?void 0:u.label)}},{title:"院校图片",dataIndex:"photoUrl",show:!0,tooltip:!0,ellipsis:!0,align:"center",slotName:"photoUrl"},{title:"操作",width:100,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],de=A({name:"ZsAddPhoto"}),ce=A({...de,props:{data:{default:()=>({})}},emits:["close","success"],setup(h,{emit:u}){const p=h;B("");const T=F(),[y,i]=E(null),{form:r,formRef:x}=H(()=>({...p.data}));let _=B([]);const O={yxId:{required:!0,message:"请选择院校"},photoType:{required:!0,message:"请选择图片类型"}},n=()=>{x.value.validate(f=>{f||(p.data.id?k("editSchoolPhoto"):k("addSchoolPhoto"))})},k=async f=>{if(_.value.length<=0&&r.value.photoUrl===void 0){te.error("请上传图片");return}const{err:s}=await I(()=>V[f]({photoUrl:_.value,...r.value}),{before:()=>i("okLoading"),after:()=>i(null)});s||(u("success"),u("close"))},C=async f=>{const{res:s,err:g}=await I(()=>V.uploadSchoolPhoto({photo:f.at(-1).file}),{after:()=>i(null),before:()=>i("上传图片")});g||(_.value.push(s==null?void 0:s.data),r.value.photoUrl=_.value)};return(f,s)=>{const g=a("a-select"),w=a("a-form-item"),v=a("a-grid-item"),K=a("a-image"),N=a("a-upload"),S=a("a-grid"),m=a("a-form"),l=a("a-modal");return b(),P(l,{title:e(ne)("院校图片",!!p.data.id),"unmount-on-close":"",visible:"",top:"5%",width:"500px","align-center":!1,"mask-closable":!1,"ok-loading":e(y)==="okLoading",onCancel:s[2]||(s[2]=d=>u("close")),onOk:n},{default:o(()=>[t(m,{ref_key:"formRef",ref:x,model:e(r),"label-align":"left",size:"large","auto-label-width":"",rules:O},{default:o(()=>[t(S,{cols:1,"col-gap":24},{default:o(()=>[t(v,null,{default:o(()=>[t(w,{field:"yxId",label:"院校名称:"},{default:o(()=>[t(g,{modelValue:e(r).yxId,"onUpdate:modelValue":s[0]||(s[0]=d=>e(r).yxId=d),options:e(T).schoolList,"virtual-list-props":{height:200},"allow-search":"","allow-clear":"",placeholder:"请选择院校名称"},null,8,["modelValue","options"])]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(w,{field:"photoType",label:"图片类型:"},{default:o(()=>[t(g,{modelValue:e(r).photoType,"onUpdate:modelValue":s[1]||(s[1]=d=>e(r).photoType=d),placeholder:"请选择图片类型","allow-clear":"",options:[...e(D),...e($)]},null,8,["modelValue","options"])]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(w,{field:"photoArray",label:"图片:"},{default:o(()=>[e(r).photoUrl&&p.data.id?(b(),P(K,{key:0,disabled:p.data.id,src:e(r).photoUrl,width:"100"},null,8,["disabled","src"])):W("",!0),t(N,{"default-file-list":e(_),"list-type":"picture-card",disabled:!!p.data.id,ref:"uploadRef","auto-upload":!1,"show-cancel-button":!1,"show-remove-button":!1,"show-link":!1,"show-file-list":!0,accept:".png,.jpg,.jpeg","image-preview":"",onChange:C},null,8,["default-file-list","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","ok-loading"])}}}),ue={key:1},pe=A({name:"SchoolSchoolPhoto"}),ge=A({...pe,setup(h){const{warningModal:u}=le(),p=F(),[T,y]=E(null),{form:i,resetForm:r}=H(()=>({yxId:"",photoType:"",photoUrl:[]}),()=>C()),{selectRow:x,columnsData:_,visibleColumnsData:O,tableBaseOptions:n,createRowNo:k,resetData:C,extendTableList:f,setSelectRow:s,changeTableColumn:g,changeTableSize:w}=oe(ie(),()=>S()),v=m=>{u(`确定操作选中的${n.selectedKeys.length}数据吗？`,async l=>{const{err:d}=await I(()=>V.deleteSchoolPhoto({ids:n.selectedKeys}),{successMsg:"操作成功"});d||(l(!0),n.selectedKeys=[],S())})},{data:K,loading:N,initData:S}=ae(async()=>{const{res:m,err:l}=await I(()=>V.getSchoolPhotoList({...i.value,currentPage:n.pagination.current,pageSize:n.pagination.pageSize,pagingOrNot:"1"}));return l?[]:(n.pagination.total=m.data.totalCount,m==null?void 0:m.data.resultList.map((d,U)=>({sortTableNo:k(U),...d})))});return(m,l)=>{const d=a("a-select"),U=a("a-form-item"),M=a("a-grid-item"),Y=a("a-grid"),Z=a("a-form"),G=a("icon-plus"),L=a("a-button"),J=a("icon-close"),Q=a("a-space"),X=a("a-image"),ee=a("a-table");return b(),q("div",null,[t(se,{fold:"","table-columns":e(_),"table-size":e(n).size,onResetSearch:e(r),onSearch:e(C),onChangeTableSize:e(w),onChangeTableColumn:e(g)},{form:o(({collapsed:c})=>[t(Z,{model:e(i),"label-align":"left",size:"large","auto-label-width":""},{default:o(()=>[t(Y,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!c},{default:o(()=>[t(M,null,{default:o(()=>[t(U,{label:"院校名称:"},{default:o(()=>[t(d,{modelValue:e(i).yxId,"onUpdate:modelValue":l[0]||(l[0]=z=>e(i).yxId=z),"virtual-list-props":{height:200},"allow-search":"","allow-clear":"",options:[...e(D),...e(p).schoolList],placeholder:"请输入院校名称"},null,8,["modelValue","options"])]),_:1})]),_:1}),t(M,null,{default:o(()=>[t(U,{label:"图片类型:"},{default:o(()=>[t(d,{modelValue:e(i).photoType,"onUpdate:modelValue":l[1]||(l[1]=z=>e(i).photoType=z),placeholder:"请选择图片类型","allow-clear":"",options:[...e(D),...e($)]},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),operate:o(()=>[t(Q,null,{default:o(()=>[t(L,{type:"outline",onClick:l[2]||(l[2]=c=>e(y)("zsAddPhoto"))},{icon:o(()=>[t(G)]),default:o(()=>[R(" 新增 ")]),_:1}),t(L,{type:"outline",status:"danger",disabled:!e(n).selectedKeys.length,loading:e(T)==="删除",onClick:l[3]||(l[3]=c=>v("batchDeleteUser"))},{icon:o(()=>[t(J)]),default:o(()=>[R(" 删除 ")]),_:1},8,["disabled","loading"])]),_:1})]),table:o(()=>[t(ee,{"selected-keys":e(n).selectedKeys,"onUpdate:selectedKeys":l[4]||(l[4]=c=>e(n).selectedKeys=c),class:"zs-table","row-key":"id",data:e(K),"row-selection":e(n).rowSelection,bordered:e(n).bordered,pagination:e(n).pagination,size:e(n).size,columns:e(O),stripe:e(n).stripe,loading:e(N)},{photoUrl:o(({record:c})=>[c.photoUrl?(b(),P(X,{key:0,src:c.photoUrl,width:"100"},null,8,["src"])):(b(),q("div",ue,"--"))]),operate:o(({record:c})=>[t(L,{type:"text",onClick:z=>e(s)(c,()=>e(y)("zsAddPhoto"))},{default:o(()=>[R("编辑")]),_:2},1032,["onClick"])]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(T)==="zsAddPhoto"?(b(),P(ce,{key:0,data:e(x),onSuccess:e(S),onClose:l[5]||(l[5]=c=>e(s)({},()=>e(y)(null)))},null,8,["data","onSuccess"])):W("",!0)])}}});export{ge as default};
