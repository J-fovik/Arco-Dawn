import{d as w,h as A,i as q,r as s,o as C,l as K,w as a,a as t,b as e,m as x,O as R,j as P,v as Y,Q as G,n as H,c as J,e as V,p as Z,q as W}from"./index-d007178a.js";import{f as L,h as X,c as ee,_ as te}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-430f1ffc.js";import{e as ae}from"./rules-f293393f.js";import"./index-13860ba0.js";const oe=()=>[{title:"序号",width:80,dataIndex:"sortTableNo",show:!0,align:"center"},{title:"角色代码",dataIndex:"code",show:!0,align:"center",render:({record:d})=>L(d.code)},{title:"角色名称",dataIndex:"uname",show:!0,align:"center",render:({record:d})=>L(d.uname)},{title:"操作时间",dataIndex:"createTime",show:!0,align:"center",render:({record:d})=>X(d.createTime)},{title:"备注",dataIndex:"bz",show:!0,align:"center",render:({record:d})=>L(d.bz)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],ne=w({name:"ZsAddRole"}),le=w({...ne,props:{data:{default:()=>({})}},emits:["close","success"],setup(d,{emit:f}){const c=d,[g,r]=A(null),{form:i,formRef:p}=q(()=>({...c.data,dataPowerFlag:"0"})),b={uname:{required:!0,message:"请输入角色名"},code:{required:!0,message:"请输入角色代码",validator:(m,n)=>{ae(m)||n("角色代码只能输入英文")}}},_=()=>{p.value.validate(m=>{m||(c.data.id?o("editRole"):o("addRole"))})},o=async m=>{const{err:n}=await x(()=>R[m](i.value),{before:()=>r("okLoading"),after:()=>r(null)});n||(f("success"),f("close"))};return(m,n)=>{const h=s("a-input"),k=s("a-form-item"),D=s("a-textarea"),$=s("a-form"),I=s("a-modal");return C(),K(I,{top:"10%",width:"500px","unmount-on-close":"",title:e(ee)("角色",!!c.data.id),visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(g)==="okLoading",onCancel:n[3]||(n[3]=y=>f("close")),onOk:_},{default:a(()=>[t($,{ref_key:"formRef",ref:p,model:e(i),"label-align":"left",size:"large","auto-label-width":"",rules:b},{default:a(()=>[t(k,{field:"code",label:"角色代码:",required:""},{default:a(()=>[t(h,{modelValue:e(i).code,"onUpdate:modelValue":n[0]||(n[0]=y=>e(i).code=y),disabled:!!c.data.id,placeholder:"请输入角色代码"},null,8,["modelValue","disabled"])]),_:1}),t(k,{field:"uname",label:"角色名:",required:""},{default:a(()=>[t(h,{modelValue:e(i).uname,"onUpdate:modelValue":n[1]||(n[1]=y=>e(i).uname=y),placeholder:"请输入角色名"},null,8,["modelValue"])]),_:1}),t(k,{field:"bz",label:"备注:"},{default:a(()=>[t(D,{modelValue:e(i).bz,"onUpdate:modelValue":n[2]||(n[2]=y=>e(i).bz=y),"max-length":200,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","ok-loading"])}}}),se=w({name:"ZsDistributionPower"}),de=w({...se,props:{data:{default:()=>({})}},emits:["close","success"],setup(d,{emit:f}){const c=d,[g,r]=A(null),i=async()=>{const{err:b}=await x(()=>R.editRoleKey({roleId:c.data.id,menuIdList:p.value}),{before:()=>r("okLoading"),after:()=>r(null)});b||(f("success"),f("close"))},{data:p}=P(async()=>{const{res:b,err:_}=await x(()=>R.getRoleKeyList({roleId:c.data.id}));return _?[]:b.data.map(o=>o.powerId)});return(b,_)=>{const o=s("a-tree"),m=s("a-drawer");return C(),K(m,{title:"权限分配",visible:"","unmount-on-close":"",width:500,"mask-closable":!1,"ok-loading":e(g)==="okLoading",onCancel:_[1]||(_[1]=n=>f("close")),onOk:i},{default:a(()=>[t(o,{"checked-keys":e(p),"onUpdate:checkedKeys":_[0]||(_[0]=n=>Y(p)?p.value=n:null),checkable:"","show-line":"",fieldNames:{key:"name",title:"title",children:"children",icon:""},data:e(G)},null,8,["checked-keys","data"])]),_:1},8,["ok-loading"])}}}),re=w({name:"SystemRoleManage"}),pe=w({...re,setup(d){const{warningModal:f}=W(),[c,g]=A(null),{form:r,resetForm:i}=q(()=>({code:"",uname:""}),()=>m()),{selectRow:p,columnsData:b,visibleColumnsData:_,tableBaseOptions:o,resetData:m,setSelectRow:n,extendTableList:h,changeTableColumn:k,changeTableSize:D}=H(oe(),()=>S()),$=v=>{f(`确定操作选中的${o.selectedKeys.length}数据吗？`,async l=>{const{err:z}=await x(()=>R[v]({idList:o.selectedKeys}),{successMsg:"操作成功"});z||(l(!0),o.selectedKeys=[],S())})},{data:I,loading:y,initData:S}=P(async()=>{const{res:v,err:l}=await x(()=>R.getRoleList({...r.value,currentPage:o.pagination.current,pageSize:o.pagination.pageSize,pagingOrNot:"1"}));return l?[]:(o.pagination.total=v.data.totalCount,h(v.data.roleList))});return(v,l)=>{const z=s("a-input"),M=s("a-form-item"),N=s("a-grid-item"),B=s("a-grid"),O=s("a-form"),F=s("icon-plus"),T=s("a-button"),E=s("icon-close"),U=s("a-space"),j=s("a-table");return C(),J("div",null,[t(te,{"table-columns":e(b),"table-size":e(o).size,onResetSearch:e(i),onSearch:e(m),onChangeTableSize:e(D),onChangeTableColumn:e(k)},{form:a(()=>[t(O,{model:e(r),"label-align":"left",size:"large","auto-label-width":""},{default:a(()=>[t(B,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:a(()=>[t(N,null,{default:a(()=>[t(M,{field:"code",label:"角色代码:"},{default:a(()=>[t(z,{modelValue:e(r).code,"onUpdate:modelValue":l[0]||(l[0]=u=>e(r).code=u),placeholder:"请输入角色代码"},null,8,["modelValue"])]),_:1})]),_:1}),t(N,null,{default:a(()=>[t(M,{field:"uname",label:"角色名称:"},{default:a(()=>[t(z,{modelValue:e(r).uname,"onUpdate:modelValue":l[1]||(l[1]=u=>e(r).uname=u),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),operate:a(()=>[t(U,null,{default:a(()=>[t(T,{type:"outline",onClick:l[2]||(l[2]=u=>e(g)("ZsAddRole"))},{icon:a(()=>[t(F)]),default:a(()=>[V(" 新增 ")]),_:1}),t(T,{type:"outline",status:"danger",disabled:!e(o).selectedKeys.length,loading:e(c)==="删除",onClick:l[3]||(l[3]=u=>$("batchDeleteRole"))},{icon:a(()=>[t(E)]),default:a(()=>[V(" 删除 ")]),_:1},8,["disabled","loading"])]),_:1})]),table:a(()=>[t(j,{"selected-keys":e(o).selectedKeys,"onUpdate:selectedKeys":l[4]||(l[4]=u=>e(o).selectedKeys=u),class:"zs-table","row-key":"id",data:e(I),"row-selection":e(o).rowSelection,bordered:e(o).bordered,pagination:e(o).pagination,size:e(o).size,columns:e(_),stripe:e(o).stripe,loading:e(y)},{operate:a(({record:u})=>[t(U,null,{default:a(()=>[t(T,{type:"text",onClick:Q=>e(n)(u,()=>e(g)("ZsAddRole"))},{default:a(()=>[V("编辑")]),_:2},1032,["onClick"]),t(T,{type:"text",status:"success",onClick:Q=>e(n)(u,()=>e(g)("ZsDistributionPower"))},{default:a(()=>[V("权限分配")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(c)==="ZsAddRole"?(C(),K(le,{key:0,data:e(p),onSuccess:e(S),onClose:l[5]||(l[5]=u=>e(n)({},()=>e(g)(null)))},null,8,["data","onSuccess"])):Z("",!0),e(c)==="ZsDistributionPower"?(C(),K(de,{key:1,data:e(p),onSuccess:e(S),onClose:l[6]||(l[6]=u=>e(n)({},()=>e(g)(null)))},null,8,["data","onSuccess"])):Z("",!0)])}}});export{pe as default};
