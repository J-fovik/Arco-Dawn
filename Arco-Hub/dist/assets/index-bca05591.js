import{n as R,d as U,u as $,a as J,C as Q,D as S,E as W,s as X,r as s,o as _,l as y,w as n,g as a,c as t,e as Y,i as c,h as v,F as ee,f as C,k as b,G as te,H as ae,B as g,_ as le}from"./index-8a2cb146.js";import{Z as oe}from"./index-2bbe694f.js";const ne=[{title:"接收人姓名",dataIndex:"name"},{title:"是否已读",align:"center",dataIndex:"isRead",render:({record:u})=>R(u.isRead==="1"?"未读":"已读")},{title:"阅读时间",align:"center",dataIndex:"updateTime",render:({record:u})=>R(u.updateTime)}],re=u=>(te("data-v-1c5905f8"),u=u(),ae(),u),se=re(()=>C("div",{style:{height:"100px"}},null,-1)),de={class:"orderSubmit-footer box-flex jc-fe"},ie=U({name:"AdministrationNoticeManageOperate"}),ue=U({...ie,setup(u){const m=$(),{getDictionaryInfo:x}=J(),{jumpTabName:N}=Q(),T=S([]),q=S([]),[z,k]=W(null),{form:l,formRef:I,formPlaceholder:B}=X(()=>({title:"",info:"",type:"",depart:"",state:"",remark:"",reciveUser:"0",fileList:[],departmentType:[]})),O={title:{required:!0,message:"请输入标题"},departmentType:{required:!0,message:"请选择部门"},type:{required:!0,message:"请选择公告类型"},state:{required:!0,message:"请选择公告状态"},info:{required:!0,message:"请输入内容"}},P=async o=>{if(o.file){const{res:e}=await b(()=>g.uploadNoticeFile({file:o.file}));return{attName:o.name,attSize:parseInt(`${o.file.size/1024}`),attPath:e==null?void 0:e.data}}return{attName:o.name,attSize:o.attSize,attPath:o.url}},A=()=>{I.value.validate(o=>{o||F()})},F=async()=>{const{fileList:o,departmentType:e,...f}=l.value,d={...f,depart:e.join(","),fileList:await Promise.all(o.map(p=>P(p)))},{err:i}=await b(()=>g.addNotice(d),{before:()=>k("okLoading"),after:()=>k(null),successMsg:"保存成功"});i||N()},V=async()=>{const{err:o,res:e}=await b(()=>g.getNoticeDepartmentTree({departType:l.value.reciveUser}));o||(q.value=e==null?void 0:e.data.deptList)},M=o=>{l.value.reciveUser=o,l.value.departmentType=[],V()},j=async()=>{const{res:o,err:e}=await b(()=>g.getNoticeDetail({id:m.query.id}));if(e)return;const{recipientList:f,fileList:d,...i}=o==null?void 0:o.data;l.value={...i,departmentType:i.depart.split(","),fileList:d.map(p=>({name:p.attName,url:p.attPath,status:"done",uid:p.id,attSize:p.attSize}))},T.value=f,V()};return m.query.id?j():V(),(o,e)=>{const f=s("a-input"),d=s("a-form-item"),i=s("a-radio"),p=s("a-radio-group"),E=s("a-cascader"),h=s("a-select"),w=s("a-textarea"),K=s("a-upload"),Z=s("a-form"),D=s("a-card"),G=s("a-table"),L=s("a-button"),H=s("a-space");return _(),y(oe,null,{default:n(()=>[a(D,{title:"基本公告维护",bordered:!1,class:"general-card"},{default:n(()=>[a(Z,{ref_key:"formRef",ref:I,model:t(l),"label-align":"left",size:"large",style:{width:"800px","padding-left":"100px"},"auto-label-width":"",rules:O,disabled:!!t(m).query.isReadOnly},{default:n(()=>[a(d,{field:"title",label:"标题:",required:""},{default:n(()=>[a(f,{modelValue:t(l).title,"onUpdate:modelValue":e[0]||(e[0]=r=>t(l).title=r),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(m).query.isReadOnly?v("",!0):(_(),Y(ee,{key:0},[a(d,{field:"reciveUser",label:"部门类型:",required:""},{default:n(()=>[a(p,{"model-value":t(l).reciveUser,onChange:M},{default:n(()=>[a(i,{value:"0"},{default:n(()=>[c("后台")]),_:1}),a(i,{value:"1"},{default:n(()=>[c("营业部")]),_:1}),a(i,{value:"2"},{default:n(()=>[c("供应")]),_:1}),a(i,{value:"3"},{default:n(()=>[c("全部")]),_:1})]),_:1},8,["model-value"])]),_:1}),t(l).reciveUser!=="3"?(_(),y(d,{key:0,field:"departmentType",label:"部门选择:",required:""},{default:n(()=>[a(E,{modelValue:t(l).departmentType,"onUpdate:modelValue":e[1]||(e[1]=r=>t(l).departmentType=r),"allow-search":"",multiple:"",options:q.value,fieldNames:{label:"name",value:"userId",children:"children"},"max-tag-count":5,placeholder:"请选择"},null,8,["modelValue","options"])]),_:1})):v("",!0)],64)),a(d,{field:"type",label:"公告类型:",required:""},{default:n(()=>[a(h,{modelValue:t(l).type,"onUpdate:modelValue":e[2]||(e[2]=r=>t(l).type=r),options:t(x)("systemBulletin_type"),"field-names":{label:"detailName",value:"detailCode"},placeholder:"请选择公告类型"},null,8,["modelValue","options"])]),_:1}),a(d,{field:"state",label:"公告状态:",required:""},{default:n(()=>[a(h,{modelValue:t(l).state,"onUpdate:modelValue":e[3]||(e[3]=r=>t(l).state=r),options:t(x)("systemBulletin_state"),"field-names":{label:"detailName",value:"detailCode"},placeholder:"请选择公告状态"},null,8,["modelValue","options"])]),_:1}),a(d,{field:"info",label:"内容"},{default:n(()=>[a(w,{modelValue:t(l).info,"onUpdate:modelValue":e[4]||(e[4]=r=>t(l).info=r),"auto-size":{minRows:10},placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),a(d,{field:"coverImage",label:"文件:",extra:"建议不大于5M"},{default:n(()=>[a(K,{"file-list":t(l).fileList,"onUpdate:fileList":e[5]||(e[5]=r=>t(l).fileList=r),"auto-upload":!1,limit:1,"show-remove-button":!t(m).query.isReadOnly},null,8,["file-list","show-remove-button"])]),_:1}),a(d,{field:"bz",label:"备注:"},{default:n(()=>[a(w,{modelValue:t(l).remark,"onUpdate:modelValue":e[6]||(e[6]=r=>t(l).remark=r),placeholder:t(B)("请输入备注")},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model","disabled"])]),_:1}),t(m).query.isReadOnly?(_(),y(D,{key:0,title:"接收人列表",bordered:!1,class:"general-card margin-top"},{default:n(()=>[a(G,{size:"large",columns:t(ne),data:T.value,pagination:!1,bordered:!1},null,8,["columns","data"])]),_:1})):v("",!0),se,C("div",de,[a(H,null,{default:n(()=>[t(m).query.isReadOnly?v("",!0):(_(),y(L,{key:0,loading:t(z)==="okLoading",type:"primary",onClick:A},{default:n(()=>[c("确定")]),_:1},8,["loading"])),a(L,{onClick:e[7]||(e[7]=()=>t(N)())},{default:n(()=>[c("返回")]),_:1})]),_:1})])]),_:1})}}});const ce=le(ue,[["__scopeId","data-v-1c5905f8"]]);export{ce as default};
