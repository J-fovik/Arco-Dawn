import{a as q,n as p,X,p as C,O as S,P as y,d as R,m as G,q as H,s as J,v as Q,M as W,x as Z,y as ee,r as d,o as f,e as te,g as r,w as n,c as e,l as h,i as x,h as I,z as N,V as ae,A as re,k as v}from"./index-8a2cb146.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{B as oe}from"./business-b0ce0e8a.js";import{R as le}from"./reconciliation-6ca30c07.js";import"./index-2bbe694f.js";const se=()=>{const{getDictionaryItem:_}=q();return[{title:"团号",dataIndex:"groupId",show:!0,align:"center",render:({record:t})=>p(t.groupId)},{title:"营业部名称",dataIndex:"departName",show:!0,align:"center",ellipsis:!0,tooltip:!0,render:({record:t})=>p(t.departName)},{title:"线路名称",dataIndex:"routeName",show:!0,align:"center",ellipsis:!0,tooltip:!0,render:({record:t})=>p(t.routeName)},{title:"目的地",dataIndex:"arrival",show:!0,align:"center",ellipsis:!0,tooltip:!0,render:({record:t})=>p(t.arrival)},{title:"创建时间",dataIndex:"createTime",show:!0,align:"center",render:({record:t})=>X(t.createTime,"YYYY-MM-DD")},{title:"报名总费用",dataIndex:"signCost",show:!0,align:"right",render:({record:t})=>C("span",{class:"text-red text-price"},S(y(t.signCost)))},{title:"保险总费用",dataIndex:"insuranceCost",show:!0,align:"right",render:({record:t})=>C("span",{class:"text-red text-price"},S(y(t.insuranceCost)))},{title:"总费用",dataIndex:"totalCost",show:!0,align:"right",render:({record:t})=>C("span",{class:"text-red text-price"},S(y(t.totalCost)))},{title:"结算状态",dataIndex:"settleType",show:!0,align:"center",render:({record:t})=>p(_("new_settlement_type",t.settleType).detailName)},{title:"订单状态",dataIndex:"state",show:!0,align:"center",render:({record:t})=>p(_("new_trade_order",t.state).detailName)},{title:"调账状态",dataIndex:"transferState",show:!0,align:"center",render:({record:t})=>p(_("travelRouteAdjustmentState",t.transferState).detailName)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}]},ie=R({name:"ReconciliationBusinessOrder"}),fe=R({...ie,setup(_){const t=G(),{vAuthority:w}=H(),{warningModal:z}=re(),{form:i,resetForm:D}=J(()=>({groupId:"",departName:"",departNo:"",routeName:"",arrival:""}),()=>T()),{selectRow:ue,columnsData:O,visibleColumnsData:B,tableBaseOptions:u,resetData:T,setSelectRow:k,extendTableList:A,changeTableColumn:M,changeTableSize:$}=Q(se(),()=>V());W(async()=>{const{err:l,res:a}=await v(()=>oe.getDepartsBox({}));if(!l)return a==null?void 0:a.data});const U=l=>{if(l.settleType!="0"){ae.error("当前团已经开始结算或结算完成，不允许进行调账！");return}t.push(`/reconciliation/businessOrder/operate?groupId=${l.groupId}&isReadOnly=true`)},j=l=>{z("确认要通过?",async a=>{a(!0)})},{data:E,loading:L,initData:V}=Z(async()=>{const{res:l,err:a}=await v(()=>le.getBusinessList({...i.value,currentPage:u.pagination.current,pageSize:u.pagination.pageSize,pagingOrNot:"1"}));return a?[]:(u.pagination.total=l.data.totalCount,A(l==null?void 0:l.data.signupRecordList))});return ee(V),(l,a)=>{const c=d("a-input"),m=d("a-form-item"),g=d("a-grid-item"),P=d("a-grid"),Y=d("a-form"),b=d("a-button"),F=d("a-button-group"),K=d("a-table");return f(),te("div",null,[r(ne,{fold:"","table-columns":e(O),"table-size":e(u).size,onResetSearch:e(D),onSearch:e(T),onChangeTableSize:e($),onChangeTableColumn:e(M)},{form:n(({collapsed:o})=>[r(Y,{model:e(i),"label-align":"left",size:"large","auto-label-width":""},{default:n(()=>[r(P,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!o},{default:n(()=>[r(g,null,{default:n(()=>[r(m,{label:"团号:"},{default:n(()=>[r(c,{modelValue:e(i).groupId,"onUpdate:modelValue":a[0]||(a[0]=s=>e(i).groupId=s),modelModifiers:{trim:!0},placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),r(g,null,{default:n(()=>[r(m,{label:"部门名称:"},{default:n(()=>[r(c,{modelValue:e(i).departName,"onUpdate:modelValue":a[1]||(a[1]=s=>e(i).departName=s),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),r(g,null,{default:n(()=>[r(m,{label:"部门代码:"},{default:n(()=>[r(c,{modelValue:e(i).departNo,"onUpdate:modelValue":a[2]||(a[2]=s=>e(i).departNo=s),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),r(g,null,{default:n(()=>[r(m,{label:"线路名称:"},{default:n(()=>[r(c,{modelValue:e(i).routeName,"onUpdate:modelValue":a[3]||(a[3]=s=>e(i).routeName=s),modelModifiers:{trim:!0},placeholder:"请输入线路名称"},null,8,["modelValue"])]),_:1})]),_:1}),r(g,null,{default:n(()=>[r(m,{label:"目的地:"},{default:n(()=>[r(c,{modelValue:e(i).arrival,"onUpdate:modelValue":a[4]||(a[4]=s=>e(i).arrival=s),modelModifiers:{trim:!0},placeholder:"请输入目的地"},null,8,["modelValue"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),table:n(()=>[r(K,{"selected-keys":e(u).selectedKeys,"onUpdate:selectedKeys":a[5]||(a[5]=o=>e(u).selectedKeys=o),class:"zs-table","row-key":"id",data:e(E),"row-selection":e(u).rowSelection,bordered:e(u).bordered,pagination:e(u).pagination,size:e(u).size,columns:e(B),stripe:e(u).stripe,loading:e(L)},{operate:n(({record:o})=>[r(F,null,{default:n(()=>[o.transferState=="2"||o.transferState=="5"?(f(),h(b,{key:0,type:"text",status:"success",onClick:s=>l.$router.push(`/reconciliation/businessOrder/operate?groupId=${o.groupId}`)},{default:n(()=>[x("详情")]),_:2},1032,["onClick"])):I("",!0),o.transferState=="2"?N((f(),h(b,{key:1,type:"text",onClick:s=>l.$router.push(`/reconciliation/businessOrder/operate?groupId=${o.groupId}&isSure=true`)},{default:n(()=>[x("审核")]),_:2},1032,["onClick"])),[[e(w),"ReconciliationBusinessOrderExamine"]]):I("",!0),o.transferState=="6"?N((f(),h(b,{key:2,type:"text",status:"danger",onClick:s=>e(k)(o,()=>j(o))},{default:n(()=>[x("确定驳回")]),_:2},1032,["onClick"])),[[e(w),"ReconciliationBusinessOrderReject"]]):I("",!0),o.transferState!="2"&&o.transferState!="3"&&o.transferState!="5"?N((f(),h(b,{key:3,type:"text",status:"warning",onClick:s=>e(k)(o,()=>U(o))},{default:n(()=>[x("调账")]),_:2},1032,["onClick"])),[[e(w),"ReconciliationBusinessOrderAdjustAccount"]]):I("",!0)]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"])])}}});export{fe as default};
