import{a as R,n as g,p as b,O as h,P as I,d as M,q as ae,E as le,s as oe,R as ne,b as z,k as w,v as re,y as se,r as d,o as x,e as O,g as t,w as l,c as e,f as A,i as N,t as ue,h as U,z as ie,l as de,A as pe,S as me}from"./index-8a2cb146.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{O as y}from"./order-70291d37.js";import"./index-2bbe694f.js";const ge=()=>{const{getDictionaryItem:V}=R();return[{title:"团号",dataIndex:"groupId",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(o.groupId)},{title:"供应商",dataIndex:"supName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(o.supName)},{title:"营业部名称",dataIndex:"departName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(o.departName)},{title:"线路名称",dataIndex:"routeName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(o.routeName)},{title:"人数",dataIndex:"totalNumber",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(o.totalNumber)},{title:"订单同行费用",dataIndex:"signCost",show:!0,width:120,align:"right",render:({record:o})=>b("span",{class:"text-red text-price"},h(I(o.signCost)))},{title:"结算控制",width:150,slotName:"switch",show:!0,align:"center"},{title:"扣点（%）",dataIndex:"ratio",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>b("span",{class:"text-green"},h(I(o.ratio)))},{title:"保险费用",dataIndex:"insuranceCost",show:!0,ellipsis:!0,tooltip:!0,align:"right",render:({record:o})=>b("span",{class:"text-red text-price"},h(I(o.insuranceCost)))},{title:"供应商结算金额",dataIndex:"setValue",show:!0,ellipsis:!0,tooltip:!0,align:"right",render:({record:o})=>b("span",{class:"text-red text-price"},h(I(o.setValue)))},{title:"结算状态",dataIndex:"settleType",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(V("signupSettleType",o.settleType).detailName)},{title:"订单状态",dataIndex:"state",show:!0,align:"center",render:({record:o})=>g(V("new_trade_order",o.state).detailName)},{title:"创建时间",dataIndex:"createTimeStr",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:o})=>g(o.createTimeStr)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}]},fe=A("span",{class:"mx-3"},"-",-1),_e={key:0},be=M({name:"OrderPlatformManage"}),Ve=M({...be,setup(V){const{vAuthority:o,userInfo:P}=ae(),[L,v]=le(null),{getDictionaryInfo:S}=R(),{warningModal:$}=pe(),{form:n,resetForm:B}=oe(()=>({supId:"",routeName:"",groupId:"",departName:"",departNo:"",state:"",address:"",startDate:"",settleType:"",endDate:"",areaNo:""}),()=>T()),C=ne([]),{data:F}=z(async()=>{const{res:s,err:a}=await w(()=>me.getSupplierList({pagingOrNot:"0"}));return a?[]:s==null?void 0:s.data.supplierList},[]),K=s=>{$("确定已开客人发票吗?",async a=>{const{res:p}=await w(()=>y.openCustomerInvoice({groupId:s.groupId}),{successMsg:"操作成功"});a(!0),p&&f()})},E=async s=>{const{err:a}=await w(()=>y.pauseOrRestoreSettle({groupId:s.groupId,pauseOrRestore:s.pauseOrRestore=="1"?"0":"1"}),{before:()=>v(s.id),after:()=>v(null),successMsg:"操作成功"});a||f()},{columnsData:q,visibleColumnsData:Y,tableBaseOptions:i,resetData:T,setSelectRow:j,changeTableColumn:G,changeTableSize:H}=re(ge(),()=>f()),{data:J,loading:Q,initData:f}=z(async()=>{const{res:s,err:a}=await w(()=>y.getPlatFormList({...n.value,currentPage:i.pagination.current,pageSize:i.pagination.pageSize,pagingOrNot:"1"}));return a?[]:(i.pagination.total=s.data.totalCount,C.value=s==null?void 0:s.data.areaList,s==null?void 0:s.data.dataList.map(p=>({...p,disabled:p.settleType!=="3"})))});return se(f),(s,a)=>{const p=d("a-input"),m=d("a-form-item"),c=d("a-grid-item"),_=d("a-select"),D=d("a-date-picker"),W=d("a-grid"),X=d("a-form"),Z=d("a-switch"),k=d("a-button"),ee=d("a-button-group"),te=d("a-table");return x(),O("div",null,[t(ce,{fold:"","table-columns":e(q),"table-size":e(i).size,onResetSearch:e(B),onSearch:e(T),onChangeTableSize:e(H),onChangeTableColumn:e(G)},{form:l(({collapsed:u})=>[t(X,{model:e(n),"label-align":"left",size:"large","auto-label-width":""},{default:l(()=>[t(W,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12,collapsed:!u},{default:l(()=>[t(c,null,{default:l(()=>[t(m,{field:"groupId",label:"团号:"},{default:l(()=>[t(p,{modelValue:e(n).groupId,"onUpdate:modelValue":a[0]||(a[0]=r=>e(n).groupId=r),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{field:"routeName",label:"线路名称:"},{default:l(()=>[t(p,{modelValue:e(n).routeName,"onUpdate:modelValue":a[1]||(a[1]=r=>e(n).routeName=r),placeholder:"请输入线路名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{label:"供应商名称:"},{default:l(()=>[t(_,{modelValue:e(n).supId,"onUpdate:modelValue":a[2]||(a[2]=r=>e(n).supId=r),options:e(F),"field-names":{label:"supName",value:"id"},"virtual-list-props":{height:200},"allow-search":"",placeholder:"请选择供应商名称（可搜索）"},null,8,["modelValue","options"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{label:"订单状态:"},{default:l(()=>[t(_,{modelValue:e(n).state,"onUpdate:modelValue":a[3]||(a[3]=r=>e(n).state=r),placeholder:"请选择订单状态",options:e(S)("new_trade_order"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{label:"部门名称:"},{default:l(()=>[t(p,{modelValue:e(n).departName,"onUpdate:modelValue":a[4]||(a[4]=r=>e(n).departName=r),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{label:"部门代码:"},{default:l(()=>[t(p,{modelValue:e(n).departNo,"onUpdate:modelValue":a[5]||(a[5]=r=>e(n).departNo=r),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{label:"结算状态:"},{default:l(()=>[t(_,{modelValue:e(n).settleType,"onUpdate:modelValue":a[6]||(a[6]=r=>e(n).settleType=r),placeholder:"请选择结算状态",options:e(S)("signupSettleType"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{field:"areaNo",label:"地区:"},{default:l(()=>[t(_,{modelValue:e(n).areaNo,"onUpdate:modelValue":a[7]||(a[7]=r=>e(n).areaNo=r),placeholder:"请选择地区",options:C.value,"field-names":{label:"cityName",value:"provinceCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(m,{label:"出团日期:"},{default:l(()=>[t(D,{modelValue:e(n).startDate,"onUpdate:modelValue":a[8]||(a[8]=r=>e(n).startDate=r),class:"flex1",placeholder:"出团日期(开始)"},null,8,["modelValue"]),fe,t(D,{modelValue:e(n).endDate,"onUpdate:modelValue":a[9]||(a[9]=r=>e(n).endDate=r),class:"flex1",placeholder:"出团日期(结束)"},null,8,["modelValue"])]),_:1})]),_:1})]),_:2},1032,["collapsed"])]),_:2},1032,["model"])]),table:l(()=>[t(te,{"selected-keys":e(i).selectedKeys,"onUpdate:selectedKeys":a[10]||(a[10]=u=>e(i).selectedKeys=u),class:"zs-table","row-key":"groupId",data:e(J),"row-selection":e(i).rowSelection,bordered:e(i).bordered,pagination:e(i).pagination,size:e(i).size,columns:e(Y),stripe:e(i).stripe,loading:e(Q)},{switch:l(({record:u})=>[A("div",null,[t(Z,{size:"medium","model-value":u.pauseOrRestore==="1",loading:e(L)===u.id,disabled:e(P).userAccount!=u.pauseSettleUser&&u.pauseOrRestore==="1",onChange:r=>E(u)},{checked:l(()=>[N("暂停 ")]),unchecked:l(()=>[N(" 恢复 ")]),_:2},1032,["model-value","loading","disabled","onChange"]),u.pauseOrRestore==="1"?(x(),O("div",_e," 暂停人："+ue(u.pauseSettleUser),1)):U("",!0)])]),operate:l(({record:u})=>[t(ee,null,{default:l(()=>[u.customerInvoiceFlag!="1"?ie((x(),de(k,{key:0,type:"text",status:"danger",onClick:r=>e(j)(u,()=>K(u))},{default:l(()=>[N("已开客人发票 ")]),_:2},1032,["onClick"])),[[e(o),"OrderPlatformManagePreviewInvoice"]]):U("",!0),t(k,{type:"text",status:"success",onClick:r=>s.$router.push(`/order/platformManage/operate/?routeId=${u.routeId}&groupId=${u.groupId}`)},{default:l(()=>[N("详情")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"])])}}});export{Ve as default};
