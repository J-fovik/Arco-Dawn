import{d as R,E as de,s as ne,M as z,I as U,r as i,o as b,l as k,w as t,f as p,g as e,c as o,t as ue,h as P,e as re,O as ie,F as se,i as me,k as V,S as y,G as fe,H as pe,A as ce,Y as _e,_ as Ve}from"./index-8a2cb146.js";import{i as be,w as ye,e as ve,f as ge,b as ke,c as Me}from"./rules-4aeaef32.js";import{Z as qe}from"./index-2bbe694f.js";const w=v=>(fe("data-v-0287c5f8"),v=v(),pe(),v),Ne={class:"box-flex"},Ue=w(()=>p("span",{style:{"margin-left":"10px"}},"添加子部门",-1)),we=w(()=>p("span",{style:{"margin-left":"10px"}},"修改部门",-1)),xe=w(()=>p("span",{style:{"margin-left":"10px"}},"删除部门",-1)),he={class:"flex1",style:{"margin-left":"16px"}},Se={class:"box-flex jc-c margin-top"},De=R({name:"SystemDepartmentManage"}),Ce=R({...De,setup(v){const{warningModal:F}=ce(),[B,x]=de(null),{form:a,formRef:h,resetForm:S}=ne(()=>({id:"",type:"edit",parentCode:"",code:"",name:"",country:"",province:"",city:"",district:"",level:"",abbrev:"",departUrl:"",fax:"",officeHours:"",legalPerson:"",email:"",linkman:"",linkIdNumber:"",linkPhone:"",insuVoucher:"",address:"",licenseNo:"",licenseInfo:"",settlementType:"",retentionMoney:void 0,retentionMoneyDesc:"",state:"",bankAccount:"",zjzhh:"",bankAccountName:"",bankName:"",startTime:"",endTime:"",describe:"",remark:""})),j={name:{required:!0,message:"请输入部门名称"},country:{required:!0,message:"请选择所属国家"},province:{required:!0,message:"请选择所属省份"},city:{required:!0,message:"请选择所属市"},district:{required:!0,message:"请选择所属县区"},level:{required:!0,message:"请选择部门等级"},abbrev:{required:!0,message:"请输入部门简写"},legalPerson:{required:!0,message:"请输入法人"},linkman:{required:!0,message:"请输入部门联系人"},retentionMoney:{required:!0,message:"请输入质量保证金"},retentionMoneyDesc:{required:!0,message:"请输入质量保证金备注"},address:{required:!0,message:"请输入营业地址"},settlementType:{required:!0,message:"请选择结算类型"},state:{required:!0,message:"请选择状态"},linkIdNumber:{required:!1,validator:(n,l)=>{n&&!be(n)&&l("请输入正确的身份证")}},departUrl:{required:!1,validator:(n,l)=>{n&&!ye(n)&&l("请输入正确的网站地址")}},email:{required:!1,validator:(n,l)=>{n&&!ve(n)&&l("请输入正确的邮箱")}},fax:{required:!1,validator:(n,l)=>{n&&!ge(n)&&l("请输入正确的传真")}},licenseNo:{required:!1,validator:(n,l)=>{n&&!ke(n)&&l("请输入正确的营业执照")}},bankAccount:{required:!1,validator:(n,l)=>{n&&!Me(n)&&l("请输入正确的传真")}}},{data:c,initData:M}=z(async()=>{const{res:n,err:l}=await V(()=>y.getDepartmentTree({}));return l?{}:n==null?void 0:n.data},{levelList:[],orgList:[],payTypeList:[],settlementTypeList:[],stateList:[]}),g=async n=>{const{res:l}=await V(()=>_e.getAreaInfo(n));return(l==null?void 0:l.data)??[]},{data:H}=z(async()=>await g({level:"1"}),[]),{data:E}=U(async()=>await g({parentNo:a.value.country}),{watchSource:()=>a.value.country,defaultValue:[]}),{data:K}=U(async()=>await g({parentNo:a.value.province}),{watchSource:()=>a.value.province,defaultValue:[]}),{data:O}=U(async()=>await g({parentNo:a.value.city}),{watchSource:()=>a.value.city,defaultValue:[]}),Y=(n,l)=>{n==="添加"?G(l):n==="修改"?D([],{node:l}):Z(l.id)},Z=n=>{F("确定删除该部门吗？",async l=>{const{res:m}=await V(()=>y.deleteDepartment({idList:[n]}),{successMsg:"操作成功"});l(!0),m&&M(),n===a.value.id&&S()})},G=async n=>{const{res:l,err:m}=await V(()=>y.getDepartmentCode({code:n.code,level:n.level}));m||(S(),a.value.parentCode=n.code,a.value.code=l==null?void 0:l.data,a.value.type="add")},D=(n,l)=>{const{children:m,...q}=l.node;a.value=q,a.value.type="edit"},W=async()=>{h.value.validate(n=>{n||(a.value.type==="edit"?C("editDepartment"):C("addDepartment"))})},C=async n=>{const{err:l}=await V(()=>y[n](a.value),{before:()=>x("保存"),after:()=>x(null),successMsg:"保存成功"});l||(a.value.type="edit",M())},$=async n=>{const{res:l,err:m}=await V(()=>y.visibleDepartment({idList:[n.id],businessShowFlag:n.businessShowFlag==="1"?"0":"1"}),{successMsg:n.businessShowFlag==="1"?"已隐藏":"已可见"});m||M()};return(n,l)=>{const m=i("icon-eye"),q=i("icon-eye-invisible"),T=i("a-button"),J=i("icon-plus"),N=i("a-doption"),Q=i("icon-edit"),X=i("icon-lock"),ee=i("a-dropdown"),le=i("a-tree"),I=i("a-card"),s=i("a-input"),r=i("a-form-item"),u=i("a-grid-item"),f=i("a-select"),ae=i("a-input-number"),_=i("a-textarea"),L=i("a-date-picker"),te=i("a-grid"),oe=i("a-form");return b(),k(qe,null,{default:t(()=>[p("div",Ne,[e(I,{class:"general-card",style:{"min-width":"400px"},title:"部门阅览"},{default:t(()=>[o(c).orgList.length?(b(),k(le,{key:0,data:o(c).orgList,fieldNames:{key:"code",title:"name",children:"children"},"default-expanded-keys":[o(c).orgList[0].code],"block-node":"","show-line":"","default-expand-all":"",selectable:"",onSelect:D},{extra:t(d=>[e(T,{type:"text",onClick:A=>$(d)},{default:t(()=>[d.businessShowFlag==="1"?(b(),k(m,{key:0})):(b(),k(q,{key:1}))]),_:2},1032,["onClick"])]),title:t(d=>[e(ee,{trigger:"contextMenu",alignPoint:"",position:"bl","popup-max-height":!1,onSelect:A=>Y(A,d)},{content:t(()=>[e(N,{value:"添加"},{default:t(()=>[e(J),Ue]),_:1}),e(N,{value:"修改"},{default:t(()=>[e(Q),we]),_:1}),e(N,{value:"删除"},{default:t(()=>[e(X),xe]),_:1})]),default:t(()=>[p("span",null,ue(d.name),1)]),_:2},1032,["onSelect"])]),_:1},8,["data","default-expanded-keys"])):P("",!0)]),_:1}),p("div",he,[e(I,{class:"general-card",title:"部门信息"},{default:t(()=>[e(oe,{ref_key:"formRef",ref:h,size:"large",layout:"vertical","auto-label-width":"",model:o(a),rules:j},{default:t(()=>[e(te,{cols:2,"col-gap":20},{default:t(()=>[e(u,null,{default:t(()=>[e(r,{label:"父部门代码:",field:"parentCode",required:""},{default:t(()=>[e(s,{"model-value":o(a).parentCode,placeholder:"父部门代码",readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门代码:",field:"code",required:""},{default:t(()=>[e(s,{"model-value":o(a).code,placeholder:"部门代码",readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门名称:",field:"name",required:""},{default:t(()=>[e(s,{modelValue:o(a).name,"onUpdate:modelValue":l[0]||(l[0]=d=>o(a).name=d),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"所属国家:",field:"country",required:""},{default:t(()=>[e(f,{modelValue:o(a).country,"onUpdate:modelValue":l[1]||(l[1]=d=>o(a).country=d),"allow-search":"",options:o(H),"field-names":{label:"areaName",value:"areaNo"},"virtual-list-props":{height:200},placeholder:"请选择所属国家"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"所属省:",field:"province",required:""},{default:t(()=>[e(f,{modelValue:o(a).province,"onUpdate:modelValue":l[2]||(l[2]=d=>o(a).province=d),options:o(E),"field-names":{label:"areaName",value:"areaNo"},"allow-search":"",placeholder:"请选择所属省"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"所属市:",field:"city",required:""},{default:t(()=>[e(f,{modelValue:o(a).city,"onUpdate:modelValue":l[3]||(l[3]=d=>o(a).city=d),options:o(K),"field-names":{label:"areaName",value:"areaNo"},"allow-search":"",placeholder:"请选择所属市"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"所属县区:",field:"district",required:""},{default:t(()=>[e(f,{modelValue:o(a).district,"onUpdate:modelValue":l[4]||(l[4]=d=>o(a).district=d),modelModifiers:{trim:!0},options:o(O),"field-names":{label:"areaName",value:"areaNo"},"allow-search":"",placeholder:"请选择所属地区"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门等级:",field:"level",required:""},{default:t(()=>[e(f,{modelValue:o(a).level,"onUpdate:modelValue":l[5]||(l[5]=d=>o(a).level=d),modelModifiers:{trim:!0},options:o(c).levelList,"field-names":{label:"detailName",value:"detailCode"},placeholder:"请选择部门等级"},null,8,["modelValue","options"])]),_:1})]),_:1}),o(a).level==="3"?(b(),re(se,{key:0},[e(u,null,{default:t(()=>[e(r,{label:"质量保证金金额:",field:"retentionMoney",required:""},{default:t(()=>[e(ae,{modelValue:o(a).retentionMoney,"onUpdate:modelValue":l[6]||(l[6]=d=>o(a).retentionMoney=d),formatter:d=>o(ie)(d,""),parser:d=>d.replace(/,/g,""),precision:0,min:0,"hide-button":"",placeholder:"请输入保险退款金额"},null,8,["modelValue","formatter","parser"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"质量保证金备注:",field:"retentionMoneyDesc",required:""},{default:t(()=>[e(_,{modelValue:o(a).retentionMoneyDesc,"onUpdate:modelValue":l[7]||(l[7]=d=>o(a).retentionMoneyDesc=d),modelModifiers:{trim:!0},"auto-size":"",placeholder:"请输入保证金备注"},null,8,["modelValue"])]),_:1})]),_:1})],64)):P("",!0),e(u,null,{default:t(()=>[e(r,{label:"部门简写:",field:"abbrev",required:""},{default:t(()=>[e(s,{modelValue:o(a).abbrev,"onUpdate:modelValue":l[8]||(l[8]=d=>o(a).abbrev=d),modelModifiers:{trim:!0},placeholder:"请输入部门简写"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"网站地址:",field:"departUrl"},{default:t(()=>[e(s,{modelValue:o(a).departUrl,"onUpdate:modelValue":l[9]||(l[9]=d=>o(a).departUrl=d),modelModifiers:{trim:!0},placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"传真:",field:"fax"},{default:t(()=>[e(s,{modelValue:o(a).fax,"onUpdate:modelValue":l[10]||(l[10]=d=>o(a).fax=d),modelModifiers:{trim:!0},placeholder:"请输入传真"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"营业时间:",field:"officeHours"},{default:t(()=>[e(_,{modelValue:o(a).officeHours,"onUpdate:modelValue":l[11]||(l[11]=d=>o(a).officeHours=d),modelModifiers:{trim:!0},"auto-size":"",placeholder:"请描述营业时间"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"法人:",field:"legalPerson",required:""},{default:t(()=>[e(s,{modelValue:o(a).legalPerson,"onUpdate:modelValue":l[12]||(l[12]=d=>o(a).legalPerson=d),modelModifiers:{trim:!0},placeholder:"请输入法人"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"邮箱:",field:"email"},{default:t(()=>[e(s,{modelValue:o(a).email,"onUpdate:modelValue":l[13]||(l[13]=d=>o(a).email=d),modelModifiers:{trim:!0},placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门联系人:",field:"linkman",required:""},{default:t(()=>[e(s,{modelValue:o(a).linkman,"onUpdate:modelValue":l[14]||(l[14]=d=>o(a).linkman=d),modelModifiers:{trim:!0},placeholder:"请输入部门联系人"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门联系人身份证号:",field:"linkIdNumber"},{default:t(()=>[e(s,{modelValue:o(a).linkIdNumber,"onUpdate:modelValue":l[15]||(l[15]=d=>o(a).linkIdNumber=d),modelModifiers:{trim:!0},placeholder:"请输入部门联系人身份证号"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门联系电话:",field:"linkPhone"},{default:t(()=>[e(s,{modelValue:o(a).linkPhone,"onUpdate:modelValue":l[16]||(l[16]=d=>o(a).linkPhone=d),modelModifiers:{trim:!0},placeholder:"请输入部门联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"旅行社责任险凭证号:",field:"insuVoucher"},{default:t(()=>[e(s,{modelValue:o(a).insuVoucher,"onUpdate:modelValue":l[17]||(l[17]=d=>o(a).insuVoucher=d),modelModifiers:{trim:!0},placeholder:"请输入旅行社责任险凭证号"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"营业地址:",field:"address",required:""},{default:t(()=>[e(_,{modelValue:o(a).address,"onUpdate:modelValue":l[18]||(l[18]=d=>o(a).address=d),modelModifiers:{trim:!0},"auto-size":"",placeholder:"请输入营业地址"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"营业执照编号:",field:"licenseNo"},{default:t(()=>[e(s,{modelValue:o(a).licenseNo,"onUpdate:modelValue":l[19]||(l[19]=d=>o(a).licenseNo=d),modelModifiers:{trim:!0},placeholder:"请输入营业执照编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"营业执照详细信息:",field:"licenseInfo"},{default:t(()=>[e(_,{modelValue:o(a).licenseInfo,"onUpdate:modelValue":l[20]||(l[20]=d=>o(a).licenseInfo=d),modelModifiers:{trim:!0},"auto-size":"",placeholder:"请输入营业执照详细信息"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"结算类型:",field:"settlementType",required:""},{default:t(()=>[e(f,{modelValue:o(a).settlementType,"onUpdate:modelValue":l[21]||(l[21]=d=>o(a).settlementType=d),modelModifiers:{trim:!0},options:o(c).settlementTypeList,"field-names":{label:"detailName",value:"detailCode"},placeholder:"请选择结算类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"状态:",field:"state",required:""},{default:t(()=>[e(f,{modelValue:o(a).state,"onUpdate:modelValue":l[22]||(l[22]=d=>o(a).state=d),modelModifiers:{trim:!0},placeholder:"请选择状态",options:o(c).stateList,"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"银行账户:",field:"bankAccount"},{default:t(()=>[e(s,{modelValue:o(a).bankAccount,"onUpdate:modelValue":l[23]||(l[23]=d=>o(a).bankAccount=d),modelModifiers:{trim:!0},placeholder:"请输入银行账户"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"资金账号:",field:"zjzhh"},{default:t(()=>[e(s,{modelValue:o(a).zjzhh,"onUpdate:modelValue":l[24]||(l[24]=d=>o(a).zjzhh=d),modelModifiers:{trim:!0},placeholder:"请输入资金账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"账户名称:",field:"bankAccountName"},{default:t(()=>[e(s,{modelValue:o(a).bankAccountName,"onUpdate:modelValue":l[25]||(l[25]=d=>o(a).bankAccountName=d),modelModifiers:{trim:!0},placeholder:"请输入账户名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"开户行:",field:"bankName"},{default:t(()=>[e(s,{modelValue:o(a).bankName,"onUpdate:modelValue":l[26]||(l[26]=d=>o(a).bankName=d),modelModifiers:{trim:!0},placeholder:"请输入开户行"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"签约生效时间:",field:"startTime"},{default:t(()=>[e(L,{modelValue:o(a).startTime,"onUpdate:modelValue":l[27]||(l[27]=d=>o(a).startTime=d),class:"flex1",placeholder:"请选择年月日"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"签约失效时间:",field:"endTime"},{default:t(()=>[e(L,{modelValue:o(a).endTime,"onUpdate:modelValue":l[28]||(l[28]=d=>o(a).endTime=d),class:"flex1",placeholder:"请选择年月日"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"部门描述:",field:"describe"},{default:t(()=>[e(_,{modelValue:o(a).describe,"onUpdate:modelValue":l[29]||(l[29]=d=>o(a).describe=d),modelModifiers:{trim:!0},placeholder:"请输入部门描述"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(r,{label:"备注:",field:"remark"},{default:t(()=>[e(_,{modelValue:o(a).remark,"onUpdate:modelValue":l[30]||(l[30]=d=>o(a).remark=d),modelModifiers:{trim:!0},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:2},{default:t(()=>[p("div",Se,[e(T,{type:"primary",size:"large",loading:o(B)==="保存",onClick:W},{default:t(()=>[me("保存")]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])]),_:1})}}});const Ae=Ve(Ce,[["__scopeId","data-v-0287c5f8"]]);export{Ae as default};
