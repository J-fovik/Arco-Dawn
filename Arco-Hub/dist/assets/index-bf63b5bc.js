import{d as S,h as O,i as B,k as H,r as d,o as v,l as K,w as o,a as t,b as e,c as F,A as J,F as Q,m as y,e as C,t as W,n as X,j as Y,p as Z}from"./index-d007178a.js";import{A as ee}from"./options-aafac76d.js";import{f as _,c as te,_ as ae}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-430f1ffc.js";import{V as A}from"./vip-3bf0329d.js";import"./index-13860ba0.js";const oe=[{label:"禁用",value:"0"},{label:"启用",value:"1"}],ne=()=>[{title:"序号",width:80,dataIndex:"sortTableNo",show:!0,align:"center"},{title:"代理名称",dataIndex:"agentName",show:!0,align:"center",render:({record:r})=>_(r.agentName)},{title:"联系人",dataIndex:"uname",show:!0,align:"center",render:({record:r})=>_(r.uname)},{title:"联系电话",dataIndex:"phone",show:!0,align:"center",render:({record:r})=>_(r.phone)},{title:"专家名称",dataIndex:"zname",show:!0,align:"center",render:({record:r})=>_(r.zname)},{title:"状态",dataIndex:"status",show:!0,align:"center",slotName:"status"},{title:"专属码",dataIndex:"dedicatedCode",show:!0,align:"center",render:({record:r})=>_(r.dedicatedCode)},{title:"提现比例",dataIndex:"commissionRadio",show:!0,align:"center",render:({record:r})=>_(r.commissionRadio)+"%"},{title:"备注",dataIndex:"bak",show:!0,align:"center",tooltip:!0,ellipsis:!0,render:({record:r})=>_(r.bak)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],le=S({name:"zsAddAgent"}),se=S({...le,props:{data:{default:()=>({})}},emits:["close","success"],setup(r,{emit:b}){const g=r,[f,x]=O(null),{form:n,formRef:V}=B(()=>({...g.data})),R={agentName:{required:!0,message:"请输入登录名"},commissionRadio:{required:!0,message:"请输入提成比例"},dedicatedCode:{required:!0,validator:(s,a)=>{s&&s.length<6&&a("请输入专属码（六位数字）")}}},u=H([]);(async()=>{const{res:s,err:a}=await y(()=>A.getExportList({}),{successMsg:""});a||(u.value=s==null?void 0:s.data)})();const T=()=>{V.value.validate(s=>{s||(g.data.id?k("editAgent"):k("addAgent"))})},w=s=>{s!==null&&!isNaN(s)?n.value.commissionRadio=Math.round(s):n.value.commissionRadio=0},D=()=>{n.value.dedicatedCode=n.value.dedicatedCode.replace(/\D/g,"")},L=()=>{n.value.phone=n.value.phone.replace(/\D/g,"")},M=s=>{n.value.zname=s,n.value.zid=u.value.find(a=>a.userName==s).id},k=async s=>{const{err:a}=await y(()=>A[s]({...n.value}),{before:()=>x("okLoading"),after:()=>x(null)});a||(b("success"),b("close"))};return(s,a)=>{const m=d("a-input"),l=d("a-form-item"),h=d("a-option"),c=d("a-select"),z=d("a-input-number"),U=d("a-textarea"),$=d("a-form"),q=d("a-modal");return v(),K(q,{top:"10%",width:"500px",title:e(te)("代理商",!!g.data.id),"unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(f)==="okLoading",onCancel:a[7]||(a[7]=i=>b("close")),onOk:T},{default:o(()=>[t($,{ref_key:"formRef",ref:V,model:e(n),"label-align":"left",size:"large","auto-label-width":"",rules:R},{default:o(()=>[t(l,{field:"agentName",label:"代理名称:",required:""},{default:o(()=>[t(m,{modelValue:e(n).agentName,"onUpdate:modelValue":a[0]||(a[0]=i=>e(n).agentName=i),modelModifiers:{trim:!0},disabled:!!g.data.id,placeholder:"请输入代理名称"},null,8,["modelValue","disabled"])]),_:1}),t(l,{field:"uname",label:"联系人:"},{default:o(()=>[t(m,{modelValue:e(n).uname,"onUpdate:modelValue":a[1]||(a[1]=i=>e(n).uname=i),modelModifiers:{trim:!0},placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),t(l,{field:"phone",label:"联系电话:"},{default:o(()=>[t(m,{modelValue:e(n).phone,"onUpdate:modelValue":a[2]||(a[2]=i=>e(n).phone=i),modelModifiers:{trim:!0},placeholder:"请输入联系电话","max-length":11,onInput:L},null,8,["modelValue"])]),_:1}),t(l,{field:"dedicatedCode",label:"专属码:",required:""},{default:o(()=>[t(m,{modelValue:e(n).dedicatedCode,"onUpdate:modelValue":a[3]||(a[3]=i=>e(n).dedicatedCode=i),modelModifiers:{trim:!0},placeholder:"请输入专属码（六位数字）","max-length":6,onInput:D},null,8,["modelValue"])]),_:1}),t(l,{field:"zname",label:"专家:"},{default:o(()=>[t(c,{modelValue:e(n).zname,"onUpdate:modelValue":a[4]||(a[4]=i=>e(n).zname=i),placeholder:"请选择专家",onChange:M},{default:o(()=>[(v(!0),F(Q,null,J(u.value,(i,N)=>(v(),K(h,{key:N},{default:o(()=>[C(W(i.userName),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1}),t(l,{field:"commissionRadio",label:"提成比例(%):",required:""},{default:o(()=>[t(z,{modelValue:e(n).commissionRadio,"onUpdate:modelValue":a[5]||(a[5]=i=>e(n).commissionRadio=i),modelModifiers:{trim:!0},placeholder:"请输入提成比例",step:1,min:0,max:100,onChange:w},null,8,["modelValue"])]),_:1}),t(l,{field:"bak",label:"备注:"},{default:o(()=>[t(U,{modelValue:e(n).bak,"onUpdate:modelValue":a[6]||(a[6]=i=>e(n).bak=i),"max-length":200,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","ok-loading"])}}}),de=S({name:"VipAgentManage"}),pe=S({...de,setup(r){const[b,g]=O(null),{form:f,resetForm:x}=B(()=>({agentName:"",status:""}),()=>I()),{selectRow:n,columnsData:V,visibleColumnsData:R,tableBaseOptions:u,resetData:I,extendTableList:T,setSelectRow:w,changeTableColumn:D,changeTableSize:L}=X(ne(),()=>a()),M=async m=>{const{err:l}=await y(()=>A.disableAgent({id:m.id,status:m.status==="0"?"1":"0"}),{before:()=>g(m.id),after:()=>g(null),successMsg:"操作成功"});l||a()},{data:k,loading:s,initData:a}=Y(async()=>{const{res:m,err:l}=await y(()=>A.getAgentList({...f.value,currentPage:u.pagination.current,pageSize:u.pagination.pageSize,pagingOrNot:"1"}));if(l)return[];u.pagination.total=m.data.totalCount;const h=m==null?void 0:m.data.list.map(c=>(c.phone!==void 0&&c.phone!==null&&(c.phone=Number(c.phone)),c.commissionRadio!==void 0&&c.commissionRadio!==null&&(c.commissionRadio=Number(c.commissionRadio)),c));return T(h)});return(m,l)=>{const h=d("a-input"),c=d("a-form-item"),z=d("a-grid-item"),U=d("a-select"),$=d("a-grid"),q=d("a-form"),i=d("icon-plus"),N=d("a-button"),P=d("a-space"),E=d("a-switch"),j=d("a-table");return v(),F("div",null,[t(ae,{"table-columns":e(V),"table-size":e(u).size,onResetSearch:e(x),onSearch:e(I),onChangeTableSize:e(L),onChangeTableColumn:e(D)},{form:o(()=>[t(q,{model:e(f),"label-align":"left",size:"large","auto-label-width":""},{default:o(()=>[t($,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:o(()=>[t(z,null,{default:o(()=>[t(c,{label:"代理名称:"},{default:o(()=>[t(h,{modelValue:e(f).agentName,"onUpdate:modelValue":l[0]||(l[0]=p=>e(f).agentName=p),modelModifiers:{trim:!0},placeholder:"请输入代理名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:o(()=>[t(c,{label:"启用状态:"},{default:o(()=>[t(U,{modelValue:e(f).status,"onUpdate:modelValue":l[1]||(l[1]=p=>e(f).status=p),options:[...e(ee),...e(oe)]},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),operate:o(()=>[t(P,null,{default:o(()=>[t(N,{type:"outline",onClick:l[2]||(l[2]=p=>e(g)("zsAddAgent"))},{icon:o(()=>[t(i)]),default:o(()=>[C(" 新增 ")]),_:1})]),_:1})]),table:o(()=>[t(j,{"selected-keys":e(u).selectedKeys,"onUpdate:selectedKeys":l[3]||(l[3]=p=>e(u).selectedKeys=p),class:"zs-table","row-key":"id",data:e(k),"row-selection":e(u).rowSelection,bordered:e(u).bordered,pagination:e(u).pagination,size:e(u).size,columns:e(R),stripe:e(u).stripe,loading:e(s)},{status:o(({record:p})=>[t(E,{size:"medium","model-value":p.status==="1",onChange:G=>M(p)},{checked:o(()=>[C(" 禁用 ")]),unchecked:o(()=>[C(" 启用 ")]),_:2},1032,["model-value","onChange"])]),operate:o(({record:p})=>[t(N,{type:"text",onClick:G=>e(w)(p,()=>e(g)("zsAddAgent"))},{default:o(()=>[C("编辑")]),_:2},1032,["onClick"])]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(b)==="zsAddAgent"?(v(),K(se,{key:0,data:e(n),onSuccess:e(a),onClose:l[4]||(l[4]=p=>e(w)({},()=>e(g)(null)))},null,8,["data","onSuccess"])):Z("",!0)])}}});export{pe as default};
