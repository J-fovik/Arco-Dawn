import{a as Y,n as I,p as j,O as H,d as C,E as U,s as K,r,o as _,l as S,w as t,g as a,c as e,i as k,k as P,q as J,u as Q,m as W,b as X,v as ee,x as te,y as ae,e as oe,f as ne,t as le,z as se,h as E,S as re}from"./index-8a2cb146.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{_ as ue,a as de}from"./index.vue_vue_type_script_setup_true_name_ZsGroupOrder_lang-98fff533.js";import{B as O}from"./business-b0ce0e8a.js";import"./index-2bbe694f.js";import"./finance-4d2c7da5.js";const me=()=>{const{getDictionaryItem:f}=Y();return[{title:"营业部名称",dataIndex:"departName",show:!0,align:"center",render:({record:i})=>I(i.departName)},{title:"团号",show:!0,ellipsis:!0,tooltip:!0,slotName:"groupNo",align:"center"},{title:"开票金额(元)",dataIndex:"applyMoney",show:!0,align:"right",render:({record:i})=>j("span",{class:"text-red text-price"},H(`${i.applyMoney}`))},{title:"开票项目",dataIndex:"invoItems",show:!0,align:"center",render:({record:i})=>I(f("invoItems",i.invoItems).detailName)},{title:"申请开票时间",dataIndex:"createTime",show:!0,align:"center",render:({record:i})=>I(i.createTime)},{title:"审核状态",dataIndex:"auditState",show:!0,align:"center",render:({record:i})=>I(f("invoiceAuditState",i.auditState).detailName)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}]},ce=C({name:"ZsExamineInvoicing"}),pe=C({...ce,props:{data:{default:()=>({})}},emits:["close","success"],setup(f,{emit:i}){const w=f,g=i,[v,c]=U(null),{form:l,formRef:x}=K(()=>({auditState:"2",auditRemark:""})),b={auditRemark:{validator:(n,d)=>{!n&&l.value.auditState==="1"&&d("审核驳回时备注必填")}}},N=()=>{x.value.validate(n=>{n||V()})},V=async()=>{const{err:n}=await P(()=>O.examineInvoicePlatform({id:w.data.id,...l.value}),{before:()=>c("okLoading"),after:()=>c(""),successMsg:"操作成功"});n||(g("success"),g("close"))};return(n,d)=>{const h=r("a-radio"),p=r("a-radio-group"),y=r("a-form-item"),T=r("a-textarea"),$=r("a-form"),z=r("a-modal");return _(),S(z,{width:"600px",top:"10%","unmount-on-close":"",visible:"","align-center":!1,title:"审核开票","mask-closable":!1,"ok-loading":e(v)==="okLoading",onCancel:d[2]||(d[2]=m=>g("close")),onOk:N},{default:t(()=>[a($,{ref_key:"formRef",ref:x,model:e(l),"label-align":"left",size:"large","auto-label-width":"",rules:b},{default:t(()=>[a(y,{field:"auditState",label:"审核:"},{default:t(()=>[a(p,{modelValue:e(l).auditState,"onUpdate:modelValue":d[0]||(d[0]=m=>e(l).auditState=m)},{default:t(()=>[a(h,{value:"2"},{default:t(()=>[k("通过")]),_:1}),a(h,{value:"1"},{default:t(()=>[k("驳回")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(y,{field:"auditRemark",label:"备注:"},{default:t(()=>[a(T,{modelValue:e(l).auditRemark,"onUpdate:modelValue":d[1]||(d[1]=m=>e(l).auditRemark=m),modelModifiers:{trim:!0},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),_e=["onClick"],fe=C({name:"InvoicesInvoicingPlatform"}),Ie=C({...fe,setup(f){const{vAuthority:i}=J(),w=Q(),g=W(),[v,c]=U(null),{form:l,resetForm:x}=K(()=>({groupId:"",departName:"",departCode:"",auditState:""}),()=>d());X(async()=>{const{err:u,res:o}=await P(()=>re.getDepartmentList({departType:"1"}));return u?[]:o==null?void 0:o.data},[]);const{selectRow:b,columnsData:N,visibleColumnsData:V,tableBaseOptions:n,resetData:d,extendTableList:h,setSelectRow:p,changeTableColumn:y,changeTableSize:T}=ee(me(),()=>m()),{data:$,loading:z,initData:m}=te(async()=>{const{res:u,err:o}=await P(()=>O.getInvoicePlatformExamineList({...l.value,currentPage:n.pagination.current,pageSize:n.pagination.pageSize}));if(!o)return n.pagination.total=u.data.totalCount,u==null?void 0:u.data.invoiceList}),Z=u=>{u.groupNo.indexOf(",")>-1?p(u,()=>c("ZsGroupOrder")):g.push(`/order/tradeManage/operate/?routeId=${u.routeId}&groupId=${u.groupNo}&name=${w.name}`)};return ae(m),(u,o)=>{const D=r("a-input"),R=r("a-form-item"),A=r("a-grid-item"),L=r("a-grid"),q=r("a-form"),B=r("a-button"),F=r("a-button-group"),G=r("a-table");return _(),oe("div",null,[a(ie,{"table-columns":e(N),"table-size":e(n).size,onResetSearch:e(x),onSearch:e(d),onChangeTableSize:e(T),onChangeTableColumn:e(y)},{form:t(()=>[a(q,{model:e(l),"label-align":"left",size:"large","auto-label-width":""},{default:t(()=>[a(L,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:t(()=>[a(A,null,{default:t(()=>[a(R,{label:"团号:"},{default:t(()=>[a(D,{modelValue:e(l).groupId,"onUpdate:modelValue":o[0]||(o[0]=s=>e(l).groupId=s),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),a(A,null,{default:t(()=>[a(R,{label:"部门名称:"},{default:t(()=>[a(D,{modelValue:e(l).departName,"onUpdate:modelValue":o[1]||(o[1]=s=>e(l).departName=s),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),a(A,null,{default:t(()=>[a(R,{label:"部门代码:"},{default:t(()=>[a(D,{modelValue:e(l).departCode,"onUpdate:modelValue":o[2]||(o[2]=s=>e(l).departCode=s),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),table:t(()=>[a(G,{"selected-keys":e(n).selectedKeys,"onUpdate:selectedKeys":o[3]||(o[3]=s=>e(n).selectedKeys=s),class:"zs-table","row-key":"id",data:e($),"row-selection":e(n).rowSelection,bordered:e(n).bordered,pagination:e(n).pagination,size:e(n).size,columns:e(V),stripe:e(n).stripe,loading:e(z)},{groupNo:t(({record:s})=>[ne("span",{class:"text-link",onClick:M=>Z(s)},le(s.groupNo),9,_e)]),operate:t(({record:s})=>[a(F,null,{default:t(()=>[a(B,{type:"text",status:"success",onClick:M=>e(p)(s,()=>e(c)("ZsPreviewInvoicing"))},{default:t(()=>[k("查看开票信息")]),_:2},1032,["onClick"]),se((_(),S(B,{type:"text",onClick:M=>e(p)(s,()=>e(c)("ZsExamineInvoicing"))},{default:t(()=>[k("审核")]),_:2},1032,["onClick"])),[[e(i),"InvoicesInvoicingPlatformExamine"]])]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(v)==="ZsPreviewInvoicing"?(_(),S(ue,{key:0,data:e(b),onClose:o[4]||(o[4]=s=>e(p)({},()=>e(c)(""))),onSuccess:e(m)},null,8,["data","onSuccess"])):E("",!0),e(v)==="ZsGroupOrder"?(_(),S(de,{key:1,data:e(b),onClose:o[5]||(o[5]=s=>e(p)({},()=>e(c)(""))),onSuccess:e(m)},null,8,["data","onSuccess"])):E("",!0),e(v)==="ZsExamineInvoicing"?(_(),S(pe,{key:2,data:e(b),onClose:o[6]||(o[6]=s=>e(p)({},()=>e(c)(""))),onSuccess:e(m)},null,8,["data","onSuccess"])):E("",!0)])}}});export{Ie as default};
