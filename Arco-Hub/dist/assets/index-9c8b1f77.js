import{d as G,u as de,m as oe,C as ue,E as ie,D as j,R as se,s as ne,a1 as pe,M as me,a0 as fe,r as p,o as T,l as k,w as l,g as e,c as d,O as A,h as L,i as s,e as z,F as O,j as ce,f as b,V,ac as B,k as F,G as ve,H as ge,t as _e,_ as ye}from"./index-8a2cb146.js";import{Z as be}from"./index-2bbe694f.js";import{Z as Te}from"./zsMultipleCalendar-2e3f8778.js";import{Z as Ve}from"./zsRoutePrice-e3a5f38b.js";import{L as Z}from"./line-7661aa01.js";const q=D=>(ve("data-v-c8a1cae3"),D=D(),ge(),D),xe=q(()=>b("div",{style:{padding:"0 10px"}},"-",-1)),he=q(()=>b("div",{style:{padding:"0 10px"}},"-",-1)),Ae=q(()=>b("div",{style:{padding:"0 10px"}},"-",-1)),qe=q(()=>b("div",null,"选择日期",-1)),De={class:"box-flex"},Me=q(()=>b("div",{style:{height:"100px"}},null,-1)),Se={class:"orderSubmit-footer box-flex jc-fe"},Pe=G({name:"LineAddTourismAddTime"}),je=G({...Pe,setup(D){const M=de();oe();const{jumpTabName:U}=ue();ie(""),j(null);const S=j(null),v=se([]),g=j([]),{form:r,formRef:N}=ne(()=>({routeName:"",travelType:"",routeType:"",groupType:"1",isBefore:"1",beforeDays:void 0,idType:[],vehicle:[],travelDays:void 0,adultAgeMin:void 0,adultAgeMax:void 0,ageOfTheElderlyMin:void 0,ageOfTheElderlyMax:105,childrenSAgeMin:void 0,childrenSAgeMax:void 0,arrival:"",supplierId:"",isReturnPoint:"1",isSubstrPoint:"1",addRebate:void 0,rebate:void 0,areaList:[],deposit:void 0,allTimeArr:[],routePrice:{crmsjg:void 0,crtxjg:void 0,crdffcmsj:void 0,crdrfctxj:void 0,crqtjg:void 0,lrmsjg:void 0,lrtxjg:void 0,lrdffcmsj2:void 0,lrdrfctxj:void 0,lrqtjg:void 0,etmsjg:void 0,ettxjg:void 0,etdffcmsj:void 0,etqtjg:void 0,zccrdrfctxj:void 0,zcrtdffcmsj:void 0,zcettxjg:void 0,zcetmsjg:void 0,zcetdrfctxj:void 0,zcetqtjg:void 0,qtjg:void 0,qtjg2:void 0,qtjg3:void 0,qtjg4:void 0,remark:""}})),H=j({routeTripList:[],businessDepartList:[],attachList:[],other:{}}),I=pe(()=>x.value.routeTypeList.filter(o=>o.lineVer===r.value.travelType)),J={routeName:{required:!0,message:"请输入登录名"},travelType:{required:!0,message:"请选择旅行类型"},routeType:{required:!0,message:"请选择线路类型"},deposit:{required:!0,message:"请输入押金"},beforeDays:{required:!0,message:"请输入提前报名天数"},idType:{required:!0,message:"请选择支持证件"},vehicle:{required:!0,message:"请选择交通工具"},travelDays:{required:!0,message:"请输入天数"},adultAge:{required:!0,validator:(o,a)=>{!r.value.adultAgeMin&&!r.value.adultAgeMax&&a("请输入正确的年龄")}},ageOfTheElderly:{required:!0,validator:(o,a)=>{!r.value.ageOfTheElderlyMin&&!r.value.ageOfTheElderlyMax&&a("请输入正确的年龄")}},childrenSAge:{required:!0,validator:(o,a)=>{!r.value.childrenSAgeMin&&!r.value.childrenSAgeMax&&a("请输入正确的年龄")}},supplierId:{required:!0,message:"请选择供应商"},allTimeArr:{required:!0,message:"请选择发团日期"}},{data:x}=me(async()=>{const{err:o,res:a}=await F(()=>Z.getTouristRoutesDetail({id:M.query.id??"",mark:M.query.mark??"0"}));return o?{}:(K(a==null?void 0:a.data),a==null?void 0:a.data)},{departType:"",ass:"",regionList:[],travelTypeList:[],supplierList:[],routeTypeList:[]}),K=({travelRoute:o,priceList:a,routeTripList:f,regionList:u,attachList:i,visibleDepart:h})=>{const m=o.adultAge.split("-"),c=o.elderlyAge.split("-"),y=o.childAge.split("-");r.value={routeName:o.routeName,travelType:o.travelType,routeType:o.routeType,groupType:o.groupType,isBefore:o.isBefore,beforeDays:o.beforeDays,travelDays:o.travelDays,arrival:o.arrival,supplierId:o.arrival,isReturnPoint:o.isReturnPoint,isSubstrPoint:o.isSubstrPoint,addRebate:o.addRebate,rebate:o.rebate,deposit:o.deposit,adultAgeMin:m[0]*1,adultAgeMax:m[1]*1,ageOfTheElderlyMin:c[0]*1,ageOfTheElderlyMax:c[1]*1,childrenSAgeMin:y[0]*1,childrenSAgeMax:y[1]*1,idType:o.idtype.split(","),vehicle:o.vehicle.split(","),allTimeArr:[],areaList:u.map(n=>n.provinceCode),routePrice:a[0]},H.value={other:{routeFeature:o.routeFeature,costIncludes:o.costIncludes,costExcludes:o.costExcludes,selfExpense:o.selfExpense,reminder:o.reminder,visaNotice:o.visaNotice,needingMsg:o.needingMsg,reception:o.reception,totalInfo1:o.totalInfo1,remark:o.remark},routeTripList:f.map(n=>({...n,imgList:n.pictureList.map(_=>({name:_.attName,url:_.attPath,status:"done",uid:_.id,attSize:_.attSize}))})),attachList:i.map(n=>({name:n.attName,url:n.attPath,status:"done",uid:n.id,attSize:n.attSize})),businessDepartList:h.split(",")}},Q=o=>{if(v.value=o,o.length){const a=g.value.find(f=>f.validDate===o.at(-1));S.value.setFormData({...a})}},W=()=>{if(!v.value.length)return V.warning("请先选择要还原日期");g.value=g.value.map(o=>v.value.includes(o.validDate)?{...r.value.routePrice,validDate:o.validDate}:o),v.value=[],V.success("还原成功!")},X=()=>{if(!v.value.length)return V.warning("请先选择要修改的日期");g.value=g.value.map(o=>v.value.includes(o.validDate)?{...S.value.getFormData(),validDate:o.validDate}:o),v.value=[],V.success("修改成功!")},Y=o=>{r.value.travelType=o,r.value.routeType="",r.value.arrival=""},$=o=>{var a;r.value.routeType=o,r.value.arrival=((a=I.value.find(f=>f.lineId===o))==null?void 0:a.lineDesc)??""},R=async()=>{await N.value.validate()||await S.value.validateData()||ee()},ee=async()=>{const o=V.loading({content:"正在上传数据",duration:2e4}),a={id:M.query.id,routePrice:r.value.routePrice,allTimeArr:r.value.allTimeArr.map(u=>B(u)),priceList:g.value},{err:f}=await F(()=>Z.saveTouristRoutesTime(a));o.close(),!f&&(V.success("操作成功"),U())};return fe(()=>r.value.allTimeArr,o=>{g.value=o.map(a=>{const f=g.value.find(u=>u.validDate===a);return f||{...r.value.routePrice,validDate:a}})}),(o,a)=>{const f=p("a-input"),u=p("a-form-item"),i=p("a-grid-item"),h=p("a-select"),m=p("a-input-number"),c=p("a-radio"),y=p("a-radio-group"),n=p("a-checkbox"),_=p("a-checkbox-group"),E=p("a-input-group"),C=p("a-grid"),w=p("a-card"),le=p("a-tag"),P=p("a-button"),ae=p("a-button-group"),te=p("a-form"),re=p("a-space");return T(),k(be,null,{default:l(()=>[e(te,{ref_key:"formRef",ref:N,"label-align":"left",size:"large",layout:"vertical","auto-label-width":"","scroll-to-first-error":"",model:d(r),disabled:!0,rules:J},{default:l(()=>[e(w,{title:"路由线路时间添加",bordered:!1,class:"general-card"},{default:l(()=>[e(C,{cols:3,"col-gap":12},{default:l(()=>[e(i,null,{default:l(()=>[e(u,{label:"线路名称:",field:"routeName",required:""},{default:l(()=>[e(f,{modelValue:d(r).routeName,"onUpdate:modelValue":a[0]||(a[0]=t=>d(r).routeName=t),modelModifiers:{trim:!0},placeholder:"请输入线路名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"旅行类型:",field:"travelType",required:""},{default:l(()=>[e(h,{"model-value":d(r).travelType,options:d(x).travelTypeList,"field-names":{label:"detailName",value:"lineVer"},placeholder:"请输入旅行类型",onChange:Y},null,8,["model-value","options"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"线路类型:",field:"routeType",required:""},{default:l(()=>[e(h,{"model-value":d(r).routeType,options:I.value,"field-names":{label:"linename",value:"lineId"},placeholder:"请选择线路类型",onChange:$},null,8,["model-value","options"])]),_:1})]),_:1}),d(r).travelType==="C00001"?(T(),k(i,{key:0},{default:l(()=>[e(u,{label:"押金:",field:"deposit",required:""},{default:l(()=>[e(m,{modelValue:d(r).deposit,"onUpdate:modelValue":a[1]||(a[1]=t=>d(r).deposit=t),modelModifiers:{trim:!0},formatter:t=>d(A)(t,""),parser:t=>t.replace(/,/g,""),precision:0,"hide-button":"",placeholder:"请输入押金"},null,8,["modelValue","formatter","parser"])]),_:1})]),_:1})):L("",!0),e(i,null,{default:l(()=>[e(u,{label:"成团类别:",field:"groupType",required:""},{default:l(()=>[e(y,{modelValue:d(r).groupType,"onUpdate:modelValue":a[2]||(a[2]=t=>d(r).groupType=t)},{default:l(()=>[e(c,{value:"1"},{default:l(()=>[s("单团")]),_:1}),e(c,{value:"2"},{default:l(()=>[s("散客")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),d(x).departType!=="2"?(T(),k(i,{key:1},{default:l(()=>[e(u,{label:"是否提前报名:",field:"isBefore",required:""},{default:l(()=>[e(y,{modelValue:d(r).isBefore,"onUpdate:modelValue":a[3]||(a[3]=t=>d(r).isBefore=t)},{default:l(()=>[e(c,{value:"1"},{default:l(()=>[s("是")]),_:1}),e(c,{value:"0"},{default:l(()=>[s("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):L("",!0),e(i,null,{default:l(()=>[e(u,{label:"提前报名天数:",field:"beforeDays",required:""},{default:l(()=>[e(m,{modelValue:d(r).beforeDays,"onUpdate:modelValue":a[4]||(a[4]=t=>d(r).beforeDays=t),modelModifiers:{trim:!0},formatter:t=>d(A)(t,""),parser:t=>t.replace(/,/g,""),precision:0,"hide-button":"",placeholder:"请输入提前报名天数"},null,8,["modelValue","formatter","parser"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"支持证件:",field:"idType",required:""},{default:l(()=>[e(_,{modelValue:d(r).idType,"onUpdate:modelValue":a[5]||(a[5]=t=>d(r).idType=t)},{default:l(()=>[e(n,{value:"1"},{default:l(()=>[s("身份证")]),_:1}),e(n,{value:"2"},{default:l(()=>[s("户口本")]),_:1}),e(n,{value:"3"},{default:l(()=>[s("护照")]),_:1}),e(n,{value:"4"},{default:l(()=>[s("驾驶证")]),_:1}),e(n,{value:"5"},{default:l(()=>[s("暂住证")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"交通工具:",field:"vehicle",required:""},{default:l(()=>[e(_,{modelValue:d(r).vehicle,"onUpdate:modelValue":a[6]||(a[6]=t=>d(r).vehicle=t)},{default:l(()=>[e(n,{value:"1"},{default:l(()=>[s("飞机")]),_:1}),e(n,{value:"2"},{default:l(()=>[s("火车")]),_:1}),e(n,{value:"3"},{default:l(()=>[s("大巴")]),_:1}),e(n,{value:"4"},{default:l(()=>[s("轮船")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"天数:",field:"travelDays",required:""},{default:l(()=>[e(m,{modelValue:d(r).travelDays,"onUpdate:modelValue":a[7]||(a[7]=t=>d(r).travelDays=t),formatter:t=>d(A)(t,""),parser:t=>t.replace(/,/g,""),precision:0,"hide-button":"",placeholder:"请输入天数"},null,8,["modelValue","formatter","parser"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"成人价年龄:",field:"adultAge",required:""},{default:l(()=>[e(E,{class:"flex1"},{default:l(()=>[e(m,{modelValue:d(r).adultAgeMin,"onUpdate:modelValue":a[8]||(a[8]=t=>d(r).adultAgeMin=t),min:0,placeholder:"最小年龄"},null,8,["modelValue"]),xe,e(m,{modelValue:d(r).adultAgeMax,"onUpdate:modelValue":a[9]||(a[9]=t=>d(r).adultAgeMax=t),min:0,placeholder:"最大年龄"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"老人价年龄:",field:"ageOfTheElderly",required:""},{default:l(()=>[e(E,{class:"flex1"},{default:l(()=>[e(m,{modelValue:d(r).ageOfTheElderlyMin,"onUpdate:modelValue":a[10]||(a[10]=t=>d(r).ageOfTheElderlyMin=t),max:105,min:0,placeholder:"最小年龄"},null,8,["modelValue"]),he,e(m,{modelValue:d(r).ageOfTheElderlyMax,"onUpdate:modelValue":a[11]||(a[11]=t=>d(r).ageOfTheElderlyMax=t),max:105,min:0,placeholder:"最大年龄"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"儿童价年龄:",field:"childrenSAge"},{default:l(()=>[e(E,{class:"flex1"},{default:l(()=>[e(m,{modelValue:d(r).childrenSAgeMin,"onUpdate:modelValue":a[12]||(a[12]=t=>d(r).childrenSAgeMin=t),min:0,placeholder:"最小年龄"},null,8,["modelValue"]),Ae,e(m,{modelValue:d(r).childrenSAgeMax,"onUpdate:modelValue":a[13]||(a[13]=t=>d(r).childrenSAgeMax=t),min:0,placeholder:"最大年龄"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"目的地:",field:"arrival"},{default:l(()=>[e(f,{modelValue:d(r).arrival,"onUpdate:modelValue":a[14]||(a[14]=t=>d(r).arrival=t),modelModifiers:{trim:!0},readonly:"",placeholder:"请输入目的地"},null,8,["modelValue"])]),_:1})]),_:1}),d(x).ass==="1"?(T(),z(O,{key:2},[e(i,null,{default:l(()=>[e(u,{label:"外交供应商:",field:"supplierId"},{default:l(()=>[e(h,{modelValue:d(r).supplierId,"onUpdate:modelValue":a[15]||(a[15]=t=>d(r).supplierId=t),options:d(x).supplierList,"field-names":{label:"supName",value:"id"},placeholder:"请选择辅助外交供应商"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"是否供应商返点:",field:"isReturnPoint",required:""},{default:l(()=>[e(y,{modelValue:d(r).isReturnPoint,"onUpdate:modelValue":a[16]||(a[16]=t=>d(r).isReturnPoint=t)},{default:l(()=>[e(c,{value:"1"},{default:l(()=>[s("是")]),_:1}),e(c,{value:"0"},{default:l(()=>[s("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"是否营业部扣点:",field:"isSubstrPoint",required:""},{default:l(()=>[e(y,{modelValue:d(r).isSubstrPoint,"onUpdate:modelValue":a[17]||(a[17]=t=>d(r).isSubstrPoint=t)},{default:l(()=>[e(c,{value:"1"},{default:l(()=>[s("是")]),_:1}),e(c,{value:"0"},{default:l(()=>[s("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"供应商返点(%):",field:"addRebate",required:""},{default:l(()=>[e(m,{modelValue:d(r).addRebate,"onUpdate:modelValue":a[18]||(a[18]=t=>d(r).addRebate=t),modelModifiers:{trim:!0},formatter:t=>d(A)(t,""),parser:t=>t.replace(/,/g,""),precision:2,"hide-button":"",placeholder:"空默认为不扣供应商点"},null,8,["modelValue","formatter","parser"])]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(u,{label:"营业部扣点(%):",required:""},{default:l(()=>[e(m,{modelValue:d(r).rebate,"onUpdate:modelValue":a[19]||(a[19]=t=>d(r).rebate=t),modelModifiers:{trim:!0},formatter:t=>d(A)(t,""),parser:t=>t.replace(/,/g,""),precision:2,"hide-button":"",placeholder:"空默认为不扣营业部点"},null,8,["modelValue","formatter","parser"])]),_:1})]),_:1})],64)):L("",!0)]),_:1})]),_:1}),e(w,{title:"发团日期选择",bordered:!1,class:"general-card margin-top"},{default:l(()=>[e(C,{cols:3,"col-gap":20},{default:l(()=>[e(i,{span:1},{default:l(()=>[e(u,{field:"allTimeArr","hide-label":"","hide-asterisk":""},{default:l(()=>[e(Te,{modelValue:d(r).allTimeArr,"onUpdate:modelValue":a[20]||(a[20]=t=>d(r).allTimeArr=t),disabled:!!d(M).query.isReadOnly,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(i,{span:2},{default:l(()=>[qe,e(_,{class:"margin-top",modelValue:v.value,"onUpdate:modelValue":a[21]||(a[21]=t=>v.value=t),onChange:Q},{default:l(()=>[(T(!0),z(O,null,ce(d(r).allTimeArr,t=>(T(),k(n,{key:t,value:t,style:{"margin-bottom":"10px"}},{default:l(()=>[e(le,{size:"large"},{default:l(()=>[s(_e(d(B)(t)),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),e(Ve,{ref_key:"routePriceRef",ref:S,"default-data":d(r).routePrice},null,8,["default-data"]),b("div",De,[e(ae,null,{default:l(()=>[e(P,{size:"large",type:"primary",onClick:X},{default:l(()=>[s("保存")]),_:1}),e(P,{size:"large",onClick:W},{default:l(()=>[s("还原")]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),Me,b("div",Se,[e(re,null,{default:l(()=>[e(P,{type:"primary",onClick:R},{default:l(()=>[s("保存")]),_:1}),e(P,{onClick:a[22]||(a[22]=()=>d(U)())},{default:l(()=>[s("返回")]),_:1})]),_:1})])]),_:1})}}});const Ie=ye(je,[["__scopeId","data-v-c8a1cae3"]]);export{Ie as default};
