import{n as $,p as Q,O as B,d as V,a as j,E as I,s as Z,r as s,o as v,l as C,w as a,g as t,c as e,k as K,A as G,q as H,v as J,x as W,y as X,e as Y,z as U,i as S,h as M}from"./index-8a2cb146.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{L as A}from"./limit-285f78d0.js";import"./index-2bbe694f.js";const te=()=>[{title:"营业部名称",dataIndex:"departName",show:!0,align:"center",render:({record:c})=>$(c.departName)},{title:"上级组织",dataIndex:"parentName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:c})=>$(c.parentName)},{title:"额度(元)",dataIndex:"quota",show:!0,align:"right",render:({record:c})=>Q("span",{class:"text-red text-price"},B(`${c.quota??"0"}`))},{title:"额度说明",dataIndex:"quotaDesc",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:c})=>$(c.quotaDesc)},{title:"操作",width:300,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],ae=V({name:"ZsRechargeLimit"}),oe=V({...ae,props:{data:{default:()=>({})}},emits:["close","success"],setup(c,{emit:y}){const{getDictionaryInfo:q}=j(),f=c,[u,k]=I(null),{form:o,formRef:_}=Z(()=>({...f.data,baseLimit:"",limit:void 0,type:"",desc:"",bz:""})),x={baseLimit:{required:!0,message:"请选择基准额度"},limit:{required:!0,message:"请输入充值额度"},type:{required:!0,message:"请选择调整类型"},desc:{required:!0,message:"请输入额度说明"}},r=y,N=()=>{_.value.validate(m=>{m||w()})},w=async()=>{const{err:m}=await K(()=>A.getTopUpLimitTakeUp({id:o.value.id,departName:o.value.departName,quota:o.value.quota,departNo:o.value.departNo,standardQuota:o.value.baseLimit,rechargeQuota:o.value.limit,quoatType:o.value.type,quotaDesc:o.value.desc,remark:o.value.bz}),{before:()=>k("okLoading"),after:()=>k(null)});m||(r("success"),r("close"))};return(m,i)=>{const D=s("a-input-number"),h=s("a-form-item"),L=s("a-select"),b=s("a-textarea"),p=s("a-form"),n=s("a-modal");return v(),C(n,{top:"10%",width:"800px",title:"充值","unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(u)==="okLoading",onCancel:i[3]||(i[3]=d=>r("close")),onOk:N},{default:a(()=>[t(p,{ref_key:"formRef",ref:_,model:e(o),"label-align":"left",size:"large","auto-label-width":"",rules:x},{default:a(()=>[t(h,{field:"limit",label:"充值额度(元):",required:""},{default:a(()=>[t(D,{modelValue:e(o).limit,"onUpdate:modelValue":i[0]||(i[0]=d=>e(o).limit=d),placeholder:"请输入充值额度",formatter:d=>e(B)(d,""),parser:d=>d.replace(/,/g,""),precision:2},null,8,["modelValue","formatter","parser"])]),_:1}),t(h,{field:"type",label:"调整类型:",required:""},{default:a(()=>{var d;return[t(L,{modelValue:e(o).type,"onUpdate:modelValue":i[1]||(i[1]=g=>e(o).type=g),placeholder:"请选择调整类型",options:(d=e(q)("quoatType"))==null?void 0:d.filter(g=>g.detailCode>="01"&&g.detailCode<="06"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]}),_:1}),t(h,{field:"desc",label:"额度说明:",required:""},{default:a(()=>[t(b,{modelValue:e(o).desc,"onUpdate:modelValue":i[2]||(i[2]=d=>e(o).desc=d),placeholder:"请输入额度说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),le=V({name:"ZsRechargeZero"}),ne=V({...le,props:{data:{default:()=>({})}},emits:["close","success"],setup(c,{emit:y}){const q=c,f=y,[u,k]=I(null),{warningModal:o}=G(),{form:_,formRef:x}=Z(()=>({quotaDesc:""})),r={quotaDesc:{required:!0,message:"请输入额度说明"}},N=()=>{x.value.validate(m=>{m||w()})},w=async()=>{o("确认要清零当前营业部的额度吗?",async m=>{const{res:i}=await K(()=>A.getTopUpLimitTakReset({id:q.data.id,quotaDesc:_.value.quotaDesc}),{before:()=>k("okLoading"),after:()=>k(null)});m(!0),i&&(f("success"),f("close"))})};return(m,i)=>{const D=s("a-textarea"),h=s("a-form-item"),L=s("a-form"),b=s("a-modal");return v(),C(b,{top:"10%",width:"800px",title:"清零","unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":e(u)==="okLoading",onCancel:i[1]||(i[1]=p=>f("close")),onOk:N},{default:a(()=>[t(L,{ref_key:"formRef",ref:x,model:e(_),"label-align":"left",size:"large","auto-label-width":"",rules:r},{default:a(()=>[t(h,{field:"quotaDesc",label:"额度说明:",required:""},{default:a(()=>[t(D,{modelValue:e(_).quotaDesc,"onUpdate:modelValue":i[0]||(i[0]=p=>e(_).quotaDesc=p),placeholder:"请输入额度说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),se=V({name:"LimitRecharge"}),me=V({...se,setup(c){const{vAuthority:y}=H(),[q,f]=I(null),{form:u,resetForm:k}=Z(()=>({departName:"",departNo:"",parentName:"",parentNo:""}),()=>N()),{selectRow:o,columnsData:_,visibleColumnsData:x,tableBaseOptions:r,resetData:N,extendTableList:w,setSelectRow:m,changeTableColumn:i,changeTableSize:D}=J(te(),()=>b()),{data:h,loading:L,initData:b}=W(async()=>{const{res:p,err:n}=await K(()=>A.getTopUpLimitList({...u.value,currentPage:r.pagination.current,pageSize:r.pagination.pageSize,pagingOrNot:"1"}));return n?[]:(r.pagination.total=p.data.totalCount,w(p==null?void 0:p.data.topUpList))});return X(b),(p,n)=>{const d=s("a-input"),g=s("a-form-item"),R=s("a-grid-item"),O=s("a-grid"),E=s("a-form"),T=s("a-button"),F=s("a-button-group"),P=s("a-table");return v(),Y("div",null,[t(ee,{"table-columns":e(_),"table-size":e(r).size,onResetSearch:e(k),onSearch:e(N),onChangeTableSize:e(D),onChangeTableColumn:e(i)},{form:a(({})=>[t(E,{model:e(u),"label-align":"left",size:"large","auto-label-width":""},{default:a(()=>[t(O,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:a(()=>[t(R,null,{default:a(()=>[t(g,{label:"部门名称:"},{default:a(()=>[t(d,{modelValue:e(u).departName,"onUpdate:modelValue":n[0]||(n[0]=l=>e(u).departName=l),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(g,{label:"部门代码:"},{default:a(()=>[t(d,{modelValue:e(u).departNo,"onUpdate:modelValue":n[1]||(n[1]=l=>e(u).departNo=l),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(g,{label:"上级部门名称:"},{default:a(()=>[t(d,{modelValue:e(u).parentName,"onUpdate:modelValue":n[2]||(n[2]=l=>e(u).parentName=l),modelModifiers:{trim:!0},placeholder:"请输入上级部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(g,{label:"上级部门代码:"},{default:a(()=>[t(d,{modelValue:e(u).parentNo,"onUpdate:modelValue":n[3]||(n[3]=l=>e(u).parentNo=l),modelModifiers:{trim:!0},placeholder:"请输入上级部门代码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),table:a(()=>[t(P,{"selected-keys":e(r).selectedKeys,"onUpdate:selectedKeys":n[4]||(n[4]=l=>e(r).selectedKeys=l),class:"zs-table","row-key":"id",data:e(h),"row-selection":e(r).rowSelection,bordered:e(r).bordered,pagination:e(r).pagination,size:e(r).size,columns:e(x),stripe:e(r).stripe,loading:e(L)},{operate:a(({record:l})=>[t(F,null,{default:a(()=>[U((v(),C(T,{type:"text",status:"warning",onClick:z=>e(m)(l,()=>e(f)("ZsRechargeLimit"))},{default:a(()=>[S("充值")]),_:2},1032,["onClick"])),[[e(y),"LimitRechargeRecharge"]]),U((v(),C(T,{type:"text",status:"danger",disabled:!l.id,onClick:z=>e(m)(l,()=>e(f)("ZsRechargeZero"))},{default:a(()=>[S("清零")]),_:2},1032,["disabled","onClick"])),[[e(y),"LimitRechargeZero"]]),U((v(),C(T,{status:"warning",disabled:!l.id,type:"text",onClick:z=>p.$router.push(`/limit/recharge/deduction?id=${l.id}`)},{default:a(()=>[S("扣除")]),_:2},1032,["disabled","onClick"])),[[e(y),"LimitRechargeDeduct"]]),t(T,{disabled:!l.id,type:"text",status:"success",onClick:z=>p.$router.push(`/limit/recharge/operate?id=${l.id}`)},{default:a(()=>[S("详情")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(q)==="ZsRechargeLimit"?(v(),C(oe,{key:0,data:e(o),onSuccess:e(b),onClose:n[5]||(n[5]=l=>e(m)({},()=>e(f)(null)))},null,8,["data","onSuccess"])):M("",!0),e(q)==="ZsRechargeZero"?(v(),C(ne,{key:1,data:e(o),onSuccess:e(b),onClose:n[6]||(n[6]=l=>e(m)({},()=>e(f)(null)))},null,8,["data","onSuccess"])):M("",!0)])}}});export{me as default};
