import{a as E,n as m,p as I,O as v,P as y,d as N,E as P,s as F,r as d,o as D,l as S,w as t,g as a,c as r,u as U,C as X,D as $,b as H,k as L,i as s,t as c,X as V,h as q,f as B,A as J}from"./index-8a2cb146.js";import{Z as W}from"./index-2bbe694f.js";import{_ as ee}from"./zsPreviewDumplingDate.vue_vue_type_script_setup_true_name_ZsPreviewDumplingDate_lang-410dbbba.js";import{O as M}from"./order-70291d37.js";import"./zsRoutePrice-e3a5f38b.js";import"./line-7661aa01.js";const{getDictionaryItem:A}=E(),te=e=>{if(e.otherType==="1"){if(e.diffPrice==="1")switch(e.priceType){case"0":return"成人单房差其他价格";case"3":return"老人单房差其他价格";case"6":return"儿童单房差其他价格";case"10":return"占床儿童单房差其他价格";default:return"未知单房差其他价格"}if(e.diffPrice==="0")switch(e.priceType){case"0":return"成人其他价格";case"3":return"老人其他价格";case"6":return"儿童其他价格";case"10":return"占床儿童其他价格";default:return"未知其他价格"}}if(e.otherType==="0"){if(e.diffPrice==="1")switch(e.priceType){case"0":return"成人单房差价格";case"3":return"老人单房差价格";case"6":return"儿童单房差价格";case"10":return"占床儿童单房差价格";default:return"未知单房差价格"}if(e.diffPrice==="0")switch(e.priceType){case"0":return"成人同行价格";case"3":return"老人同行价格";case"6":return"儿童同行价格";case"10":return"占床儿童同行价格";default:return"未知同行价格"}}return"未知价格"},ae=[{title:"姓名",show:!0,dataIndex:"name",align:"center",render:({record:e})=>m(e.name)},{title:"性别",show:!0,align:"center",dataIndex:"gender",render:({record:e})=>m(A("gender",e.gender).detailName)},{title:"联系电话",show:!0,dataIndex:"phone",align:"center",render:({record:e})=>m(e.phone)},{title:"证件类型",show:!0,align:"center",dataIndex:"idtype",render:({record:e})=>m(A("IDType",e.idtype).detailName)},{title:"证件号码",show:!0,align:"center",dataIndex:"idnumber",render:({record:e})=>m(e.idnumber)},{title:"年龄",show:!0,align:"center",dataIndex:"age",render:({record:e})=>m(e.age)},{title:"类别",show:!0,align:"center",dataIndex:"priceType",render:({record:e})=>m(te(e))},{title:"实收旅行费",show:!0,dataIndex:"actualSignCost",align:"right",render:({record:e})=>I("span",{class:"text-red text-price"},v(y(e.actualSignCost)))},{title:"订单保险费",show:!0,align:"right",dataIndex:"insuranceCost",render:({record:e})=>I("span",{class:"text-red text-price"},v(y(e.insuranceCost)))},{title:"实收保险费",show:!0,align:"right",dataIndex:"actualInsuraCost",render:({record:e})=>I("span",{class:"text-red text-price"},v(y(e.actualInsuraCost)))},{title:"订单总费用",show:!0,align:"right",dataIndex:"totalCost",render:({record:e})=>I("span",{class:"text-red text-price"},v(y(e.totalCost)))},{title:"实收总费用",show:!0,align:"right",dataIndex:"actualTotalCost",render:({record:e})=>I("span",{class:"text-red text-price"},v(y(e.actualTotalCost)))},{title:"操作",show:!0,align:"center",width:100,slotName:"operate"}],re=N({name:"ZsSupplementaryAgreement"}),ne=N({...re,props:{data:{default:()=>({})}},emits:["close","success"],setup(e,{emit:x}){const h=e,[b,R]=P(""),{form:f,formRef:g}=F(()=>({...h.data})),_=x,n=()=>{_("success"),_("close")};return(O,p)=>{const k=d("a-input"),w=d("a-form-item"),l=d("a-textarea"),o=d("a-form"),i=d("a-modal");return D(),S(i,{top:"10%",width:"1000px",title:"补充协议","unmount-on-close":"",visible:"","align-center":!1,"mask-closable":!1,"ok-loading":r(b)==="okLoading",onCancel:p[2]||(p[2]=u=>_("close")),onOk:n},{default:t(()=>[a(o,{ref_key:"formRef",ref:g,model:r(f),"label-align":"left",size:"large","auto-label-width":""},{default:t(()=>[a(w,{field:"title",label:"标题:",required:"",extra:"取消订单或者退团的游客需要签订补充协议，签署人为原合同签署人，补充协议内容如下"},{default:t(()=>[a(k,{modelValue:r(f).title,"onUpdate:modelValue":p[0]||(p[0]=u=>r(f).title=u),readonly:"",placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(w,{field:"touristsInfo",label:"协议内容:",extra:"协议标题和协议内容不要随意修改，协议内容中游客信息由系统自动抓取，不要随意修改!!!"},{default:t(()=>[a(l,{modelValue:r(f).touristsInfo,"onUpdate:modelValue":p[1]||(p[1]=u=>r(f).touristsInfo=u),readonly:"",placeholder:"请输入驳回原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),le=B("div",{style:{height:"100px"}},null,-1),oe={class:"orderSubmit-footer box-flex jc-fe"},se=N({name:"OrderTradeManageQuit"}),_e=N({...se,setup(e){const x=U(),{jumpTabName:h}=X(),{warningModal:b}=J(),[R,f]=P(null),g=$([]),_=$({}),{data:n}=H(async()=>{const{res:l,err:o}=await L(()=>M.quitLineOrderInfo({signupNo:x.query.signupNo}));return o?{}:l==null?void 0:l.data},{customerInfoList:[],travelRouteSupplierInfo:{},signuprecord:{}}),O=async()=>{const{err:l}=await L(()=>M.validateQuitGroup({groupId:n.value.signuprecord.groupId,signupNo:n.value.signuprecord.signupNo,noOutTouristsList:n.value.customerInfoList,outTouristsList:g.value}));l?l.code===3001&&(_.value=l.data,f("补充协议")):p("single")},p=async l=>{const{err:o}=await L(()=>M.applyQuitGroup({groupId:n.value.signuprecord.groupId,signupNo:n.value.signuprecord.signupNo,noOutTouristsList:l==="single"?n.value.customerInfoList:[],outTouristsList:l==="single"?g.value:n.value.customerInfoList}),{successMsg:"申请退团成功"});o||h()},k=(l,o)=>{b("确定退团吗？",async i=>{g.value.push(l),n.value.customerInfoList.splice(o,1),i(!0)})},w=()=>{b("确定全部退团吗？",async l=>{await p("all"),l(!0)})};return(l,o)=>{const i=d("a-tag"),u=d("a-descriptions-item"),G=d("a-descriptions"),Y=d("a-card"),C=d("a-button"),K=d("a-alert"),Z=d("a-table"),j=d("a-typography-title"),z=d("a-space");return D(),S(W,null,{default:t(()=>[a(Y,{title:"基本信息",bordered:!1,class:"general-card"},{default:t(()=>[a(G,{column:{xs:1,md:2,lg:4},size:"large"},{default:t(()=>[a(u,{label:"线路名称："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).travelRouteSupplierInfo.routeName),1)]),_:1})]),_:1}),a(u,{label:"供应商名称："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).travelRouteSupplierInfo.supName),1)]),_:1})]),_:1}),a(u,{label:"团号："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).signuprecord.groupId),1)]),_:1})]),_:1}),a(u,{label:"所属地区："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).areaName),1)]),_:1})]),_:1}),a(u,{label:"目的地："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).travelRouteSupplierInfo.arrival),1)]),_:1})]),_:1}),a(u,{label:"集合地点："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(m)(r(n).signuprecord.venue)),1)]),_:1})]),_:1}),a(u,{label:"旅行时间："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(V)(r(n).travelRouteSupplierInfo.startDate,"YYYY-MM-DD"))+"至"+c(r(V)(r(n).travelRouteSupplierInfo.endDate,"YYYY-MM-DD")),1)]),_:1})]),_:1}),a(u,{label:"旅行天数/天："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).travelRouteSupplierInfo.travelDays),1)]),_:1})]),_:1}),a(u,{label:"旅行类型："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).travelRouteSupplierInfo.travelType),1)]),_:1})]),_:1}),a(u,{label:"成团类别："},{default:t(()=>[a(i,null,{default:t(()=>[s(c(r(n).travelRouteSupplierInfo.groupType==1?"单团":"散客"),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(Y,{title:"游客信息",bordered:!1,class:"general-card margin-top"},{extra:t(()=>[a(C,{status:"danger",onClick:w},{default:t(()=>[s("全部退团")]),_:1})]),default:t(()=>[a(K,null,{default:t(()=>[s(" 当前订单总计是每个游客价格的汇总，若订单有过退团或订单调账操作，可能与实际订单金额有出入，请以订单管理页面中金额为准。 ")]),_:1}),a(Z,{size:"large",class:"margin-top",columns:r(ae),data:r(n).customerInfoList,pagination:!1,bordered:!1},{operate:t(({record:T,rowIndex:Q})=>[a(C,{status:"danger",type:"text",onClick:ue=>k(T,Q)},{default:t(()=>[s("退团")]),_:2},1032,["onClick"])]),_:1},8,["columns","data"]),a(j,{heading:6,class:"box-flex jc-fe margin-top"},{default:t(()=>[s("游客共计： "+c(r(n).customerInfoList.length)+"位",1)]),_:1})]),_:1}),r(R)==="ZsPreviewDumplingDate"?(D(),S(ee,{key:0,data:{id:r(x).query.routeId},"default-time-arr":[r(V)(r(n).travelRouteSupplierInfo.startDate)],onClose:o[0]||(o[0]=T=>r(f)(""))},null,8,["data","default-time-arr"])):q("",!0),le,B("div",oe,[a(z,null,{default:t(()=>[a(C,{type:"primary",onClick:O},{default:t(()=>[s("确定")]),_:1}),a(C,{onClick:o[1]||(o[1]=()=>r(h)())},{default:t(()=>[s("返回")]),_:1})]),_:1})]),r(R)==="补充协议"?(D(),S(ne,{key:1,data:_.value,onClose:o[2]||(o[2]=T=>r(f)("")),onSuccess:o[3]||(o[3]=T=>p("single"))},null,8,["data"])):q("",!0)]),_:1})}}});export{_e as default};
