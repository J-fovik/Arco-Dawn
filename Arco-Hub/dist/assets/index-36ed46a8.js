import{n as T,p as D,O as $,d as M,q as P,a as W,E as R,s as q,r as d,o as I,l as N,w as a,g as t,c as e,k as O,a1 as X,aa as Y,v as ee,b as te,e as ae,z as K,i as U,h as L}from"./index-8a2cb146.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{B as Z}from"./business-b0ce0e8a.js";import"./index-2bbe694f.js";const le=()=>[{title:"营业部名称",dataIndex:"departName",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:u})=>T(u.departName)},{title:"团号",dataIndex:"groupId",show:!0,ellipsis:!0,tooltip:!0,align:"center",render:({record:u})=>T(u.groupId)},{title:"报名订单总费用(元)",dataIndex:"signCost",show:!0,align:"right",render:({record:u})=>D("span",{class:"text-red text-price"},$(`${u.signCost??"0"}`))},{title:"剩余可开金额(元)",dataIndex:"canApplyMoneyTotal",show:!0,align:"right",render:({record:u})=>D("span",{class:"text-red text-price"},$(`${u.canApplyMoneyTotal??"0"}`))},{title:"状态",dataIndex:"isBillingName",show:!0,align:"center",render:({record:u})=>T(u.isBillingName)},{title:"操作",width:200,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}],ne=M({name:"ZsApplyInvoicing"}),re=M({...ne,props:{data:{default:()=>({maxPrice:0,groupIdList:[]})}},emits:["close","success"],setup(u,{emit:V}){const m=u,b=V,h=P(),{getDictionaryInfo:y}=W(),[S,k]=R(null),{form:l,formRef:x}=q(()=>({departName:"",invoItems:"",applyMoney:void 0,corporateName:"",taxCode:"",address:"",phone:"",depositBank:"",bankAccount:"",remark:""})),s={invoItems:{required:!0,message:"请选择发票项目"},applyMoney:{required:!0,message:"请输入报销金额"},corporateName:{required:!0,message:"请输入单位名称"},taxCode:{required:!0,message:"请输入税号"}},v=()=>{x.value.validate(g=>{g||C()})},C=async()=>{const{err:g}=await O(()=>Z.applyInvoicing({...l.value,groupIdList:m.data.groupIdList}),{before:()=>k("okLoading"),after:()=>k(""),successMsg:"操作成功"});g||(b("success"),b("close"))};return(g,n)=>{const c=d("a-input"),p=d("a-form-item"),w=d("a-select"),A=d("a-input-number"),f=d("a-textarea"),r=d("a-form"),_=d("a-modal");return I(),N(_,{width:"600px","unmount-on-close":"",visible:"",title:"申请开票","mask-closable":!1,"ok-loading":e(S)==="okLoading",onCancel:n[9]||(n[9]=o=>b("close")),onOk:v},{default:a(()=>[t(r,{ref_key:"formRef",ref:x,model:e(l),"label-align":"left",size:"large","auto-label-width":"",rules:s},{default:a(()=>[t(p,{field:"departName",label:"营业部名称:"},{default:a(()=>[t(c,{"model-value":e(h).userInfo.departName,readonly:"",placeholder:"请输入营业部名称"},null,8,["model-value"])]),_:1}),t(p,{field:"invoItems",label:"发票项目:"},{default:a(()=>[t(w,{modelValue:e(l).invoItems,"onUpdate:modelValue":n[0]||(n[0]=o=>e(l).invoItems=o),placeholder:"请输入发票项目",options:e(y)("invoItems"),"field-names":{label:"detailName",value:"detailCode"}},null,8,["modelValue","options"])]),_:1}),t(p,{field:"applyMoney",label:"申请开票金额:"},{default:a(()=>[t(A,{modelValue:e(l).applyMoney,"onUpdate:modelValue":n[1]||(n[1]=o=>e(l).applyMoney=o),formatter:o=>e($)(o,""),parser:o=>o.replace(/,/g,""),precision:2,min:0,max:g.data.maxPrice,placeholder:`请输入申请开票金额（最大金额${g.data.maxPrice}元）`},null,8,["modelValue","formatter","parser","max","placeholder"])]),_:1}),t(p,{field:"corporateName",label:"单位名称:"},{default:a(()=>[t(c,{modelValue:e(l).corporateName,"onUpdate:modelValue":n[2]||(n[2]=o=>e(l).corporateName=o),modelModifiers:{trim:!0},placeholder:"请输入单位名称"},null,8,["modelValue"])]),_:1}),t(p,{field:"taxCode",label:"税号:"},{default:a(()=>[t(c,{modelValue:e(l).taxCode,"onUpdate:modelValue":n[3]||(n[3]=o=>e(l).taxCode=o),modelModifiers:{trim:!0},placeholder:"请输入税号"},null,8,["modelValue"])]),_:1}),t(p,{field:"address",label:"地址:"},{default:a(()=>[t(c,{modelValue:e(l).address,"onUpdate:modelValue":n[4]||(n[4]=o=>e(l).address=o),modelModifiers:{trim:!0},placeholder:"请输入地址"},null,8,["modelValue"])]),_:1}),t(p,{field:"phone",label:"电话:"},{default:a(()=>[t(c,{modelValue:e(l).phone,"onUpdate:modelValue":n[5]||(n[5]=o=>e(l).phone=o),modelModifiers:{trim:!0},placeholder:"请输入地址"},null,8,["modelValue"])]),_:1}),t(p,{field:"depositBank",label:"开户银行:"},{default:a(()=>[t(c,{modelValue:e(l).depositBank,"onUpdate:modelValue":n[6]||(n[6]=o=>e(l).depositBank=o),modelModifiers:{trim:!0},placeholder:"请输入开户银行"},null,8,["modelValue"])]),_:1}),t(p,{field:"bankAccount",label:"银行账号:"},{default:a(()=>[t(c,{modelValue:e(l).bankAccount,"onUpdate:modelValue":n[7]||(n[7]=o=>e(l).bankAccount=o),modelModifiers:{trim:!0},placeholder:"请输入银行账号"},null,8,["modelValue"])]),_:1}),t(p,{field:"remark",label:"备注:"},{default:a(()=>[t(f,{modelValue:e(l).remark,"onUpdate:modelValue":n[8]||(n[8]=o=>e(l).remark=o),modelModifiers:{trim:!0},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["ok-loading"])}}}),se=M({name:"InvoicesNewInvoiceManage"}),me=M({...se,setup(u){const{vAuthority:V}=P(),{form:m,resetForm:b}=q(()=>({groupId:"",departName:"",departCode:""}),()=>C()),[h,y]=R(null),S=X(()=>s.selectedKeys.reduce((f,r)=>{var _;return Y(f+(((_=c.value.find(o=>o.groupId===r))==null?void 0:_.canApplyMoneyTotal)??0))},0)),{selectRow:k,columnsData:l,visibleColumnsData:x,tableBaseOptions:s,setSelectRow:v,resetData:C,changeTableColumn:g,changeTableSize:n}=ee(le(),()=>w()),{data:c,loading:p,initData:w}=te(async()=>{const{res:f,err:r}=await O(()=>Z.getInvoiceApplicationList({...m.value,currentPage:s.pagination.current,pageSize:s.pagination.pageSize,pagingOrNot:"1"}));return r?[]:(s.pagination.total=f.data.totalCount,f==null?void 0:f.data.payVoucherList)}),A=()=>{s.selectedKeys=[],w()};return(f,r)=>{const _=d("a-input"),o=d("a-form-item"),z=d("a-grid-item"),E=d("a-grid"),F=d("a-form"),j=d("icon-subscribe-add"),B=d("a-button"),G=d("a-space"),H=d("a-button-group"),J=d("a-table");return I(),ae("div",null,[t(oe,{"table-columns":e(l),"table-size":e(s).size,onResetSearch:e(b),onSearch:e(C),onChangeTableSize:e(n),onChangeTableColumn:e(g)},{form:a(()=>[t(F,{model:e(m),"label-align":"left",size:"large","auto-label-width":""},{default:a(()=>[t(E,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:a(()=>[t(z,null,{default:a(()=>[t(o,{field:"groupId",label:"团号:"},{default:a(()=>[t(_,{modelValue:e(m).groupId,"onUpdate:modelValue":r[0]||(r[0]=i=>e(m).groupId=i),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(o,{label:"部门名称:"},{default:a(()=>[t(_,{modelValue:e(m).departName,"onUpdate:modelValue":r[1]||(r[1]=i=>e(m).departName=i),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(o,{label:"部门代码:"},{default:a(()=>[t(_,{modelValue:e(m).departCode,"onUpdate:modelValue":r[2]||(r[2]=i=>e(m).departCode=i),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),operate:a(()=>[t(G,null,{default:a(()=>[K((I(),N(B,{type:"outline",status:"warning",disabled:!e(s).selectedKeys.length,onClick:r[3]||(r[3]=i=>e(v)({groupIdList:e(s).selectedKeys,maxPrice:S.value},()=>e(y)("ZsApplyInvoicing")))},{icon:a(()=>[t(j)]),default:a(()=>[U(" 批量开票申请 ")]),_:1},8,["disabled"])),[[e(V),"InvoicesNewInvoiceManageBatchInvoice"]])]),_:1})]),table:a(()=>[t(J,{"selected-keys":e(s).selectedKeys,"onUpdate:selectedKeys":r[4]||(r[4]=i=>e(s).selectedKeys=i),class:"zs-table","row-key":"groupId",data:e(c),"row-selection":e(s).rowSelection,bordered:e(s).bordered,pagination:e(s).pagination,size:e(s).size,columns:e(x),stripe:e(s).stripe,loading:e(p)},{operate:a(({record:i})=>[t(H,null,{default:a(()=>[t(B,{type:"text",status:"success",onClick:Q=>f.$router.push(`/invoices/newInvoiceManage/operate?id=${i.id}`)},{default:a(()=>[U("详情")]),_:2},1032,["onClick"]),["0","3"].includes(i.isBilling)?K((I(),N(B,{key:0,type:"text",onClick:Q=>e(v)({groupIdList:[i.groupId],maxPrice:i.canApplyMoneyTotal},()=>e(y)("ZsApplyInvoicing"))},{default:a(()=>[U("申请开票")]),_:2},1032,["onClick"])),[[e(V),"InvoicesNewInvoiceManageApply"]]):L("",!0)]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(h)==="ZsApplyInvoicing"?(I(),N(re,{key:0,data:e(k),onClose:r[5]||(r[5]=i=>e(v)({},()=>e(y)(""))),onSuccess:A},null,8,["data"])):L("",!0)])}}});export{me as default};
