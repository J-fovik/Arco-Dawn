import{a as k,n as c,p as G,O as X,d as V,q as j,u as J,m as Q,E as W,s as ee,b as te,k as S,v as ae,x as oe,y as ne,r as d,o as b,e as le,g as o,w as n,c as e,f as se,t as ie,i as N,z as re,l as y,h as D,L as de,X as ue,S as ce}from"./index-8a2cb146.js";import{_ as me}from"./index.vue_vue_type_script_setup_true_name_ZsSearchTableMould_lang-54cd5f3e.js";import{_ as pe,a as ge}from"./index.vue_vue_type_script_setup_true_name_ZsGroupOrder_lang-98fff533.js";import{B as T}from"./business-b0ce0e8a.js";import"./index-2bbe694f.js";import"./finance-4d2c7da5.js";const _e=()=>{const{getDictionaryItem:v}=k();return[{title:"营业部名称",dataIndex:"departName",show:!0,align:"center",render:({record:s})=>c(s.departName)},{title:"团号",show:!0,ellipsis:!0,tooltip:!0,slotName:"groupNo",align:"center"},{title:"开票金额(元)",dataIndex:"applyMoney",show:!0,align:"right",render:({record:s})=>G("span",{class:"text-red text-price"},X(`${s.applyMoney}`))},{title:"开票项目",dataIndex:"invoItems",show:!0,align:"center",render:({record:s})=>c(v("invoItems",s.invoItems).detailName)},{title:"申请开票时间",dataIndex:"createTime",show:!0,align:"center",render:({record:s})=>c(s.createTime)},{title:"完成开票时间",dataIndex:"invoicingTime",show:!0,align:"center",render:({record:s})=>c(s.invoicingTime)},{title:"审核状态",dataIndex:"auditState",show:!0,align:"center",render:({record:s})=>c(v("invoiceAuditState",s.auditState).detailName)},{title:"操作",width:300,dataIndex:"operate",slotName:"operate",show:!0,align:"center"}]},fe=["onClick"],be=V({name:"InvoicesInvoicingHistory"}),he=V({...be,setup(v){const{vAuthority:s}=j(),z=J(),$=Q(),[I,m]=W(null),{getDictionaryInfo:A}=k(),{form:r,resetForm:B}=ee(()=>({groupId:"",departName:"",departCode:"",auditState:""}),()=>C());te(async()=>{const{err:l,res:t}=await S(()=>ce.getDepartmentList({departType:"1"}));return l?[]:t==null?void 0:t.data},[]);const{selectRow:w,columnsData:M,visibleColumnsData:R,tableBaseOptions:i,resetData:C,extendTableList:ve,setSelectRow:p,changeTableColumn:U,changeTableSize:L}=ae(_e(),()=>g()),{data:O,loading:H,initData:g}=oe(async()=>{const{res:l,err:t}=await S(()=>T.getInvoiceHistoryList({...r.value,currentPage:i.pagination.current,pageSize:i.pagination.pageSize}));if(!t)return i.pagination.total=l.data.totalCount,l==null?void 0:l.data.invoiceList}),K=l=>{l.groupNo.indexOf(",")>-1?p(l,()=>m("ZsGroupOrder")):$.push(`/order/tradeManage/operate/?routeId=${l.routeId}&groupId=${l.groupNo}&name=${z.name}`)},P=async l=>{const{res:t,err:u}=await S(()=>T.downLoadInvoiceFile({id:l.id}));u||de(t,`${ue(new Date,"YYYYMMDDHHmmss")}.zip`)};return ne(g),(l,t)=>{const u=d("a-input"),_=d("a-form-item"),f=d("a-grid-item"),Y=d("a-select"),E=d("a-grid"),Z=d("a-form"),x=d("a-button"),F=d("a-button-group"),q=d("a-table");return b(),le("div",null,[o(me,{"table-columns":e(M),"table-size":e(i).size,onResetSearch:e(B),onSearch:e(C),onChangeTableSize:e(L),onChangeTableColumn:e(U)},{form:n(()=>[o(Z,{model:e(r),"label-align":"left",size:"large","auto-label-width":""},{default:n(()=>[o(E,{cols:{md:3,lg:3,xl:3,xxl:4},"col-gap":12},{default:n(()=>[o(f,null,{default:n(()=>[o(_,{label:"团号:"},{default:n(()=>[o(u,{modelValue:e(r).groupId,"onUpdate:modelValue":t[0]||(t[0]=a=>e(r).groupId=a),placeholder:"请输入团号"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(_,{label:"部门名称:"},{default:n(()=>[o(u,{modelValue:e(r).departName,"onUpdate:modelValue":t[1]||(t[1]=a=>e(r).departName=a),modelModifiers:{trim:!0},placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(_,{label:"部门代码:"},{default:n(()=>[o(u,{modelValue:e(r).departCode,"onUpdate:modelValue":t[2]||(t[2]=a=>e(r).departCode=a),modelModifiers:{trim:!0},placeholder:"请输入部门代码"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(_,{label:"审核状态:"},{default:n(()=>[o(Y,{modelValue:e(r).auditState,"onUpdate:modelValue":t[3]||(t[3]=a=>e(r).auditState=a),options:e(A)("invoiceAuditState"),"field-names":{label:"detailName",value:"detailCode"},placeholder:"请选择审核状态"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),table:n(()=>[o(q,{"selected-keys":e(i).selectedKeys,"onUpdate:selectedKeys":t[4]||(t[4]=a=>e(i).selectedKeys=a),class:"zs-table","row-key":"id",data:e(O),"row-selection":e(i).rowSelection,bordered:e(i).bordered,pagination:e(i).pagination,size:e(i).size,columns:e(R),stripe:e(i).stripe,loading:e(H)},{groupNo:n(({record:a})=>[se("span",{class:"text-link",onClick:h=>K(a)},ie(a.groupNo),9,fe)]),operate:n(({record:a})=>[o(F,null,{default:n(()=>[o(x,{type:"text",status:"success",onClick:h=>e(p)(a,()=>e(m)("ZsPreviewInvoicing"))},{default:n(()=>[N("查看开票信息")]),_:2},1032,["onClick"]),re((b(),y(x,{type:"text",disabled:!["5"].includes(a.auditState),onClick:h=>P(a)},{default:n(()=>[N("发票打包下载")]),_:2},1032,["disabled","onClick"])),[[e(s),"InvoicesInvoicingHistoryDownload"]])]),_:2},1024)]),_:1},8,["selected-keys","data","row-selection","bordered","pagination","size","columns","stripe","loading"])]),_:1},8,["table-columns","table-size","onResetSearch","onSearch","onChangeTableSize","onChangeTableColumn"]),e(I)==="ZsPreviewInvoicing"?(b(),y(pe,{key:0,data:e(w),onClose:t[5]||(t[5]=a=>e(p)({},()=>e(m)(""))),onSuccess:e(g)},null,8,["data","onSuccess"])):D("",!0),e(I)==="ZsGroupOrder"?(b(),y(ge,{key:1,data:e(w),onClose:t[6]||(t[6]=a=>e(p)({},()=>e(m)(""))),onSuccess:e(g)},null,8,["data","onSuccess"])):D("",!0)])}}});export{he as default};
