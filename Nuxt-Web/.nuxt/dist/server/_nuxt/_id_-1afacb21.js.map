{"version":3,"file":"_id_-1afacb21.js","sources":["../../../../../images/loading.gif","../../../../../images/ok.png","../../../../pages/evaluate/[id].vue"],"sourcesContent":["export default \"__VITE_PUBLIC_ASSET__780e86ad__\"","export default \"__VITE_PUBLIC_ASSET__8db87293__\"","<template>\r\n\t<div class=\"max-w-container mx-auto min-h-[70vh]\">\r\n\t\t<template v-if=\"!form.error\">\r\n\t\t\t<!-- 选择 -->\r\n\t\t\t<div v-if=\"!loading && !form.isResult\">\r\n\t\t\t\t<div class=\"flex items-center justify-between mb-[10px]\">\r\n\t\t\t\t\t<div class=\"mt-[20px]\">\r\n\t\t\t\t\t\t<span class=\"text-[#FFA864]\">{{ form.cur + 1 }}</span>\r\n\t\t\t\t\t\t<span>/</span>\r\n\t\t\t\t\t\t<span>{{ form.evaluateList?.length }}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- 进度条 -->\r\n\t\t\t\t<zs-proportion\r\n\t\t\t\t\t:width=\"\r\n\t\t\t\t\t\t(form.cur / (form.evaluateList.length - 1)) * 100 > 0\r\n\t\t\t\t\t\t\t? (form.cur / (form.evaluateList.length - 1)) * 100\r\n\t\t\t\t\t\t\t: 1\r\n\t\t\t\t\t\"\r\n\t\t\t\t\tbackground=\"#7C92FF\"\r\n\t\t\t\t\t:isAnimate=\"false\"\r\n\t\t\t\t\t:key=\"form.cur\"\r\n\t\t\t\t/>\r\n\t\t\t\t<div v-if=\"form.evaluateList?.length\">\r\n\t\t\t\t\t<div class=\"mt-[40px] mb-[20px] text-[20px]\">\r\n\t\t\t\t\t\t{{ form.evaluateList[form.cur]?.titleSort }}、{{\r\n\t\t\t\t\t\t\tform.evaluateList[form.cur]?.title\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div v-for=\"(o, i) in form.evaluateList[form.cur]?.answerOptionsList\" :key=\"i\">\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\"relative h-[50px] leading-[50px] rounded-[8px] px-[30px] mb-[10px] cursor-pointer border-left transition\"\r\n\t\t\t\t\t\t\t:class=\"\r\n\t\t\t\t\t\t\t\tform.evaluateList[form.cur]?.myAnswer == o\r\n\t\t\t\t\t\t\t\t\t? 'bg-[#7c92ff]'\r\n\t\t\t\t\t\t\t\t\t: 'bg-[#F9F9F9]'\r\n\t\t\t\t\t\t\t\"\r\n\t\t\t\t\t\t\t@click=\"selectAnswer(o, form.cur)\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div>{{ o }}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"mt-[20px] flex items-center justify-between\">\r\n\t\t\t\t\t\t<a-button\r\n\t\t\t\t\t\t\tv-if=\"form.cur !== 0\"\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tclass=\"openButton\"\r\n\t\t\t\t\t\t\t@click=\"prevQuestion\"\r\n\t\t\t\t\t\t\t><icon-arrow-left class=\"mr-[2px]\" />上一题\r\n\t\t\t\t\t\t</a-button>\r\n\t\t\t\t\t\t<a-button\r\n\t\t\t\t\t\t\tv-if=\"checkedNum >= 30\"\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tclass=\"openButton\"\r\n\t\t\t\t\t\t\t@click=\"submitUserEvaluationReport\"\r\n\t\t\t\t\t\t\t><icon-check class=\"mr-[2px]\" />提交\r\n\t\t\t\t\t\t</a-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tv-else-if=\"loading && !form.isResult\"\r\n\t\t\t\tclass=\"flex items-center justify-center flex-col\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\"mt-[30px] text-[18px]\">测评完成，正在生成报告...</div>\r\n\t\t\t\t<img src=\"/images/loading.gif\" alt=\"\" />\r\n\t\t\t</div>\r\n\t\t\t<div v-else class=\"flex items-center justify-center flex-col\">\r\n\t\t\t\t<div class=\"flex items-center justify-center mt-[50px]\">\r\n\t\t\t\t\t<img src=\"/images/ok.png\" style=\"width: 120px\" alt=\"\" />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"text-[32px] font-bold\">测评完成</div>\r\n\t\t\t\t<div class=\"text-[14px] text-[#666] my-[10px]\">\r\n\t\t\t\t\t共完成 {{ form.evaluateList.length }} 题\r\n\t\t\t\t</div>\r\n\t\t\t\t<a-button type=\"primary\" class=\"openButton\" @click=\"viewReport\">查看报告 </a-button>\r\n\t\t\t</div>\r\n\t\t</template>\r\n\t\t<zs-no-data v-else>\r\n\t\t\t<div>糟糕，页面好像没找到</div>\r\n\t\t</zs-no-data>\r\n\t</div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n// 防抖\r\nimport { useDebounceFn } from '@vueuse/core';\r\n// 设置头信息\r\nuseHead({\r\n\ttitle: '测评详情',\r\n});\r\n// 全局插件\r\nconst { $zsFetch } = useNuxtApp();\r\n// 页面loading\r\nconst [loading, setLoading] = useBasicsState(false);\r\n// 用户信息\r\n// 路由信息\r\nconst route = useRoute();\r\n// form\r\nconst { form } = useForm(() => ({\r\n\terror: false, // 判断是否不存在该院校\r\n\tevaluateList: [] as any, // 题列表\r\n\tcur: 0, // 当前索引\r\n\tisResult: false, // 是否有报告\r\n\ttime: 0, // 计时用\r\n\tcanClick: true, // 是否可以点击\r\n}));\r\n// 已选择数量\r\nconst checkedNum = computed(() => {\r\n\treturn form.value.evaluateList?.map((o: any) => o.myAnswer).filter((v: any) => v !== '')\r\n\t\t?.length;\r\n});\r\n// 选择答案\r\nconst selectAnswer = async (answer: any, current: any) => {\r\n\t//  判断是否可以点击\r\n\tif (!form.value.canClick) {\r\n\t\treturn;\r\n\t}\r\n\t// 禁止连续点击\r\n\tform.value.canClick = false;\r\n\t// 存储当前答案\r\n\tform.value.evaluateList[current].myAnswer = answer;\r\n\tawait sleep(500);\r\n\t// 可以点击\r\n\tform.value.canClick = true;\r\n\tif (current + 1 == form.value.evaluateList.length) {\r\n\t\t// 提交\r\n\t\tawait submitUserEvaluationReport();\r\n\t} else {\r\n\t\tform.value.cur++;\r\n\t}\r\n};\r\n// 节流\r\nconst debounceFn = useDebounceFn((answer: any, current: any) => {\r\n\tselectAnswer(answer, current);\r\n}, 100);\r\n// 上一题\r\nconst prevQuestion = () => {\r\n\tform.value.cur--;\r\n};\r\n// 提交报告\r\nconst submitUserEvaluationReport = async () => {\r\n\t// 开启loading\r\n\tsetLoading(true);\r\n\tconst [err, res] = await $zsFetch(API_URLS.EVALUATE.SUBMIT_EVALUATE, {\r\n\t\tbody: {\r\n\t\t\tid: route.params.id,\r\n\t\t\ttopicAndAnswer: form.value.evaluateList\r\n\t\t\t\t.filter((v: any) => v.myAnswer !== '')\r\n\t\t\t\t.map((o: any) => o.titleSort + '-' + (o.myAnswer == '是' ? '0' : '1')),\r\n\t\t},\r\n\t});\r\n\t// 关闭loading\r\n\tsetLoading(false);\r\n\tif (res) {\r\n\t\tform.value.isResult = true;\r\n\t}\r\n};\r\n// 查看报告\r\nconst viewReport = async () => {\r\n\tconst [err, res] = await $zsFetch(API_URLS.EVALUATE.VIEW_EVALUATE_REPORT, {\r\n\t\tbody: {\r\n\t\t\tid: route.params.id,\r\n\t\t},\r\n\t});\r\n\tif (res) {\r\n\t\twindow.open(res.data, '_blank');\r\n\t}\r\n};\r\n// 获取测评详情\r\nconst getEvaluateInfo = async () => {\r\n\tconst [err, res] = await $zsFetch(API_URLS.EVALUATE.QUERY_QUESTIONS, {\r\n\t\tbody: {\r\n\t\t\tid: route.params.id,\r\n\t\t},\r\n\t});\r\n\t// 处理错误\r\n\tif (res.data === '未查询到当前测评试题!') {\r\n\t\tform.value.error = true;\r\n\t\treturn;\r\n\t}\r\n\t// 赋值信息\r\n\tform.value.evaluateList = res.data.resultList.map((o: any) => {\r\n\t\treturn {\r\n\t\t\t...o,\r\n\t\t\tmyAnswer: '',\r\n\t\t};\r\n\t});\r\n};\r\ngetEvaluateInfo();\r\n</script>\r\n<style scoped>\r\n.border-left {\r\n\tborder-left: 8px solid #7c92ff;\r\n}\r\n.openButton {\r\n\tbackground: #ededed;\r\n\tcolor: #333;\r\n\tborder-radius: 4px;\r\n}\r\n.openButton:hover {\r\n\tbackground: #7c92ff;\r\n\tcolor: white;\r\n\tborder-radius: 4px;\r\n}\r\n.transition {\r\n\ttransition: all 0.8s ease 0s;\r\n}\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAe,aAAA,KAAA,kBAAA,oBAAA;ACAf,MAAe,aAAA,KAAA,kBAAA,eAAA;;;;;ACyFf,YAAA;AAAA,MAAQ,OAAA;AAAA,IACA,CAAA;AAGR,UAAA,EAAA,aAAA;AAEA,UAAA,CAAA,SAAA,UAAA,IAAA,eAAA,KAAA;AAGA,UAAA,QAAA;AAEA,UAAA,EAAA,SAAA,QAAA,OAAA;AAAA,MAAgC,OAAA;AAAA;AAAA,MACxB,cAAA,CAAA;AAAA;AAAA,MACQ,KAAA;AAAA;AAAA,MACV,UAAA;AAAA;AAAA,MACK,MAAA;AAAA;AAAA,MACJ,UAAA;AAAA;AAAA,IACI,EAAA;AAGX,UAAA,aAAA,SAAA,MAAA;;AACC,cAAA,gBAAA,MAAA,iBAAA,mBAAA,IAAA,CAAA,MAAA,EAAA,UAAA,OAAA,CAAA,MAAA,MAAA,QAAA,mBAAA;AAAA,IACG,CAAA;AAGJ,UAAA,eAAA,OAAA,QAAA,YAAA;AAEC,UAAA,CAAA,KAAA,MAAA,UAAA;AACC;AAAA,MAAA;AAGD,WAAA,MAAA,WAAA;AAEA,WAAA,MAAA,aAAA,OAAA,EAAA,WAAA;AACA,YAAA,MAAA,GAAA;AAEA,WAAA,MAAA,WAAA;AACA,UAAA,UAAA,KAAA,KAAA,MAAA,aAAA,QAAA;AAEC,cAAA,2BAAA;AAAA,MAAiC,OAAA;AAEjC,aAAA,MAAA;AAAA,MAAW;AAAA,IACZ;AAGD,kBAAA,CAAA,QAAA,YAAA;AACC,mBAAA,QAAA,OAAA;AAAA,IAA4B,GAAA,GAAA;AAG7B,UAAA,eAAA,MAAA;AACC,WAAA,MAAA;AAAA,IAAW;AAGZ,UAAA,6BAAA,YAAA;AAEC,iBAAA,IAAA;AACA,YAAA,CAAA,KAAA,GAAA,IAAA,MAAA,SAAA,SAAA,SAAA,iBAAA;AAAA,QAAqE,MAAA;AAAA,UAC9D,IAAA,MAAA,OAAA;AAAA,UACY,gBAAA,KAAA,MAAA,aAAA,OAAA,CAAA,MAAA,EAAA,aAAA,EAAA,EAAA,IAAA,CAAA,MAAA,EAAA,YAAA,OAAA,EAAA,YAAA,MAAA,MAAA,IAAA;AAAA,QAGoD;AAAA,MACtE,CAAA;AAGD,iBAAA,KAAA;AACA,UAAA,KAAA;AACC,aAAA,MAAA,WAAA;AAAA,MAAsB;AAAA,IACvB;AAGD,UAAA,aAAA,YAAA;AACC,YAAA,CAAA,KAAA,GAAA,IAAA,MAAA,SAAA,SAAA,SAAA,sBAAA;AAAA,QAA0E,MAAA;AAAA,UACnE,IAAA,MAAA,OAAA;AAAA,QACY;AAAA,MAClB,CAAA;AAED,UAAA,KAAA;AACC,eAAA,KAAA,IAAA,MAAA,QAAA;AAAA,MAA8B;AAAA,IAC/B;AAGD,UAAA,kBAAA,YAAA;AACC,YAAA,CAAA,KAAA,GAAA,IAAA,MAAA,SAAA,SAAA,SAAA,iBAAA;AAAA,QAAqE,MAAA;AAAA,UAC9D,IAAA,MAAA,OAAA;AAAA,QACY;AAAA,MAClB,CAAA;AAGD,UAAA,IAAA,SAAA,eAAA;AACC,aAAA,MAAA,QAAA;AACA;AAAA,MAAA;AAGD,WAAA,MAAA,eAAA,IAAA,KAAA,WAAA,IAAA,CAAA,MAAA;AACC,eAAA;AAAA,UAAO,GAAA;AAAA,UACH,UAAA;AAAA,QACO;AAAA,MACX,CAAA;AAAA,IACA;AAEF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}